################################################################
##
##  UMKM MULTI-TENANT SYSTEM
##  CLIENT SOURCE CODE COLLECTION
##
##  Collection Type: COMPONENTS_UI
##  Generated: 2026-01-05 18:33:47
##  Script Version: 3.1
##  Project: UMKM Multi-Tenant E-Commerce Platform (Next.js)
##
################################################################

This collection contains COMPONENTS & UI (CUSTOM ONLY):
- components/auth/ - Authentication components
- components/dashboard/ - Dashboard layout & navigation
- components/customers/ - Customer management components
- components/orders/ - Order management components
- components/products/ - Product management components
- components/settings/ - Settings components
- components/store/ - Public store components
- components/landing/ - Landing page sections
- components/upload/ - Image upload components

EXCLUDED:
- components/ui/ - Shadcn UI components (auto-generated, skipped)

################################################################


################################################################
##
##  CATEGORY: Auth Components
##  Path: src/components/auth
##
################################################################

================================================
FILE: src/components/auth/index.ts
Lines: 9
================================================

// ==========================================
// AUTH COMPONENTS INDEX
// ==========================================

export { AuthGuard, GuestGuard } from './auth-guard';
export { AuthLayout } from './auth-layout';
export { AuthLogo } from './auth-logo';
export { LoginForm } from './login-form';
export { RegisterForm } from './register-form';
export { ForgotPasswordForm } from './forgot-password-form';

================================================
FILE: src/components/auth/auth-guard.tsx
Lines: 180
================================================

'use client';

import { useEffect, useRef } from 'react';
import { useRouter, usePathname } from 'next/navigation';
import {
  useAuthHydrated,
  useIsAuthenticated,
  useAuthChecked,
  useAuthStore,
} from '@/stores';
import { authApi } from '@/lib/api';

// ==========================================
// AUTH GUARD COMPONENT
// ==========================================

interface AuthGuardProps {
  children: React.ReactNode;
  requireAuth?: boolean;
  redirectTo?: string;
}

export function AuthGuard({
  children,
  requireAuth = true,
  redirectTo = '/login',
}: AuthGuardProps) {
  const router = useRouter();
  const pathname = usePathname();

  const isHydrated = useAuthHydrated();
  const isAuthenticated = useIsAuthenticated();
  const isChecked = useAuthChecked();

  const { setTenant, setChecked } = useAuthStore();
  const hasRedirectedRef = useRef(false);
  const hasCheckedRef = useRef(false);

  // Check auth status on mount
  useEffect(() => {
    if (!isHydrated || hasCheckedRef.current || isChecked) return;

    hasCheckedRef.current = true;

    const checkAuth = async () => {
      try {
        const response = await authApi.status();

        if (response.authenticated && response.tenant) {
          setTenant(response.tenant);
        } else {
          setTenant(null);
        }
      } catch {
        setTenant(null);
      } finally {
        setChecked(true);
      }
    };

    checkAuth();
  }, [isHydrated, isChecked, setTenant, setChecked]);

  // Handle redirect
  useEffect(() => {
    if (!isHydrated || !isChecked) return;
    if (hasRedirectedRef.current) return;

    if (requireAuth && !isAuthenticated) {
      hasRedirectedRef.current = true;
      const returnUrl = encodeURIComponent(pathname);
      router.replace(`${redirectTo}?from=${returnUrl}`);
    }
  }, [isHydrated, isChecked, isAuthenticated, requireAuth, redirectTo, pathname, router]);

  // Loading state
  if (!isHydrated || !isChecked) {
    return <LoadingScreen message="Memeriksa autentikasi..." />;
  }

  // Not authenticated
  if (requireAuth && !isAuthenticated) {
    return <LoadingScreen message="Mengalihkan..." />;
  }

  return <>{children}</>;
}

// ==========================================
// GUEST GUARD
// ==========================================

interface GuestGuardProps {
  children: React.ReactNode;
  redirectTo?: string;
}

export function GuestGuard({
  children,
  redirectTo = '/dashboard',
}: GuestGuardProps) {
  const router = useRouter();

  const isHydrated = useAuthHydrated();
  const isAuthenticated = useIsAuthenticated();
  const isChecked = useAuthChecked();

  const { setTenant, setChecked } = useAuthStore();
  const hasRedirectedRef = useRef(false);
  const hasCheckedRef = useRef(false);

  // Check auth status on mount
  useEffect(() => {
    if (!isHydrated || hasCheckedRef.current || isChecked) return;

    hasCheckedRef.current = true;

    const checkAuth = async () => {
      try {
        const response = await authApi.status();

        if (response.authenticated && response.tenant) {
          setTenant(response.tenant);
        } else {
          setTenant(null);
        }
      } catch {
        setTenant(null);
      } finally {
        setChecked(true);
      }
    };

    checkAuth();
  }, [isHydrated, isChecked, setTenant, setChecked]);

  // Handle redirect if authenticated
  useEffect(() => {
    if (!isHydrated || !isChecked) return;
    if (hasRedirectedRef.current) return;

    if (isAuthenticated) {
      hasRedirectedRef.current = true;
      router.replace(redirectTo);
    }
  }, [isHydrated, isChecked, isAuthenticated, redirectTo, router]);

  // During check, show children
  if (!isHydrated || !isChecked) {
    return <>{children}</>;
  }

  // Authenticated - show loading while redirecting
  if (isAuthenticated) {
    return <LoadingScreen message="Anda sudah login..." />;
  }

  return <>{children}</>;
}

// ==========================================
// LOADING SCREEN
// ==========================================

function LoadingScreen({ message }: { message: string }) {
  return (
    <div className="flex items-center justify-center min-h-screen bg-background">
      <div className="flex flex-col items-center gap-6">
        <div className="relative w-16 h-16">
          <div className="absolute inset-0 rounded-full border-4 border-primary/20" />
          <div className="absolute inset-0 rounded-full border-4 border-transparent border-t-primary animate-spin" />
          <div className="absolute inset-3 rounded-full bg-primary/10 animate-pulse" />
        </div>
        <div className="text-center space-y-2">
          <p className="text-sm font-medium text-foreground">{message}</p>
          <p className="text-xs text-muted-foreground">Mohon tunggu sebentar</p>
        </div>
      </div>
    </div>
  );
}

================================================
FILE: src/components/auth/auth-layout.tsx
Lines: 45
================================================

import { AuthLogo } from './auth-logo';

// ==========================================
// AUTH LAYOUT COMPONENT
// Centered card layout for auth pages
// ==========================================

interface AuthLayoutProps {
  children: React.ReactNode;
  title: string;
  description?: string;
}

export function AuthLayout({ children, title, description }: AuthLayoutProps) {
  return (
    <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-b from-primary/5 via-background to-background">
      {/* Logo */}
      <div className="mb-8">
        <AuthLogo size="lg" />
      </div>

      {/* Card */}
      <div className="w-full max-w-md">
        <div className="rounded-xl border bg-card p-8 shadow-sm">
          {/* Header */}
          <div className="text-center mb-6">
            <h1 className="text-2xl font-bold">{title}</h1>
            {description && (
              <p className="text-sm text-muted-foreground mt-2">
                {description}
              </p>
            )}
          </div>

          {/* Content */}
          {children}
        </div>
      </div>

      {/* Footer */}
      <p className="mt-8 text-sm text-muted-foreground">
        ¬© {new Date().getFullYear()} Fibidy. Hak cipta dilindungi.
      </p>
    </div>
  );
}

================================================
FILE: src/components/auth/auth-logo.tsx
Lines: 29
================================================

import Link from 'next/link';
import { Store } from 'lucide-react';
import { siteConfig } from '@/config/site';

// ==========================================
// AUTH LOGO COMPONENT
// ==========================================

interface AuthLogoProps {
  size?: 'sm' | 'md' | 'lg';
}

export function AuthLogo({ size = 'md' }: AuthLogoProps) {
  const sizes = {
    sm: { icon: 'h-6 w-6', text: 'text-xl' },
    md: { icon: 'h-8 w-8', text: 'text-2xl' },
    lg: { icon: 'h-10 w-10', text: 'text-3xl' },
  };

  return (
    <Link href="/" className="flex items-center gap-2 group">
      <div className="flex items-center justify-center rounded-xl bg-primary p-2 group-hover:bg-primary/90 transition-colors">
        <Store className={`${sizes[size].icon} text-primary-foreground`} />
      </div>
      <span className={`font-bold ${sizes[size].text} text-foreground`}>
        {siteConfig.name}
      </span>
    </Link>
  );
}

================================================
FILE: src/components/auth/forgot-password-form.tsx
Lines: 129
================================================

'use client';

import { useState } from 'react';
import Link from 'next/link';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { ArrowLeft, Loader2, Mail } from 'lucide-react';
import { z } from 'zod';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import { Alert, AlertDescription } from '@/components/ui/alert';

// ==========================================
// FORGOT PASSWORD FORM
// Placeholder - Backend implementation needed
// ==========================================

const forgotPasswordSchema = z.object({
  email: z.string().email('Format email tidak valid'),
});

type ForgotPasswordFormData = z.infer<typeof forgotPasswordSchema>;

export function ForgotPasswordForm() {
  const [isLoading, setIsLoading] = useState(false);
  const [isSubmitted, setIsSubmitted] = useState(false);

  const form = useForm<ForgotPasswordFormData>({
    resolver: zodResolver(forgotPasswordSchema),
    defaultValues: {
      email: '',
    },
  });

  const onSubmit = async () => {
    setIsLoading(true);

    // Simulate API call
    await new Promise((resolve) => setTimeout(resolve, 1500));

    setIsSubmitted(true);
    setIsLoading(false);
  };

  if (isSubmitted) {
    return (
      <div className="text-center space-y-4">
        <div className="flex justify-center">
          <div className="rounded-full bg-primary/10 p-4">
            <Mail className="h-8 w-8 text-primary" />
          </div>
        </div>
        <h2 className="text-lg font-semibold">Cek Email Anda</h2>
        <p className="text-sm text-muted-foreground">
          Jika email terdaftar, kami akan mengirimkan instruksi untuk reset
          password ke <strong>{form.getValues('email')}</strong>
        </p>
        <Button asChild variant="outline" className="w-full">
          <Link href="/login">
            <ArrowLeft className="h-4 w-4 mr-2" />
            Kembali ke Login
          </Link>
        </Button>
      </div>
    );
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        {/* Info */}
        <Alert>
          <AlertDescription>
            Masukkan email yang terdaftar. Kami akan mengirimkan link untuk
            reset password.
          </AlertDescription>
        </Alert>

        {/* Email */}
        <FormField
          control={form.control}
          name="email"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Email</FormLabel>
              <FormControl>
                <Input
                  type="email"
                  placeholder="nama@email.com"
                  autoComplete="email"
                  disabled={isLoading}
                  {...field}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        {/* Submit */}
        <Button type="submit" className="w-full" disabled={isLoading}>
          {isLoading ? (
            <>
              <Loader2 className="h-4 w-4 mr-2 animate-spin" />
              Mengirim...
            </>
          ) : (
            'Kirim Link Reset'
          )}
        </Button>

        {/* Back to Login */}
        <Button asChild variant="ghost" className="w-full">
          <Link href="/login">
            <ArrowLeft className="h-4 w-4 mr-2" />
            Kembali ke Login
          </Link>
        </Button>
      </form>
    </Form>
  );
}

================================================
FILE: src/components/auth/login-form.tsx
Lines: 142
================================================

'use client';

import { useState } from 'react';
import Link from 'next/link';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { Eye, EyeOff, Loader2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { useLogin } from '@/hooks';
import { loginSchema, type LoginFormData } from '@/lib/validations';

// ==========================================
// LOGIN FORM COMPONENT
// ==========================================

export function LoginForm() {
  const [showPassword, setShowPassword] = useState(false);
  const { login, isLoading, error } = useLogin();

  const form = useForm<LoginFormData>({
    resolver: zodResolver(loginSchema),
    defaultValues: {
      email: '',
      password: '',
    },
  });

  const onSubmit = async (data: LoginFormData) => {
    try {
      await login(data);
    } catch {
      // Error handled in hook
    }
  };

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        {/* Error Alert */}
        {error && (
          <Alert variant="destructive">
            <AlertDescription>{error}</AlertDescription>
          </Alert>
        )}

        {/* Email */}
        <FormField
          control={form.control}
          name="email"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Email</FormLabel>
              <FormControl>
                <Input
                  type="email"
                  placeholder="nama@email.com"
                  autoComplete="email"
                  disabled={isLoading}
                  {...field}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        {/* Password */}
        <FormField
          control={form.control}
          name="password"
          render={({ field }) => (
            <FormItem>
              <div className="flex items-center justify-between">
                <FormLabel>Password</FormLabel>
                <Link
                  href="/forgot-password"
                  className="text-xs text-primary hover:underline"
                >
                  Lupa password?
                </Link>
              </div>
              <FormControl>
                <div className="relative">
                  <Input
                    type={showPassword ? 'text' : 'password'}
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    autoComplete="current-password"
                    disabled={isLoading}
                    {...field}
                  />
                  <Button
                    type="button"
                    variant="ghost"
                    size="icon"
                    className="absolute right-0 top-0 h-full px-3 hover:bg-transparent"
                    onClick={() => setShowPassword(!showPassword)}
                  >
                    {showPassword ? (
                      <EyeOff className="h-4 w-4 text-muted-foreground" />
                    ) : (
                      <Eye className="h-4 w-4 text-muted-foreground" />
                    )}
                  </Button>
                </div>
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        {/* Submit */}
        <Button type="submit" className="w-full" disabled={isLoading}>
          {isLoading ? (
            <>
              <Loader2 className="h-4 w-4 mr-2 animate-spin" />
              Masuk...
            </>
          ) : (
            'Masuk'
          )}
        </Button>

        {/* Register Link */}
        <p className="text-center text-sm text-muted-foreground">
          Belum punya toko?{' '}
          <Link href="/register" className="text-primary hover:underline font-medium">
            Daftar Gratis
          </Link>
        </p>
      </form>
    </Form>
  );
}

================================================
FILE: src/components/auth/register-form.tsx
Lines: 408
================================================

'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { Eye, EyeOff, Loader2, Check, X, Info } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Textarea } from '@/components/ui/textarea';
import { useRegister, useCheckSlug, useDebounce } from '@/hooks';
import { registerSchema, type RegisterFormData } from '@/lib/validations';
import { getCategoryOptions } from '@/config/categories';
import { cn } from '@/lib/cn';

// ==========================================
// REGISTER FORM COMPONENT
// ==========================================

export function RegisterForm() {
  const [showPassword, setShowPassword] = useState(false);
  const [step, setStep] = useState(1); // 1: Store info, 2: Account info
  const { register, isLoading, error } = useRegister();
  const { checkSlug, isChecking, isAvailable, reset: resetSlug } = useCheckSlug();

  const categories = getCategoryOptions();

  const form = useForm<RegisterFormData>({
    resolver: zodResolver(registerSchema),
    defaultValues: {
      slug: '',
      name: '',
      category: '',
      email: '',
      password: '',
      whatsapp: '',
      description: '',
    },
    mode: 'onChange',
  });

  // eslint-disable-next-line react-hooks/incompatible-library
  const slugValue = form.watch('slug');
  const debouncedSlug = useDebounce(slugValue, 500);

  // Check slug availability
  useEffect(() => {
    if (debouncedSlug && debouncedSlug.length >= 3) {
      checkSlug(debouncedSlug);
    } else {
      resetSlug();
    }
  }, [debouncedSlug, checkSlug, resetSlug]);

  // Auto-generate slug from name
  const handleNameChange = (value: string) => {
    const slug = value
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/(^-|-$)/g, '')
      .slice(0, 30);

    if (!form.getValues('slug') || form.getValues('slug') === '') {
      form.setValue('slug', slug, { shouldValidate: true });
    }
  };

  const onSubmit = async (data: RegisterFormData) => {
    try {
      await register(data);
    } catch {
      // Error handled in hook
    }
  };

  const goToStep2 = async () => {
    const isValid = await form.trigger(['slug', 'name', 'category', 'description']);
    if (isValid && isAvailable !== false) {
      setStep(2);
    }
  };

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        {/* Error Alert */}
        {error && (
          <Alert variant="destructive">
            <AlertDescription>{error}</AlertDescription>
          </Alert>
        )}

        {/* Step Indicator */}
        <div className="flex items-center justify-center gap-2 mb-6">
          <div
            className={cn(
              'flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium',
              step === 1
                ? 'bg-primary text-primary-foreground'
                : 'bg-muted text-muted-foreground'
            )}
          >
            1
          </div>
          <div className="w-12 h-0.5 bg-muted" />
          <div
            className={cn(
              'flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium',
              step === 2
                ? 'bg-primary text-primary-foreground'
                : 'bg-muted text-muted-foreground'
            )}
          >
            2
          </div>
        </div>

        {/* STEP 1: Store Information */}
        {step === 1 && (
          <>
            <p className="text-sm text-center text-muted-foreground mb-4">
              Informasi Toko
            </p>

            {/* Store Name */}
            <FormField
              control={form.control}
              name="name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Nama Toko</FormLabel>
                  <FormControl>
                    <Input
                      placeholder="Warung Bu Sari"
                      {...field}
                      onChange={(e) => {
                        field.onChange(e);
                        handleNameChange(e.target.value);
                      }}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Slug */}
            <FormField
              control={form.control}
              name="slug"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Alamat Toko</FormLabel>
                  <FormControl>
                    <div className="relative">
                      <Input
                        placeholder="warung-bu-sari"
                        {...field}
                        onChange={(e) => {
                          const value = e.target.value
                            .toLowerCase()
                            .replace(/[^a-z0-9-]/g, '');
                          field.onChange(value);
                        }}
                      />
                      {/* Availability Indicator */}
                      {field.value.length >= 3 && (
                        <div className="absolute right-3 top-1/2 -translate-y-1/2">
                          {isChecking ? (
                            <Loader2 className="h-4 w-4 animate-spin text-muted-foreground" />
                          ) : isAvailable === true ? (
                            <Check className="h-4 w-4 text-green-500" />
                          ) : isAvailable === false ? (
                            <X className="h-4 w-4 text-red-500" />
                          ) : null}
                        </div>
                      )}
                    </div>
                  </FormControl>
                  <FormDescription className="flex items-center gap-1">
                    <Info className="h-3 w-3" />
                    fibidy.com/store/{field.value || 'nama-toko'}
                  </FormDescription>
                  {isAvailable === false && (
                    <p className="text-sm text-destructive">
                      Alamat toko sudah digunakan
                    </p>
                  )}
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Category */}
            <FormField
              control={form.control}
              name="category"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Kategori Usaha</FormLabel>
                  <Select onValueChange={field.onChange} value={field.value}>
                    <FormControl>
                      <SelectTrigger>
                        <SelectValue placeholder="Pilih kategori" />
                      </SelectTrigger>
                    </FormControl>
                    <SelectContent>
                      {categories.map((cat) => (
                        <SelectItem key={cat.value} value={cat.value}>
                          {cat.label}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Description (Optional) */}
            <FormField
              control={form.control}
              name="description"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Deskripsi (opsional)</FormLabel>
                  <FormControl>
                    <Textarea
                      placeholder="Ceritakan tentang toko Anda..."
                      rows={3}
                      {...field}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Next Button */}
            <Button
              type="button"
              className="w-full"
              onClick={goToStep2}
              disabled={isAvailable === false}
            >
              Lanjutkan
            </Button>
          </>
        )}

        {/* STEP 2: Account Information */}
        {step === 2 && (
          <>
            <p className="text-sm text-center text-muted-foreground mb-4">
              Informasi Akun
            </p>

            {/* Email */}
            <FormField
              control={form.control}
              name="email"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Email</FormLabel>
                  <FormControl>
                    <Input
                      type="email"
                      placeholder="nama@email.com"
                      autoComplete="email"
                      disabled={isLoading}
                      {...field}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Password */}
            <FormField
              control={form.control}
              name="password"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Password</FormLabel>
                  <FormControl>
                    <div className="relative">
                      <Input
                        type={showPassword ? 'text' : 'password'}
                        placeholder="Minimal 6 karakter"
                        autoComplete="new-password"
                        disabled={isLoading}
                        {...field}
                      />
                      <Button
                        type="button"
                        variant="ghost"
                        size="icon"
                        className="absolute right-0 top-0 h-full px-3 hover:bg-transparent"
                        onClick={() => setShowPassword(!showPassword)}
                      >
                        {showPassword ? (
                          <EyeOff className="h-4 w-4 text-muted-foreground" />
                        ) : (
                          <Eye className="h-4 w-4 text-muted-foreground" />
                        )}
                      </Button>
                    </div>
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* WhatsApp */}
            <FormField
              control={form.control}
              name="whatsapp"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Nomor WhatsApp</FormLabel>
                  <FormControl>
                    <div className="flex">
                      <span className="inline-flex items-center px-3 rounded-l-md border border-r-0 bg-muted text-sm text-muted-foreground">
                        +62
                      </span>
                      <Input
                        type="tel"
                        placeholder="81234567890"
                        className="rounded-l-none"
                        disabled={isLoading}
                        {...field}
                        onChange={(e) => {
                          let value = e.target.value.replace(/\D/g, '');
                          // Remove leading 0 or 62
                          if (value.startsWith('0')) {
                            value = value.slice(1);
                          }
                          if (value.startsWith('62')) {
                            value = value.slice(2);
                          }
                          // Add 62 prefix
                          field.onChange('62' + value);
                        }}
                        value={field.value.replace(/^62/, '')}
                      />
                    </div>
                  </FormControl>
                  <FormDescription>
                    Nomor ini akan digunakan untuk menerima pesanan
                  </FormDescription>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Buttons */}
            <div className="flex gap-2">
              <Button
                type="button"
                variant="outline"
                className="flex-1"
                onClick={() => setStep(1)}
                disabled={isLoading}
              >
                Kembali
              </Button>
              <Button type="submit" className="flex-1" disabled={isLoading}>
                {isLoading ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    Mendaftar...
                  </>
                ) : (
                  'Daftar Sekarang'
                )}
              </Button>
            </div>
          </>
        )}

        {/* Login Link */}
        <p className="text-center text-sm text-muted-foreground">
          Sudah punya toko?{' '}
          <Link href="/login" className="text-primary hover:underline font-medium">
            Masuk
          </Link>
        </p>
      </form>
    </Form>
  );
}


################################################################
##
##  CATEGORY: Dashboard Components
##  Path: src/components/dashboard
##
################################################################

================================================
FILE: src/components/dashboard/index.ts
Lines: 20
================================================

// ==========================================
// DASHBOARD COMPONENTS INDEX
// ==========================================

// Layout
export { DashboardLayout } from './dashboard-layout';
export { DashboardSidebar } from './dashboard-sidebar';
export { DashboardHeader } from './dashboard-header';
export { DashboardNav } from './dashboard-nav';
export { DashboardBreadcrumb } from './dashboard-breadcrumb';
export { DashboardShell, PageHeader } from './dashboard-shell';

// Dashboard Home - Existing
export { DashboardStats } from './dashboard-stats';
export { DashboardQuickActions } from './dashboard-quick-actions';

// Dashboard Home - Enhanced (STEP 8)
export { StatsCard } from './stats-card';
export { RevenueWidget } from './revenue-widget';
export { RecentOrders } from './recent-orders';
export { AlertsWidget } from './alerts-widget';

================================================
FILE: src/components/dashboard/alerts-widget.tsx
Lines: 152
================================================

import Link from 'next/link';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import {
  AlertTriangle,
  Package,
  ShoppingCart,
  ArrowRight,
  CheckCircle,
} from 'lucide-react';
import type { LowStockItem } from '@/types';

// ==========================================
// ALERTS WIDGET
// ==========================================

interface AlertsWidgetProps {
  lowStockCount: number;
  pendingOrdersCount: number;
  lowStockItems?: LowStockItem[];
}

export function AlertsWidget({
  lowStockCount,
  pendingOrdersCount,
  lowStockItems = [],
}: AlertsWidgetProps) {
  const hasAlerts = lowStockCount > 0 || pendingOrdersCount > 0;

  return (
    <Card className={hasAlerts ? 'border-orange-200' : 'border-green-200'}>
      <CardHeader className="pb-2">
        <CardTitle className="text-base font-semibold flex items-center gap-2">
          {hasAlerts ? (
            <>
              <AlertTriangle className="h-5 w-5 text-orange-500" />
              <span className="text-orange-700">Perlu Perhatian</span>
            </>
          ) : (
            <>
              <CheckCircle className="h-5 w-5 text-green-500" />
              <span className="text-green-700">Semua Baik!</span>
            </>
          )}
        </CardTitle>
      </CardHeader>
      <CardContent className="space-y-3">
        {!hasAlerts ? (
          <p className="text-sm text-green-600">
            Tidak ada item yang memerlukan perhatian saat ini. üëç
          </p>
        ) : (
          <>
            {/* Pending Orders Alert */}
            {pendingOrdersCount > 0 && (
              <AlertItem
                icon={<ShoppingCart className="h-4 w-4" />}
                title={`${pendingOrdersCount} pesanan pending`}
                description="Pesanan menunggu diproses"
                href="/dashboard/orders?status=PENDING"
                variant="warning"
              />
            )}

            {/* Low Stock Alert */}
            {lowStockCount > 0 && (
              <div className="space-y-2">
                <AlertItem
                  icon={<Package className="h-4 w-4" />}
                  title={`${lowStockCount} produk stok menipis`}
                  description="Perlu restok segera"
                  href="/dashboard/products?filter=low-stock"
                  variant="danger"
                />

                {/* Low Stock Items Preview */}
                {lowStockItems.length > 0 && (
                  <div className="ml-6 pl-4 border-l-2 border-red-200 space-y-1">
                    {lowStockItems.slice(0, 3).map((item) => (
                      <div
                        key={item.id}
                        className="flex items-center justify-between text-xs"
                      >
                        <span className="text-muted-foreground truncate max-w-[150px]">
                          {item.name}
                        </span>
                        <span className="text-red-600 font-medium">
                          Stok: {item.stock}
                        </span>
                      </div>
                    ))}
                    {lowStockItems.length > 3 && (
                      <p className="text-xs text-muted-foreground">
                        +{lowStockItems.length - 3} produk lainnya
                      </p>
                    )}
                  </div>
                )}
              </div>
            )}
          </>
        )}
      </CardContent>
    </Card>
  );
}

// ==========================================
// ALERT ITEM
// ==========================================

interface AlertItemProps {
  icon: React.ReactNode;
  title: string;
  description: string;
  href: string;
  variant: 'warning' | 'danger';
}

function AlertItem({ icon, title, description, href, variant }: AlertItemProps) {
  return (
    <Link
      href={href}
      className={`flex items-center justify-between p-3 rounded-lg transition-colors ${variant === 'danger'
        ? 'bg-red-50 hover:bg-red-100'
        : 'bg-orange-50 hover:bg-orange-100'
        }`}
    >
      <div className="flex items-center gap-3">
        <div
          className={`p-2 rounded-full ${variant === 'danger'
            ? 'bg-red-100 text-red-600'
            : 'bg-orange-100 text-orange-600'
            }`}
        >
          {icon}
        </div>
        <div>
          <p
            className={`text-sm font-medium ${variant === 'danger' ? 'text-red-700' : 'text-orange-700'
              }`}
          >
            {title}
          </p>
          <p className="text-xs text-muted-foreground">{description}</p>
        </div>
      </div>
      <ArrowRight
        className={`h-4 w-4 ${variant === 'danger' ? 'text-red-400' : 'text-orange-400'
          }`}
      />
    </Link>
  );
}

================================================
FILE: src/components/dashboard/dashboard-breadcrumb.tsx
Lines: 94
================================================

// src/components/dashboard/dashboard-breadcrumb.tsx
'use client';

import { usePathname } from 'next/navigation';
import Link from 'next/link';
import { Fragment } from 'react';
import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from '@/components/ui/breadcrumb';

// ==========================================
// DASHBOARD BREADCRUMB
// Auto-generates breadcrumb from pathname
// ==========================================

// Mapping untuk label yang lebih readable
const LABEL_MAP: Record<string, string> = {
  dashboard: 'Dashboard',
  products: 'Produk',
  customers: 'Pelanggan',
  orders: 'Pesanan',
  settings: 'Pengaturan',
  new: 'Tambah Baru',
  edit: 'Edit',
  store: 'Toko',
};

function formatLabel(segment: string): string {
  // Check mapping first
  if (LABEL_MAP[segment.toLowerCase()]) {
    return LABEL_MAP[segment.toLowerCase()];
  }

  // Check if it's a UUID or ID (skip formatting)
  if (segment.match(/^[0-9a-f-]{36}$/i) || segment.match(/^[0-9]+$/)) {
    return 'Detail';
  }

  // Capitalize first letter
  return segment.charAt(0).toUpperCase() + segment.slice(1);
}

export function DashboardBreadcrumb() {
  const pathname = usePathname();

  // Split pathname and filter empty strings
  const segments = pathname.split('/').filter(Boolean);

  // Build breadcrumb items
  const breadcrumbs = segments.map((segment, index) => {
    const href = '/' + segments.slice(0, index + 1).join('/');
    const label = formatLabel(segment);
    const isLast = index === segments.length - 1;

    return {
      href,
      label,
      isLast,
    };
  });

  // Don't show breadcrumb if only one segment (e.g., /dashboard)
  if (breadcrumbs.length <= 1) {
    return null;
  }

  return (
    <Breadcrumb>
      <BreadcrumbList>
        {breadcrumbs.map((item, index) => (
          <Fragment key={item.href}>
            {/* Separator - SEBELUM item (kecuali item pertama) */}
            {index > 0 && <BreadcrumbSeparator />}

            {/* Breadcrumb Item */}
            <BreadcrumbItem>
              {item.isLast ? (
                <BreadcrumbPage>{item.label}</BreadcrumbPage>
              ) : (
                <BreadcrumbLink asChild>
                  <Link href={item.href}>{item.label}</Link>
                </BreadcrumbLink>
              )}
            </BreadcrumbItem>
          </Fragment>
        ))}
      </BreadcrumbList>
    </Breadcrumb>
  );
}

================================================
FILE: src/components/dashboard/dashboard-header.tsx
Lines: 111
================================================

'use client';

import Link from 'next/link';
import { Bell, Search } from 'lucide-react';
import { SidebarTrigger } from '@/components/ui/sidebar';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Separator } from '@/components/ui/separator';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { AnimatedThemeToggler } from '@/components/ui/animated-theme-toggler';
import { useAuth, useLogout } from '@/hooks';
import { getInitials } from '@/lib/format';
import { DashboardBreadcrumb } from './dashboard-breadcrumb';

// ==========================================
// DASHBOARD HEADER COMPONENT
// ==========================================

export function DashboardHeader() {
  const { tenant } = useAuth();
  const { logout } = useLogout();

  return (
    <header className="flex h-16 shrink-0 items-center gap-2 border-b px-4">
      {/* Sidebar Trigger */}
      <SidebarTrigger className="-ml-1" />
      <Separator orientation="vertical" className="mr-2 h-4" />

      {/* Breadcrumb */}
      <DashboardBreadcrumb />

      {/* Spacer */}
      <div className="flex-1" />

      {/* Right Actions */}
      <div className="flex items-center gap-2">
        {/* Search (Desktop Only) */}
        <div className="hidden md:flex relative">
          <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
          <Input
            type="search"
            placeholder="Cari..."
            className="w-64 pl-8 h-9"
          />
        </div>

        {/* Notifications */}
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <Button variant="ghost" size="icon" className="relative">
              <Bell className="h-5 w-5" />
              {/* Notification dot */}
              <span className="absolute top-1 right-1 h-2 w-2 rounded-full bg-primary" />
              <span className="sr-only">Notifikasi</span>
            </Button>
          </DropdownMenuTrigger>
          <DropdownMenuContent align="end" className="w-80">
            <DropdownMenuLabel>Notifikasi</DropdownMenuLabel>
            <DropdownMenuSeparator />
            <div className="p-4 text-center text-sm text-muted-foreground">
              Tidak ada notifikasi baru
            </div>
          </DropdownMenuContent>
        </DropdownMenu>

        {/* Theme Toggle - Desktop & Mobile */}
        <AnimatedThemeToggler
          className="flex h-9 w-9 items-center justify-center rounded-md hover:bg-accent hover:text-accent-foreground transition-colors [&_svg]:h-5 [&_svg]:w-5"
        />

        {/* User Menu (Mobile Only) - Avatar sudah di sidebar tapi tetap untuk quick access */}
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <Button variant="ghost" size="icon" className="md:hidden">
              <Avatar className="h-8 w-8">
                <AvatarImage src={tenant?.logo || undefined} />
                <AvatarFallback className="bg-primary text-primary-foreground text-xs">
                  {tenant?.name ? getInitials(tenant.name) : 'U'}
                </AvatarFallback>
              </Avatar>
            </Button>
          </DropdownMenuTrigger>
          <DropdownMenuContent align="end">
            <DropdownMenuLabel>
              <div className="flex flex-col">
                <span>{tenant?.name}</span>
                <span className="text-xs font-normal text-muted-foreground">
                  {tenant?.email}
                </span>
              </div>
            </DropdownMenuLabel>
            <DropdownMenuSeparator />
            <DropdownMenuItem asChild>
              <Link href="/dashboard/settings">Pengaturan</Link>
            </DropdownMenuItem>
            <DropdownMenuItem onClick={logout} className="text-destructive">
              Keluar
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </div>
    </header>
  );
}

================================================
FILE: src/components/dashboard/dashboard-layout.tsx
Lines: 28
================================================

'use client';

import { SidebarInset, SidebarProvider } from '@/components/ui/sidebar';
import { DashboardSidebar } from './dashboard-sidebar';
import { DashboardHeader } from './dashboard-header';
import { DashboardShell } from './dashboard-shell';

// ==========================================
// DASHBOARD LAYOUT COMPONENT
// Main layout wrapper using shadcn sidebar
// ==========================================

interface DashboardLayoutProps {
  children: React.ReactNode;
}

export function DashboardLayout({ children }: DashboardLayoutProps) {
  return (
    <SidebarProvider>
      <DashboardSidebar />
      <SidebarInset>
        <DashboardHeader />
        <DashboardShell>
          {children}
        </DashboardShell>
      </SidebarInset>
    </SidebarProvider>
  );
}

================================================
FILE: src/components/dashboard/dashboard-nav.tsx
Lines: 185
================================================

'use client';

import Link from 'next/link';
import { usePathname } from 'next/navigation';
import {
  LayoutDashboard,
  Package,
  Users,
  ShoppingCart,
  Settings,
  Store,
  ChevronRight,
  type LucideIcon,
} from 'lucide-react';
import {
  SidebarGroup,
  SidebarGroupLabel,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
} from '@/components/ui/sidebar';
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from '@/components/ui/collapsible';

// ==========================================
// NAVIGATION ITEMS
// ==========================================

interface NavItem {
  title: string;
  href: string;
  icon: LucideIcon;
  badge?: number;
  children?: { title: string; href: string }[];
}

interface NavGroup {
  title: string;
  items: NavItem[];
}

const navigation: NavGroup[] = [
  {
    title: 'Menu Utama',
    items: [
      {
        title: 'Dashboard',
        href: '/dashboard',
        icon: LayoutDashboard,
      },
      {
        title: 'Produk',
        href: '/dashboard/products',
        icon: Package,
        children: [
          { title: 'Semua Produk', href: '/dashboard/products' },
          { title: 'Tambah Produk', href: '/dashboard/products/new' },
          { title: 'Kategori', href: '/dashboard/products/categories' },
        ],
      },
      {
        title: 'Pelanggan',
        href: '/dashboard/customers',
        icon: Users,
      },
      {
        title: 'Pesanan',
        href: '/dashboard/orders',
        icon: ShoppingCart,
      },
    ],
  },
  {
    title: 'Lainnya',
    items: [
      {
        title: 'Lihat Toko',
        href: '/store',
        icon: Store,
      },
      {
        title: 'Pengaturan',
        href: '/dashboard/settings',
        icon: Settings,
      },
    ],
  },
];

// ==========================================
// DASHBOARD NAV COMPONENT
// ==========================================

export function DashboardNav() {
  const pathname = usePathname();

  const isActive = (href: string) => {
    if (href === '/dashboard') {
      return pathname === '/dashboard';
    }
    return pathname.startsWith(href);
  };

  return (
    <>
      {navigation.map((group) => (
        <SidebarGroup key={group.title}>
          <SidebarGroupLabel>{group.title}</SidebarGroupLabel>
          <SidebarMenu>
            {group.items.map((item) => {
              const active = isActive(item.href);

              // Item with children (collapsible)
              if (item.children) {
                return (
                  <Collapsible
                    key={item.href}
                    asChild
                    defaultOpen={active}
                    className="group/collapsible"
                  >
                    <SidebarMenuItem>
                      <CollapsibleTrigger asChild>
                        <SidebarMenuButton
                          tooltip={item.title}
                          isActive={active}
                        >
                          <item.icon className="h-4 w-4" />
                          <span>{item.title}</span>
                          <ChevronRight className="ml-auto h-4 w-4 transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90" />
                        </SidebarMenuButton>
                      </CollapsibleTrigger>
                      <CollapsibleContent>
                        <SidebarMenuSub>
                          {item.children.map((child) => (
                            <SidebarMenuSubItem key={child.href}>
                              <SidebarMenuSubButton
                                asChild
                                isActive={pathname === child.href}
                              >
                                <Link href={child.href}>
                                  <span>{child.title}</span>
                                </Link>
                              </SidebarMenuSubButton>
                            </SidebarMenuSubItem>
                          ))}
                        </SidebarMenuSub>
                      </CollapsibleContent>
                    </SidebarMenuItem>
                  </Collapsible>
                );
              }

              // Simple item
              return (
                <SidebarMenuItem key={item.href}>
                  <SidebarMenuButton
                    asChild
                    tooltip={item.title}
                    isActive={active}
                  >
                    <Link href={item.href}>
                      <item.icon className="h-4 w-4" />
                      <span>{item.title}</span>
                      {item.badge !== undefined && item.badge > 0 && (
                        <span className="ml-auto flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] font-medium text-primary-foreground">
                          {item.badge > 99 ? '99+' : item.badge}
                        </span>
                      )}
                    </Link>
                  </SidebarMenuButton>
                </SidebarMenuItem>
              );
            })}
          </SidebarMenu>
        </SidebarGroup>
      ))}
    </>
  );
}

================================================
FILE: src/components/dashboard/dashboard-quick-actions.tsx
Lines: 70
================================================

import Link from 'next/link';
import { Plus, Users, ShoppingCart, Settings } from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';

// ==========================================
// DASHBOARD QUICK ACTIONS
// ==========================================

const actions = [
  {
    title: 'Tambah Produk',
    description: 'Tambah produk baru ke toko',
    href: '/dashboard/products/new',
    icon: Plus,
    variant: 'default' as const,
  },
  {
    title: 'Lihat Pesanan',
    description: 'Kelola pesanan masuk',
    href: '/dashboard/orders',
    icon: ShoppingCart,
    variant: 'outline' as const,
  },
  {
    title: 'Tambah Pelanggan',
    description: 'Catat pelanggan baru',
    href: '/dashboard/customers/new',
    icon: Users,
    variant: 'outline' as const,
  },
  {
    title: 'Pengaturan Toko',
    description: 'Atur profil dan toko',
    href: '/dashboard/settings',
    icon: Settings,
    variant: 'outline' as const,
  },
];

export function DashboardQuickActions() {
  return (
    <Card>
      <CardHeader>
        <CardTitle>Aksi Cepat</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="grid gap-3 sm:grid-cols-2 lg:grid-cols-4">
          {actions.map((action) => (
            <Button
              key={action.href}
              asChild
              variant={action.variant}
              className="h-auto flex-col items-start gap-1 p-4"
            >
              <Link href={action.href}>
                <div className="flex items-center gap-2 w-full">
                  <action.icon className="h-4 w-4" />
                  <span className="font-medium">{action.title}</span>
                </div>
                <span className="text-xs font-normal text-muted-foreground w-full text-left">
                  {action.description}
                </span>
              </Link>
            </Button>
          ))}
        </div>
      </CardContent>
    </Card>
  );
}

================================================
FILE: src/components/dashboard/dashboard-shell.tsx
Lines: 45
================================================

import { cn } from '@/lib/cn';

// ==========================================
// DASHBOARD SHELL
// Content wrapper with consistent padding
// ==========================================

interface DashboardShellProps {
  children: React.ReactNode;
  className?: string;
}

export function DashboardShell({ children, className }: DashboardShellProps) {
  return (
    <div className={cn('flex-1 overflow-auto', className)}>
      <div className="container p-4 md:p-6 lg:p-8">
        {children}
      </div>
    </div>
  );
}

// ==========================================
// PAGE HEADER
// Title + description + actions
// ==========================================

interface PageHeaderProps {
  title: string;
  description?: string;
  children?: React.ReactNode;
}

export function PageHeader({ title, description, children }: PageHeaderProps) {
  return (
    <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-6">
      <div>
        <h1 className="text-2xl font-bold tracking-tight">{title}</h1>
        {description && (
          <p className="text-muted-foreground mt-1">{description}</p>
        )}
      </div>
      {children && <div className="flex items-center gap-2">{children}</div>}
    </div>
  );
}

================================================
FILE: src/components/dashboard/dashboard-sidebar.tsx
Lines: 116
================================================

'use client';

import Link from 'next/link';
import { Store, ChevronsUpDown, LogOut, Settings } from 'lucide-react';
import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarHeader,
  SidebarRail,
} from '@/components/ui/sidebar';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { DashboardNav } from './dashboard-nav';
import { useAuth, useLogout } from '@/hooks';
import { getInitials } from '@/lib/format';
import { siteConfig } from '@/config/site';

// ==========================================
// DASHBOARD SIDEBAR COMPONENT
// Using shadcn/ui Sidebar
// ==========================================

export function DashboardSidebar() {
  const { tenant } = useAuth();
  const { logout } = useLogout();

  return (
    <Sidebar collapsible="icon">
      {/* Header */}
      <SidebarHeader>
        <div className="flex items-center gap-2 px-2 py-1">
          <div className="flex h-8 w-8 items-center justify-center rounded-lg bg-primary">
            <Store className="h-4 w-4 text-primary-foreground" />
          </div>
          <div className="flex flex-col gap-0.5 leading-none group-data-[collapsible=icon]:hidden">
            <span className="font-semibold">{siteConfig.name}</span>
            <span className="text-xs text-muted-foreground">Dashboard</span>
          </div>
        </div>
      </SidebarHeader>

      {/* Navigation */}
      <SidebarContent>
        <DashboardNav />
      </SidebarContent>

      {/* Footer - User Menu */}
      <SidebarFooter>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <button className="flex w-full items-center gap-2 rounded-lg p-2 hover:bg-sidebar-accent transition-colors">
              <Avatar className="h-8 w-8">
                <AvatarImage src={tenant?.logo || undefined} />
                <AvatarFallback className="bg-primary text-primary-foreground text-xs">
                  {tenant?.name ? getInitials(tenant.name) : 'U'}
                </AvatarFallback>
              </Avatar>
              <div className="flex flex-1 flex-col items-start text-left group-data-[collapsible=icon]:hidden">
                <span className="text-sm font-medium truncate max-w-[140px]">
                  {tenant?.name || 'Toko'}
                </span>
                <span className="text-xs text-muted-foreground truncate max-w-[140px]">
                  {tenant?.email || 'email@example.com'}
                </span>
              </div>
              <ChevronsUpDown className="h-4 w-4 text-muted-foreground group-data-[collapsible=icon]:hidden" />
            </button>
          </DropdownMenuTrigger>
          <DropdownMenuContent
            side="top"
            align="start"
            className="w-[--radix-dropdown-menu-trigger-width] min-w-56"
          >
            <DropdownMenuLabel className="font-normal">
              <div className="flex flex-col space-y-1">
                <p className="text-sm font-medium">{tenant?.name}</p>
                <p className="text-xs text-muted-foreground">{tenant?.email}</p>
              </div>
            </DropdownMenuLabel>
            <DropdownMenuSeparator />
            <DropdownMenuGroup>
              <DropdownMenuItem asChild>
                <Link href={`/store/${tenant?.slug}`}>
                  <Store className="mr-2 h-4 w-4" />
                  Lihat Toko
                </Link>
              </DropdownMenuItem>
              <DropdownMenuItem asChild>
                <Link href="/dashboard/settings">
                  <Settings className="mr-2 h-4 w-4" />
                  Pengaturan
                </Link>
              </DropdownMenuItem>
            </DropdownMenuGroup>
            <DropdownMenuSeparator />
            <DropdownMenuItem onClick={logout} className="text-destructive">
              <LogOut className="mr-2 h-4 w-4" />
              Keluar
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </SidebarFooter>

      {/* Rail for collapsed state */}
      <SidebarRail />
    </Sidebar>
  );
}

================================================
FILE: src/components/dashboard/dashboard-stats.tsx
Lines: 125
================================================

'use client';

import {
  Package,
  Users,
  ShoppingCart,
  TrendingUp,
  AlertTriangle,
} from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Skeleton } from '@/components/ui/skeleton';
import { formatPriceShort } from '@/lib/format';
import { useDashboardStats } from '@/hooks';
import { cn } from '@/lib/cn';

// ==========================================
// DASHBOARD STATS COMPONENT
// ==========================================

export function DashboardStats() {
  const { stats, isLoading } = useDashboardStats();

  if (isLoading) {
    return <DashboardStatsSkeleton />;
  }

  if (!stats) {
    return null;
  }

  const statCards = [
    {
      title: 'Total Produk',
      value: stats.products.total,
      subtext: `${stats.products.active} aktif`,
      icon: Package,
      color: 'text-blue-500',
      bgColor: 'bg-blue-500/10',
    },
    {
      title: 'Total Pelanggan',
      value: stats.customers.total,
      icon: Users,
      color: 'text-green-500',
      bgColor: 'bg-green-500/10',
    },
    {
      title: 'Pesanan Bulan Ini',
      value: stats.orders.thisMonth,
      subtext: `${stats.orders.today} hari ini`,
      icon: ShoppingCart,
      color: 'text-orange-500',
      bgColor: 'bg-orange-500/10',
    },
    {
      title: 'Pendapatan Bulan Ini',
      value: formatPriceShort(stats.revenue.thisMonth),
      icon: TrendingUp,
      color: 'text-primary',
      bgColor: 'bg-primary/10',
    },
  ];

  return (
    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
      {statCards.map((stat) => (
        <Card key={stat.title}>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-muted-foreground">
              {stat.title}
            </CardTitle>
            <div className={cn('rounded-lg p-2', stat.bgColor)}>
              <stat.icon className={cn('h-4 w-4', stat.color)} />
            </div>
          </CardHeader>
          <CardContent>
            <div className="text-2xl font-bold">{stat.value}</div>
            {stat.subtext && (
              <p className="text-xs text-muted-foreground mt-1">
                {stat.subtext}
              </p>
            )}
          </CardContent>
        </Card>
      ))}

      {/* Low Stock Alert */}
      {stats.alerts.lowStock > 0 && (
        <Card className="md:col-span-2 lg:col-span-4 border-orange-200 bg-orange-50 dark:border-orange-900 dark:bg-orange-950">
          <CardContent className="flex items-center gap-4 p-4">
            <div className="rounded-lg bg-orange-500/20 p-2">
              <AlertTriangle className="h-5 w-5 text-orange-500" />
            </div>
            <div>
              <p className="font-medium text-orange-700 dark:text-orange-300">
                {stats.alerts.lowStock} produk dengan stok rendah
              </p>
              <p className="text-sm text-orange-600 dark:text-orange-400">
                Segera perbarui stok untuk menghindari kehabisan
              </p>
            </div>
          </CardContent>
        </Card>
      )}
    </div>
  );
}

function DashboardStatsSkeleton() {
  return (
    <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
      {Array.from({ length: 4 }).map((_, i) => (
        <Card key={i}>
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <Skeleton className="h-4 w-24" />
            <Skeleton className="h-8 w-8 rounded-lg" />
          </CardHeader>
          <CardContent>
            <Skeleton className="h-8 w-16 mb-1" />
            <Skeleton className="h-3 w-20" />
          </CardContent>
        </Card>
      ))}
    </div>
  );
}

================================================
FILE: src/components/dashboard/recent-orders.tsx
Lines: 117
================================================

import Link from 'next/link';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { ShoppingCart, ArrowRight, Clock } from 'lucide-react';
import { formatPrice } from '@/lib/format';
import { cn } from '@/lib/cn';
import type { RecentOrder } from '@/types';

// ==========================================
// RECENT ORDERS WIDGET
// ==========================================

interface RecentOrdersProps {
  orders: RecentOrder[];
}

export function RecentOrders({ orders }: RecentOrdersProps) {
  return (
    <Card>
      <CardHeader className="pb-2">
        <div className="flex items-center justify-between">
          <CardTitle className="text-base font-semibold flex items-center gap-2">
            <ShoppingCart className="h-5 w-5 text-primary" />
            Pesanan Terbaru
          </CardTitle>
          <Link href="/dashboard/orders">
            <Button variant="ghost" size="sm" className="text-xs">
              Lihat Semua
              <ArrowRight className="h-3 w-3 ml-1" />
            </Button>
          </Link>
        </div>
      </CardHeader>
      <CardContent>
        {orders.length === 0 ? (
          <div className="text-center py-8 text-muted-foreground">
            <ShoppingCart className="h-10 w-10 mx-auto mb-2 opacity-50" />
            <p className="text-sm">Belum ada pesanan</p>
          </div>
        ) : (
          <div className="space-y-3">
            {orders.map((order) => (
              <Link
                key={order.id}
                href={`/dashboard/orders/${order.id}`}
                className="flex items-center justify-between p-3 rounded-lg hover:bg-muted/50 transition-colors group"
              >
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2">
                    <span className="font-mono text-sm text-primary font-medium">
                      {order.orderNumber}
                    </span>
                    <OrderStatusBadge status={order.status} />
                  </div>
                  <p className="text-sm text-muted-foreground truncate">
                    {order.customer?.name || order.customerName || 'Guest'}
                  </p>
                </div>
                <div className="text-right ml-4">
                  <p className="font-semibold">{formatPrice(order.total)}</p>
                  <p className="text-xs text-muted-foreground flex items-center justify-end">
                    <Clock className="h-3 w-3 mr-1" />
                    {formatTime(order.createdAt)}
                  </p>
                </div>
              </Link>
            ))}
          </div>
        )}
      </CardContent>
    </Card>
  );
}

// ==========================================
// HELPER COMPONENTS
// ==========================================

function OrderStatusBadge({ status }: { status: string }) {
  const config: Record<string, { label: string; className: string }> = {
    PENDING: { label: 'Pending', className: 'bg-yellow-100 text-yellow-700' },
    CONFIRMED: { label: 'Konfirmasi', className: 'bg-blue-100 text-blue-700' },
    PROCESSING: { label: 'Proses', className: 'bg-purple-100 text-purple-700' },
    SHIPPED: { label: 'Dikirim', className: 'bg-indigo-100 text-indigo-700' },
    DELIVERED: { label: 'Selesai', className: 'bg-green-100 text-green-700' },
    COMPLETED: { label: 'Selesai', className: 'bg-green-100 text-green-700' },
    CANCELLED: { label: 'Batal', className: 'bg-red-100 text-red-700' },
  };

  const { label, className } = config[status] || config.PENDING;

  return (
    <Badge variant="secondary" className={cn('text-xs', className)}>
      {label}
    </Badge>
  );
}

function formatTime(dateString: string): string {
  const date = new Date(dateString);
  const now = new Date();
  const isToday = date.toDateString() === now.toDateString();

  if (isToday) {
    return date.toLocaleTimeString('id-ID', {
      hour: '2-digit',
      minute: '2-digit',
    });
  }

  return date.toLocaleDateString('id-ID', {
    day: 'numeric',
    month: 'short',
    hour: '2-digit',
    minute: '2-digit',
  });
}

================================================
FILE: src/components/dashboard/revenue-widget.tsx
Lines: 99
================================================

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { TrendingUp, Target } from 'lucide-react';
import { formatPrice } from '@/lib/format';
import { cn } from '@/lib/cn';

// ==========================================
// REVENUE WIDGET WITH PROGRESS BAR
// ==========================================

interface RevenueWidgetProps {
  thisWeek: number;
  thisMonth: number;
  lastMonth: number;
  trend: number;
}

export function RevenueWidget({
  thisWeek,
  thisMonth,
  lastMonth,
  trend,
}: RevenueWidgetProps) {
  const weekPercentage =
    thisMonth > 0 ? Math.min((thisWeek / thisMonth) * 100, 100) : 0;
  const monthPercentage =
    lastMonth > 0 ? Math.min((thisMonth / lastMonth) * 100, 200) : 100;
  const targetMet = thisMonth >= lastMonth;

  return (
    <Card>
      <CardHeader className="pb-2">
        <div className="flex items-center justify-between">
          <CardTitle className="text-base font-semibold flex items-center gap-2">
            <TrendingUp className="h-5 w-5 text-primary" />
            Pendapatan
          </CardTitle>
          {trend !== 0 && (
            <span
              className={cn(
                'text-xs font-medium px-2 py-1 rounded-full',
                trend > 0
                  ? 'bg-green-100 text-green-700'
                  : 'bg-red-100 text-red-700'
              )}
            >
              {trend > 0 ? '+' : ''}
              {trend}% dari bulan lalu
            </span>
          )}
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* This Week */}
        <div>
          <div className="flex justify-between text-sm mb-2">
            <span className="text-muted-foreground">Minggu ini</span>
            <span className="font-semibold">{formatPrice(thisWeek)}</span>
          </div>
          <div className="h-2 bg-muted rounded-full overflow-hidden">
            <div
              className="h-full bg-primary rounded-full transition-all duration-500"
              style={{ width: `${weekPercentage}%` }}
            />
          </div>
          <p className="text-xs text-muted-foreground mt-1">
            {weekPercentage.toFixed(0)}% dari pendapatan bulan ini
          </p>
        </div>

        {/* This Month */}
        <div>
          <div className="flex justify-between text-sm mb-2">
            <span className="text-muted-foreground">Bulan ini</span>
            <span className="font-semibold">{formatPrice(thisMonth)}</span>
          </div>
          <div className="h-2 bg-muted rounded-full overflow-hidden">
            <div
              className={cn(
                'h-full rounded-full transition-all duration-500',
                targetMet ? 'bg-green-500' : 'bg-amber-500'
              )}
              style={{ width: `${Math.min(monthPercentage, 100)}%` }}
            />
          </div>
          <div className="flex items-center justify-between mt-1">
            <p className="text-xs text-muted-foreground">
              vs bulan lalu: {formatPrice(lastMonth)}
            </p>
            {targetMet && (
              <span className="flex items-center text-xs text-green-600 font-medium">
                <Target className="h-3 w-3 mr-1" />
                Target tercapai!
              </span>
            )}
          </div>
        </div>
      </CardContent>
    </Card>
  );
}

================================================
FILE: src/components/dashboard/stats-card.tsx
Lines: 90
================================================

import Link from 'next/link';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { TrendingUp, TrendingDown, Minus } from 'lucide-react';
import { cn } from '@/lib/cn';

// ==========================================
// STATS CARD WITH TREND
// ==========================================

interface StatsCardProps {
  title: string;
  value: string | number;
  subtitle?: string;
  icon: React.ReactNode;
  href?: string;
  trend?: number;
}

export function StatsCard({
  title,
  value,
  subtitle,
  icon,
  href,
  trend,
}: StatsCardProps) {
  const content = (
    <Card
      className={cn(
        'relative overflow-hidden',
        href && 'hover:bg-muted/50 transition-colors cursor-pointer'
      )}
    >
      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
        <CardTitle className="text-sm font-medium text-muted-foreground">
          {title}
        </CardTitle>
        <div className="text-muted-foreground">{icon}</div>
      </CardHeader>
      <CardContent>
        <div className="text-2xl font-bold">{value}</div>
        <div className="flex items-center justify-between mt-1">
          {subtitle && (
            <p className="text-xs text-muted-foreground">{subtitle}</p>
          )}
          {trend !== undefined && <TrendBadge value={trend} />}
        </div>
      </CardContent>
    </Card>
  );

  if (href) {
    return <Link href={href}>{content}</Link>;
  }

  return content;
}

// ==========================================
// TREND BADGE
// ==========================================

function TrendBadge({ value }: { value: number }) {
  if (value === 0) {
    return (
      <span className="flex items-center text-xs text-muted-foreground">
        <Minus className="h-3 w-3 mr-1" />
        0%
      </span>
    );
  }

  const isPositive = value > 0;

  return (
    <span
      className={cn(
        'flex items-center text-xs font-medium',
        isPositive ? 'text-green-600' : 'text-red-600'
      )}
    >
      {isPositive ? (
        <TrendingUp className="h-3 w-3 mr-1" />
      ) : (
        <TrendingDown className="h-3 w-3 mr-1" />
      )}
      {isPositive ? '+' : ''}
      {value}%
    </span>
  );
}


################################################################
##
##  CATEGORY: Customer Components
##  Path: src/components/customers
##
################################################################

================================================
FILE: src/components/customers/index.ts
Lines: 8
================================================

// ==========================================
// CUSTOMERS COMPONENTS INDEX
// ==========================================

export { CustomersTable } from './customers-table';
export { getCustomerColumns } from './customers-table-columns';
export { CustomerForm } from './customer-form';
export { CustomerDeleteDialog } from './customer-delete-dialog';
export { CustomerDetail } from './customer-detail';

================================================
FILE: src/components/customers/customer-delete-dialog.tsx
Lines: 68
================================================

'use client';

import { Loader2, AlertTriangle } from 'lucide-react';
import {
  AlertDialog,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import { Button } from '@/components/ui/button';
import type { Customer } from '@/types';

// ==========================================
// CUSTOMER DELETE DIALOG
// ==========================================

interface CustomerDeleteDialogProps {
  customer: Customer | null;
  isOpen: boolean;
  isLoading: boolean;
  onClose: () => void;
  onConfirm: () => void;
}

export function CustomerDeleteDialog({
  customer,
  isOpen,
  isLoading,
  onClose,
  onConfirm,
}: CustomerDeleteDialogProps) {
  return (
    <AlertDialog open={isOpen} onOpenChange={onClose}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle className="flex items-center gap-2">
            <AlertTriangle className="h-5 w-5 text-destructive" />
            Hapus Pelanggan
          </AlertDialogTitle>
          <AlertDialogDescription>
            Apakah Anda yakin ingin menghapus pelanggan{' '}
            <strong>&quot;{customer?.name}&quot;</strong>? Riwayat pesanan pelanggan ini
            akan tetap tersimpan.
          </AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel disabled={isLoading}>Batal</AlertDialogCancel>
          <Button
            variant="destructive"
            onClick={onConfirm}
            disabled={isLoading}
          >
            {isLoading ? (
              <>
                <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                Menghapus...
              </>
            ) : (
              'Hapus'
            )}
          </Button>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}

================================================
FILE: src/components/customers/customer-detail.tsx
Lines: 184
================================================

'use client';

import Link from 'next/link';
import {
  Phone,
  Mail,
  MapPin,
  MessageCircle,
  Edit,
  ShoppingCart,
  StickyNote
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { formatPhone, formatPrice, formatDate, getInitials } from '@/lib/format';
import { generateWhatsAppLink } from '@/lib/format';
import type { Customer } from '@/types';

// ==========================================
// CUSTOMER DETAIL COMPONENT
// ==========================================

interface CustomerDetailProps {
  customer: Customer;
}

export function CustomerDetail({ customer }: CustomerDetailProps) {
  const handleWhatsApp = () => {
    const link = generateWhatsAppLink(customer.phone, `Halo ${customer.name},`);
    window.open(link, '_blank');
  };

  return (
    <div className="grid gap-6 lg:grid-cols-3">
      {/* Main Info */}
      <div className="lg:col-span-2 space-y-6">
        {/* Profile Card */}
        <Card>
          <CardContent className="pt-6">
            <div className="flex flex-col sm:flex-row items-start gap-6">
              {/* Avatar */}
              <Avatar className="h-20 w-20">
                <AvatarFallback className="bg-primary text-primary-foreground text-2xl">
                  {getInitials(customer.name)}
                </AvatarFallback>
              </Avatar>

              {/* Info */}
              <div className="flex-1 space-y-4">
                <div>
                  <h2 className="text-2xl font-bold">{customer.name}</h2>
                  <p className="text-muted-foreground">
                    Pelanggan sejak {formatDate(customer.createdAt)}
                  </p>
                </div>

                <div className="flex flex-wrap gap-4">
                  {/* Phone */}
                  <div className="flex items-center gap-2">
                    <Phone className="h-4 w-4 text-muted-foreground" />
                    <span>{formatPhone(customer.phone)}</span>
                  </div>

                  {/* Email */}
                  {customer.email && (
                    <div className="flex items-center gap-2">
                      <Mail className="h-4 w-4 text-muted-foreground" />
                      <span>{customer.email}</span>
                    </div>
                  )}
                </div>

                {/* Address */}
                {customer.address && (
                  <div className="flex items-start gap-2">
                    <MapPin className="h-4 w-4 text-muted-foreground mt-0.5" />
                    <span>{customer.address}</span>
                  </div>
                )}

                {/* Actions */}
                <div className="flex gap-2 pt-2">
                  <Button onClick={handleWhatsApp}>
                    <MessageCircle className="h-4 w-4 mr-2" />
                    WhatsApp
                  </Button>
                  <Button variant="outline" asChild>
                    <Link href={`/dashboard/customers/${customer.id}/edit`}>
                      <Edit className="h-4 w-4 mr-2" />
                      Edit
                    </Link>
                  </Button>
                </div>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Notes */}
        {customer.notes && (
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2 text-base">
                <StickyNote className="h-4 w-4" />
                Catatan
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="whitespace-pre-wrap text-muted-foreground">
                {customer.notes}
              </p>
            </CardContent>
          </Card>
        )}

        {/* Order History */}
        <Card>
          <CardHeader>
            <CardTitle className="flex items-center gap-2 text-base">
              <ShoppingCart className="h-4 w-4" />
              Riwayat Pesanan
            </CardTitle>
          </CardHeader>
          <CardContent>
            <div className="text-center py-8 text-muted-foreground">
              Riwayat pesanan akan ditampilkan di sini
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Sidebar */}
      <div className="space-y-6">
        {/* Statistics */}
        <Card>
          <CardHeader>
            <CardTitle className="text-base">Statistik</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div className="flex items-center justify-between">
              <span className="text-muted-foreground">Total Pesanan</span>
              <Badge variant="secondary" className="text-lg font-semibold">
                {customer.totalOrders || 0}
              </Badge>
            </div>
            <Separator />
            <div className="flex items-center justify-between">
              <span className="text-muted-foreground">Total Belanja</span>
              <span className="text-lg font-semibold text-primary">
                {formatPrice(customer.totalSpent || 0)}
              </span>
            </div>
            <Separator />
            <div className="flex items-center justify-between">
              <span className="text-muted-foreground">Rata-rata</span>
              <span className="font-medium">
                {customer.totalOrders && customer.totalOrders > 0
                  ? formatPrice((customer.totalSpent || 0) / customer.totalOrders)
                  : '-'}
              </span>
            </div>
          </CardContent>
        </Card>

        {/* Quick Actions */}
        <Card>
          <CardHeader>
            <CardTitle className="text-base">Aksi Cepat</CardTitle>
          </CardHeader>
          <CardContent className="space-y-2">
            <Button variant="outline" className="w-full justify-start" asChild>
              <Link href={`/dashboard/orders/new?customer=${customer.id}`}>
                <ShoppingCart className="h-4 w-4 mr-2" />
                Buat Pesanan
              </Link>
            </Button>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

================================================
FILE: src/components/customers/customer-form.tsx
Lines: 281
================================================

'use client';

import { useRouter } from 'next/navigation';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { Loader2, Save, ArrowLeft } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import { useCreateCustomer, useUpdateCustomer } from '@/hooks';
import { customerSchema, type CustomerFormData } from '@/lib/validations';
import type { Customer } from '@/types';

// ==========================================
// CUSTOMER FORM COMPONENT
// ==========================================

/**
 * Helper: Strip phone prefix for display/form value
 * "6281234567890" ‚Üí "81234567890"
 * "081234567890" ‚Üí "81234567890"
 */
function stripPhonePrefix(phone: string | null | undefined): string {
  if (!phone) return '';
  let cleaned = phone.replace(/\D/g, '');
  if (cleaned.startsWith('62')) {
    cleaned = cleaned.slice(2);
  } else if (cleaned.startsWith('0')) {
    cleaned = cleaned.slice(1);
  }
  return cleaned;
}

interface CustomerFormProps {
  customer?: Customer;
}

export function CustomerForm({ customer }: CustomerFormProps) {
  const router = useRouter();
  const isEditing = !!customer;

  const { createCustomer, isLoading: isCreating } = useCreateCustomer();
  const { updateCustomer, isLoading: isUpdating } = useUpdateCustomer();
  const isLoading = isCreating || isUpdating;

  const form = useForm<CustomerFormData>({
    resolver: zodResolver(customerSchema),
    defaultValues: {
      name: customer?.name || '',
      phone: stripPhonePrefix(customer?.phone),
      email: customer?.email || '',
      address: customer?.address || '',
    },
  });

  const onSubmit = async (data: CustomerFormData) => {
    try {
      // Format phone number - add 62 prefix for storage
      let phone = data.phone.replace(/\D/g, '');
      if (phone.startsWith('0')) {
        phone = phone.slice(1);
      }
      phone = '62' + phone;

      // ‚úÖ Only send fields that backend accepts (NO notes!)
      const customerData = {
        name: data.name,
        phone,
        email: data.email || undefined,
        address: data.address || undefined,
      };

      if (isEditing) {
        await updateCustomer(customer.id, customerData);
      } else {
        await createCustomer(customerData);
      }

      router.push('/dashboard/customers');
    } catch {
      // Error handled in hooks
    }
  };

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-8">
        <div className="grid gap-8 lg:grid-cols-3">
          {/* Main Form */}
          <div className="lg:col-span-2">
            <Card>
              <CardHeader>
                <CardTitle>Informasi Pelanggan</CardTitle>
                <CardDescription>
                  Data pelanggan untuk keperluan pesanan dan komunikasi
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                {/* Name */}
                <FormField
                  control={form.control}
                  name="name"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Nama Lengkap *</FormLabel>
                      <FormControl>
                        <Input placeholder="Contoh: Ahmad Budi" {...field} />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                {/* Phone */}
                <FormField
                  control={form.control}
                  name="phone"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Nomor Telepon *</FormLabel>
                      <FormControl>
                        <div className="flex">
                          <span className="inline-flex items-center px-3 rounded-l-md border border-r-0 bg-muted text-sm text-muted-foreground">
                            +62
                          </span>
                          <Input
                            type="tel"
                            placeholder="81234567890"
                            className="rounded-l-none"
                            {...field}
                            onChange={(e) => {
                              let value = e.target.value.replace(/\D/g, '');
                              if (value.startsWith('62')) {
                                value = value.slice(2);
                              } else if (value.startsWith('0')) {
                                value = value.slice(1);
                              }
                              field.onChange(value);
                            }}
                            value={field.value}
                          />
                        </div>
                      </FormControl>
                      <FormDescription>
                        Nomor WhatsApp untuk menghubungi pelanggan
                      </FormDescription>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                {/* Email */}
                <FormField
                  control={form.control}
                  name="email"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Email</FormLabel>
                      <FormControl>
                        <Input
                          type="email"
                          placeholder="pelanggan@email.com"
                          {...field}
                        />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                {/* Address */}
                <FormField
                  control={form.control}
                  name="address"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Alamat</FormLabel>
                      <FormControl>
                        <Textarea
                          placeholder="Alamat lengkap pelanggan..."
                          rows={3}
                          {...field}
                        />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                {/* Notes - DISABLED */}
                <FormItem>
                  <FormLabel className="text-muted-foreground">
                    Catatan
                    <span className="ml-2 text-xs font-normal">(Coming Soon)</span>
                  </FormLabel>
                  <FormControl>
                    <Textarea
                      placeholder="Fitur catatan akan segera hadir..."
                      rows={3}
                      disabled
                      className="bg-muted/50 cursor-not-allowed"
                    />
                  </FormControl>
                  <FormDescription className="text-muted-foreground/70">
                    Fitur ini sedang dalam pengembangan
                  </FormDescription>
                </FormItem>
              </CardContent>
            </Card>
          </div>

          {/* Sidebar */}
          <div>
            <Card>
              <CardContent className="pt-6 space-y-2">
                <Button type="submit" className="w-full" disabled={isLoading}>
                  {isLoading ? (
                    <>
                      <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                      {isEditing ? 'Menyimpan...' : 'Membuat...'}
                    </>
                  ) : (
                    <>
                      <Save className="h-4 w-4 mr-2" />
                      {isEditing ? 'Simpan Perubahan' : 'Simpan Pelanggan'}
                    </>
                  )}
                </Button>
                <Button
                  type="button"
                  variant="outline"
                  className="w-full"
                  onClick={() => router.back()}
                >
                  <ArrowLeft className="h-4 w-4 mr-2" />
                  Kembali
                </Button>
              </CardContent>
            </Card>

            {/* Stats (for editing) */}
            {isEditing && customer && (
              <Card className="mt-6">
                <CardHeader>
                  <CardTitle className="text-sm">Statistik</CardTitle>
                </CardHeader>
                <CardContent className="space-y-3 text-sm">
                  <div className="flex justify-between">
                    <span className="text-muted-foreground">Total Pesanan</span>
                    <span className="font-medium">{customer.totalOrders || 0}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-muted-foreground">Total Belanja</span>
                    <span className="font-medium">
                      Rp {(customer.totalSpent || 0).toLocaleString('id-ID')}
                    </span>
                  </div>
                </CardContent>
              </Card>
            )}
          </div>
        </div>
      </form>
    </Form>
  );
}

================================================
FILE: src/components/customers/customers-table.tsx
Lines: 241
================================================

'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import {
  ColumnFiltersState,
  SortingState,
  VisibilityState,
  flexRender,
  getCoreRowModel,
  getFilteredRowModel,
  getPaginationRowModel,
  getSortedRowModel,
  useReactTable,
} from '@tanstack/react-table';
import { Search, Trash2 } from 'lucide-react';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { getCustomerColumns } from './customers-table-columns';
import { CustomerDeleteDialog } from './customer-delete-dialog';
import { useDeleteCustomer } from '@/hooks';
import { generateWhatsAppLink } from '@/lib/format';
import { toast } from '@/providers';
import type { Customer } from '@/types';

// ==========================================
// CUSTOMERS TABLE COMPONENT
// ==========================================

interface CustomersTableProps {
  customers: Customer[];
}

export function CustomersTable({ customers }: CustomersTableProps) {
  const router = useRouter();
  const [sorting, setSorting] = useState<SortingState>([]);
  const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([]);
  const [columnVisibility, setColumnVisibility] = useState<VisibilityState>({});
  const [rowSelection, setRowSelection] = useState({});
  const [globalFilter, setGlobalFilter] = useState('');

  // Delete dialog state
  const [deleteCustomer, setDeleteCustomer] = useState<Customer | null>(null);
  const { deleteCustomer: performDelete, isLoading: isDeleting } = useDeleteCustomer();

  // Column actions
  const columnActions = {
    onView: (customer: Customer) => {
      router.push(`/dashboard/customers/${customer.id}`);
    },
    onEdit: (customer: Customer) => {
      router.push(`/dashboard/customers/${customer.id}/edit`);
    },
    onDelete: (customer: Customer) => {
      setDeleteCustomer(customer);
    },
    onWhatsApp: (customer: Customer) => {
      const link = generateWhatsAppLink(customer.phone, `Halo ${customer.name},`);
      window.open(link, '_blank');
    },
  };

  const columns = getCustomerColumns(columnActions);

  // eslint-disable-next-line react-hooks/incompatible-library
  const table = useReactTable({
    data: customers,
    columns,
    onSortingChange: setSorting,
    onColumnFiltersChange: setColumnFilters,
    getCoreRowModel: getCoreRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    getSortedRowModel: getSortedRowModel(),
    getFilteredRowModel: getFilteredRowModel(),
    onColumnVisibilityChange: setColumnVisibility,
    onRowSelectionChange: setRowSelection,
    globalFilterFn: 'includesString',
    onGlobalFilterChange: setGlobalFilter,
    state: {
      sorting,
      columnFilters,
      columnVisibility,
      rowSelection,
      globalFilter,
    },
  });

  // Handle delete
  const handleDelete = async () => {
    if (!deleteCustomer) return;

    const success = await performDelete(deleteCustomer.id);
    if (success) {
      setDeleteCustomer(null);
      router.refresh();
    }
  };

  // Handle bulk delete
  const handleBulkDelete = async () => {
    const selectedRows = table.getFilteredSelectedRowModel().rows;
    const ids = selectedRows.map((row) => row.original.id);

    for (const id of ids) {
      await performDelete(id);
    }

    setRowSelection({});
    router.refresh();
    toast.success(`${ids.length} pelanggan berhasil dihapus`);
  };

  const selectedCount = table.getFilteredSelectedRowModel().rows.length;

  return (
    <div className="space-y-4">
      {/* Toolbar */}
      <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        {/* Search */}
        <div className="relative w-full sm:w-80">
          <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
          <Input
            placeholder="Cari nama, telepon, email..."
            value={globalFilter}
            onChange={(e) => setGlobalFilter(e.target.value)}
            className="pl-8"
          />
        </div>

        {/* Bulk Actions */}
        {selectedCount > 0 && (
          <div className="flex items-center gap-2">
            <span className="text-sm text-muted-foreground">
              {selectedCount} dipilih
            </span>
            <Button
              variant="destructive"
              size="sm"
              onClick={handleBulkDelete}
            >
              <Trash2 className="h-4 w-4 mr-2" />
              Hapus
            </Button>
          </div>
        )}
      </div>

      {/* Table */}
      <div className="rounded-md border">
        <Table>
          <TableHeader>
            {table.getHeaderGroups().map((headerGroup) => (
              <TableRow key={headerGroup.id}>
                {headerGroup.headers.map((header) => (
                  <TableHead key={header.id}>
                    {header.isPlaceholder
                      ? null
                      : flexRender(
                        header.column.columnDef.header,
                        header.getContext()
                      )}
                  </TableHead>
                ))}
              </TableRow>
            ))}
          </TableHeader>
          <TableBody>
            {table.getRowModel().rows?.length ? (
              table.getRowModel().rows.map((row) => (
                <TableRow
                  key={row.id}
                  data-state={row.getIsSelected() && 'selected'}
                >
                  {row.getVisibleCells().map((cell) => (
                    <TableCell key={cell.id}>
                      {flexRender(
                        cell.column.columnDef.cell,
                        cell.getContext()
                      )}
                    </TableCell>
                  ))}
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell
                  colSpan={columns.length}
                  className="h-24 text-center"
                >
                  Tidak ada pelanggan ditemukan.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>

      {/* Pagination */}
      <div className="flex items-center justify-between">
        <div className="text-sm text-muted-foreground">
          {table.getFilteredSelectedRowModel().rows.length} dari{' '}
          {table.getFilteredRowModel().rows.length} baris dipilih.
        </div>
        <div className="flex items-center space-x-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.previousPage()}
            disabled={!table.getCanPreviousPage()}
          >
            Sebelumnya
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.nextPage()}
            disabled={!table.getCanNextPage()}
          >
            Selanjutnya
          </Button>
        </div>
      </div>

      {/* Delete Dialog */}
      <CustomerDeleteDialog
        customer={deleteCustomer}
        isOpen={!!deleteCustomer}
        isLoading={isDeleting}
        onClose={() => setDeleteCustomer(null)}
        onConfirm={handleDelete}
      />
    </div>
  );
}

================================================
FILE: src/components/customers/customers-table-columns.tsx
Lines: 220
================================================

'use client';

import { ColumnDef } from '@tanstack/react-table';
import { MoreHorizontal, ArrowUpDown, Phone, MessageCircle } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Checkbox } from '@/components/ui/checkbox';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { formatPhone, formatPrice, formatDateShort, getInitials } from '@/lib/format';
import type { Customer } from '@/types';

// ==========================================
// CUSTOMERS TABLE COLUMNS
// ==========================================

interface ColumnActions {
  onView: (customer: Customer) => void;
  onEdit: (customer: Customer) => void;
  onDelete: (customer: Customer) => void;
  onWhatsApp: (customer: Customer) => void;
}

export function getCustomerColumns(actions: ColumnActions): ColumnDef<Customer>[] {
  return [
    // Checkbox
    {
      id: 'select',
      header: ({ table }) => (
        <Checkbox
          checked={
            table.getIsAllPageRowsSelected() ||
            (table.getIsSomePageRowsSelected() && 'indeterminate')
          }
          onCheckedChange={(value) => table.toggleAllPageRowsSelected(!!value)}
          aria-label="Select all"
        />
      ),
      cell: ({ row }) => (
        <Checkbox
          checked={row.getIsSelected()}
          onCheckedChange={(value) => row.toggleSelected(!!value)}
          aria-label="Select row"
        />
      ),
      enableSorting: false,
      enableHiding: false,
    },

    // Name
    {
      accessorKey: 'name',
      header: ({ column }) => (
        <Button
          variant="ghost"
          onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
        >
          Pelanggan
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      cell: ({ row }) => {
        const customer = row.original;
        return (
          <div className="flex items-center gap-3">
            <Avatar className="h-9 w-9">
              <AvatarFallback className="bg-primary/10 text-primary text-sm">
                {getInitials(customer.name)}
              </AvatarFallback>
            </Avatar>
            <div>
              <p className="font-medium">{customer.name}</p>
              {customer.email && (
                <p className="text-xs text-muted-foreground">{customer.email}</p>
              )}
            </div>
          </div>
        );
      },
    },

    // Phone
    {
      accessorKey: 'phone',
      header: 'Telepon',
      cell: ({ row }) => {
        const phone = row.getValue('phone') as string;
        return (
          <div className="flex items-center gap-2">
            <Phone className="h-4 w-4 text-muted-foreground" />
            <span>{formatPhone(phone)}</span>
          </div>
        );
      },
    },

    // Address
    {
      accessorKey: 'address',
      header: 'Alamat',
      cell: ({ row }) => {
        const address = row.getValue('address') as string | null;
        return address ? (
          <span className="max-w-[200px] truncate block">{address}</span>
        ) : (
          <span className="text-muted-foreground">-</span>
        );
      },
    },

    // Total Orders
    {
      accessorKey: 'totalOrders',
      header: ({ column }) => (
        <Button
          variant="ghost"
          onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
        >
          Pesanan
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      cell: ({ row }) => {
        const total = row.getValue('totalOrders') as number;
        return <span>{total || 0}</span>;
      },
    },

    // Total Spent
    {
      accessorKey: 'totalSpent',
      header: ({ column }) => (
        <Button
          variant="ghost"
          onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
        >
          Total Belanja
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      cell: ({ row }) => {
        const total = row.getValue('totalSpent') as number;
        return <span className="font-medium">{formatPrice(total || 0)}</span>;
      },
    },

    // Created At
    {
      accessorKey: 'createdAt',
      header: ({ column }) => (
        <Button
          variant="ghost"
          onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
        >
          Terdaftar
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      cell: ({ row }) => {
        const date = row.getValue('createdAt') as string;
        return <span className="text-muted-foreground">{formatDateShort(date)}</span>;
      },
    },

    // Actions
    {
      id: 'actions',
      enableHiding: false,
      cell: ({ row }) => {
        const customer = row.original;

        return (
          <div className="flex items-center gap-1">
            {/* Quick WhatsApp */}
            <Button
              variant="ghost"
              size="icon"
              className="h-8 w-8"
              onClick={() => actions.onWhatsApp(customer)}
              title="Hubungi via WhatsApp"
            >
              <MessageCircle className="h-4 w-4 text-green-600" />
            </Button>

            {/* More Actions */}
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <Button variant="ghost" className="h-8 w-8 p-0">
                  <span className="sr-only">Buka menu</span>
                  <MoreHorizontal className="h-4 w-4" />
                </Button>
              </DropdownMenuTrigger>
              <DropdownMenuContent align="end">
                <DropdownMenuLabel>Aksi</DropdownMenuLabel>
                <DropdownMenuItem onClick={() => actions.onView(customer)}>
                  Lihat Detail
                </DropdownMenuItem>
                <DropdownMenuItem onClick={() => actions.onEdit(customer)}>
                  Edit
                </DropdownMenuItem>
                <DropdownMenuSeparator />
                <DropdownMenuItem
                  onClick={() => actions.onDelete(customer)}
                  className="text-destructive"
                >
                  Hapus
                </DropdownMenuItem>
              </DropdownMenuContent>
            </DropdownMenu>
          </div>
        );
      },
    },
  ];
}


################################################################
##
##  CATEGORY: Order Components
##  Path: src/components/orders
##
################################################################

================================================
FILE: src/components/orders/index.ts
Lines: 23
================================================

// ==========================================
// ORDERS COMPONENTS INDEX
// ==========================================

// Tables
export { OrdersTable } from './orders-table';
export { OrderItemsTable } from './order-items-table';

// Detail & Forms
export { OrderDetail } from './order-detail';
export { OrderForm } from './order-form';

// Status
export { OrderStatusBadge } from './order-status-badge';
export { OrderStatusSelect } from './order-status-select';

// Dialogs
export { OrderCancelDialog } from './order-cancel-dialog';

// Invoice (NEW)
export { InvoiceTemplate } from './invoice-template';
export { InvoiceModal } from './invoice-modal';
export type { InvoiceTemplateProps } from './invoice-template';
export type { InvoiceModalProps } from './invoice-modal';

================================================
FILE: src/components/orders/invoice-modal.tsx
Lines: 278
================================================

'use client';

import { useState, useRef, useCallback } from 'react';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Loader2, Download, Share2, Printer } from 'lucide-react';
import { toast } from '@/providers';
import { InvoiceTemplate } from './invoice-template';
import {
  generateInvoiceImage,
  uploadInvoiceToCloudinary,
  downloadInvoiceImage,
  openWhatsAppWithInvoice,
} from '@/lib/invoice';
import { normalizePhone } from '@/lib/format';
import type { Order, Tenant } from '@/types';

export interface InvoiceModalProps {
  order: Order;
  tenant: Pick<Tenant, 'name' | 'logo' | 'phone' | 'whatsapp' | 'address'>;
  isOpen: boolean;
  onClose: () => void;
}

type ActionState = 'idle' | 'generating' | 'uploading';

export function InvoiceModal({ order, tenant, isOpen, onClose }: InvoiceModalProps) {
  const invoiceRef = useRef<HTMLDivElement>(null);
  const [actionState, setActionState] = useState<ActionState>('idle');
  const [invoiceUrl, setInvoiceUrl] = useState<string | null>(null);

  const handleClose = useCallback(() => {
    setActionState('idle');
    setInvoiceUrl(null);
    onClose();
  }, [onClose]);

  const generateImage = useCallback(async (): Promise<Blob | null> => {
    if (!invoiceRef.current) {
      toast.error('Invoice template tidak ditemukan');
      return null;
    }

    setActionState('generating');
    try {
      const blob = await generateInvoiceImage(invoiceRef.current);
      return blob;
    } catch (error) {
      console.error('Failed to generate invoice:', error);
      toast.error('Gagal membuat invoice');
      setActionState('idle');
      return null;
    }
  }, []);

  // Download
  const handleDownload = useCallback(async () => {
    const blob = await generateImage();
    if (!blob) return;

    try {
      downloadInvoiceImage(blob, order.orderNumber);
      setActionState('idle');
      toast.success('Invoice berhasil diunduh');
    } catch (error) {
      console.error('Download failed:', error);
      toast.error('Gagal mengunduh invoice');
      setActionState('idle');
    }
  }, [generateImage, order.orderNumber]);

  // Print invoice - Hidden iframe, PDF preview centered
  const handlePrint = useCallback(() => {
    if (!invoiceRef.current) {
      toast.error('Invoice template tidak ditemukan');
      return;
    }

    const invoiceHTML = invoiceRef.current.outerHTML;

    const iframe = document.createElement('iframe');
    iframe.style.cssText = 'position:fixed;right:0;bottom:0;width:0;height:0;border:0;';
    document.body.appendChild(iframe);

    const iframeDoc = iframe.contentWindow?.document;
    if (!iframeDoc) {
      toast.error('Gagal membuat print preview');
      document.body.removeChild(iframe);
      return;
    }

    iframeDoc.open();
    iframeDoc.write(`<!DOCTYPE html>
<html>
<head>
  <title>Invoice ${order.orderNumber}</title>
  <style>
    @page {
      size: A4;
      margin: 20mm 15mm;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      background: white;
      font-family: Arial, sans-serif;
    }
    body {
      padding: 0;
    }
    .invoice-wrapper {
      width: 500px;
      margin: 0 auto;
    }
  </style>
</head>
<body>
  <div class="invoice-wrapper">
    ${invoiceHTML}
  </div>
</body>
</html>`);
    iframeDoc.close();

    setTimeout(() => {
      iframe.contentWindow?.focus();
      iframe.contentWindow?.print();
      setTimeout(() => {
        try {
          document.body.removeChild(iframe);
        } catch {
          // Already removed
        }
      }, 1000);
    }, 300);
  }, [order.orderNumber]);

  // WhatsApp + Image
  const handleShareWhatsApp = useCallback(async () => {
    const customerPhone = order.customer?.phone || order.customerPhone;
    if (!customerPhone) {
      toast.error('Nomor telepon pelanggan tidak tersedia');
      return;
    }

    const blob = await generateImage();
    if (!blob) return;

    setActionState('uploading');
    try {
      const uploadedUrl = await uploadInvoiceToCloudinary(blob, order.orderNumber);
      setInvoiceUrl(uploadedUrl);

      const normalizedPhone = normalizePhone(customerPhone);
      openWhatsAppWithInvoice(normalizedPhone, order, tenant.name, uploadedUrl);

      setActionState('idle');
      toast.success('Invoice berhasil dibagikan');
    } catch (error) {
      console.error('Share failed:', error);
      toast.error('Gagal membagikan invoice');
      setActionState('idle');
    }
  }, [generateImage, order, tenant.name]);

  // WhatsApp Text Only
  const handleShareTextOnly = useCallback(() => {
    const customerPhone = order.customer?.phone || order.customerPhone;
    if (!customerPhone) {
      toast.error('Nomor telepon pelanggan tidak tersedia');
      return;
    }

    const normalizedPhone = normalizePhone(customerPhone);
    openWhatsAppWithInvoice(normalizedPhone, order, tenant.name);
    toast.success('WhatsApp dibuka');
  }, [order, tenant.name]);

  const isLoading = actionState === 'generating' || actionState === 'uploading';

  return (
    <Dialog open={isOpen} onOpenChange={handleClose}>
      <DialogContent className="max-w-2xl max-h-[85vh] p-0 gap-0 overflow-hidden">
        <DialogHeader className="px-4 py-3 border-b bg-white">
          <DialogTitle className="text-base font-semibold">
            Invoice {order.orderNumber}
          </DialogTitle>
        </DialogHeader>

        <div className="flex-1 overflow-auto bg-gray-100 p-4 max-h-[55vh]">
          <div className="flex justify-center">
            <div className="shadow-lg bg-white transform scale-[0.85] origin-top">
              <InvoiceTemplate ref={invoiceRef} order={order} tenant={tenant} />
            </div>
          </div>
        </div>

        <div className="px-4 py-3 border-t bg-white space-y-2">
          <div className="flex gap-2">
            <Button
              variant="outline"
              size="sm"
              onClick={handleDownload}
              disabled={isLoading}
              className="flex-1"
            >
              {actionState === 'generating' ? (
                <Loader2 className="h-4 w-4 mr-2 animate-spin" />
              ) : (
                <Download className="h-4 w-4 mr-2" />
              )}
              Download
            </Button>

            <Button
              variant="outline"
              size="sm"
              onClick={handlePrint}
              disabled={isLoading}
              className="flex-1"
            >
              <Printer className="h-4 w-4 mr-2" />
              Print
            </Button>
          </div>

          <div className="flex gap-2">
            <Button
              size="sm"
              onClick={handleShareWhatsApp}
              disabled={isLoading}
              className="flex-1 bg-green-600 hover:bg-green-700"
            >
              {actionState === 'uploading' ? (
                <Loader2 className="h-4 w-4 mr-2 animate-spin" />
              ) : (
                <Share2 className="h-4 w-4 mr-2" />
              )}
              WhatsApp + Gambar
            </Button>

            <Button
              variant="secondary"
              size="sm"
              onClick={handleShareTextOnly}
              disabled={isLoading}
              className="flex-1"
            >
              <Share2 className="h-4 w-4 mr-2" />
              WhatsApp Teks
            </Button>
          </div>

          {invoiceUrl && (
            <div className="p-2 bg-green-50 rounded text-xs">
              <span className="text-green-700">‚úì Uploaded: </span>
              <a
                href={invoiceUrl}
                target="_blank"
                rel="noopener noreferrer"
                className="text-green-600 hover:underline break-all"
              >
                {invoiceUrl.slice(0, 50)}...
              </a>
            </div>
          )}
        </div>
      </DialogContent>
    </Dialog>
  );
}

================================================
FILE: src/components/orders/invoice-template.tsx
Lines: 434
================================================

'use client';

import { forwardRef } from 'react';
import Image from 'next/image';
import { formatPrice, formatDate } from '@/lib/format';
import { getLogoUrl } from '@/lib/cloudinary';
import type { Order, Tenant } from '@/types';

// ==========================================
// INVOICE TEMPLATE - HTML2CANVAS COMPATIBLE
// Uses inline HEX colors (no lab() colors)
// ==========================================

export interface InvoiceTemplateProps {
  order: Order;
  tenant: Pick<Tenant, 'name' | 'logo' | 'phone' | 'whatsapp' | 'address'>;
}

// Color constants (HEX - html2canvas compatible)
const COLORS = {
  pink500: '#ec4899',
  pink600: '#db2777',
  pink50: '#fdf2f8',
  pink100: '#fce7f3',
  gray50: '#f9fafb',
  gray100: '#f3f4f6',
  gray200: '#e5e7eb',
  gray400: '#9ca3af',
  gray500: '#6b7280',
  gray600: '#4b5563',
  gray700: '#374151',
  gray900: '#111827',
  green100: '#dcfce7',
  green600: '#16a34a',
  green700: '#15803d',
  yellow100: '#fef9c3',
  yellow700: '#a16207',
  orange100: '#ffedd5',
  orange700: '#c2410c',
  red100: '#fee2e2',
  red700: '#b91c1c',
  white: '#ffffff',
};

export const InvoiceTemplate = forwardRef<HTMLDivElement, InvoiceTemplateProps>(
  function InvoiceTemplate({ order, tenant }, ref) {
    const customerName = order.customer?.name || order.customerName || 'Pelanggan';
    const customerPhone = order.customer?.phone || order.customerPhone || '-';
    const customerAddress = order.customer?.address || '-';

    return (
      <div
        ref={ref}
        style={{
          backgroundColor: COLORS.white,
          padding: '24px',
          width: '500px',
          fontFamily: 'Arial, sans-serif',
          fontSize: '14px',
          color: COLORS.gray900,
        }}
      >
        {/* Header */}
        <div
          style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'flex-start',
            borderBottom: `2px solid ${COLORS.pink500}`,
            paddingBottom: '12px',
            marginBottom: '16px',
          }}
        >
          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
            {tenant.logo ? (
              <Image
                src={getLogoUrl(tenant.logo)}
                alt={tenant.name}
                width={48}
                height={48}
                style={{
                  objectFit: 'contain',
                  borderRadius: '4px',
                }}
                unoptimized
              />
            ) : (
              <div
                style={{
                  width: '48px',
                  height: '48px',
                  backgroundColor: COLORS.pink100,
                  borderRadius: '4px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                }}
              >
                <span
                  style={{
                    color: COLORS.pink600,
                    fontWeight: 'bold',
                    fontSize: '18px',
                  }}
                >
                  {tenant.name.charAt(0).toUpperCase()}
                </span>
              </div>
            )}
            <div>
              <h1
                style={{
                  fontSize: '16px',
                  fontWeight: 'bold',
                  color: COLORS.gray900,
                  margin: 0,
                }}
              >
                {tenant.name}
              </h1>
              {tenant.phone && (
                <p style={{ fontSize: '12px', color: COLORS.gray600, margin: '2px 0 0 0' }}>
                  {tenant.phone}
                </p>
              )}
              {tenant.address && (
                <p
                  style={{
                    fontSize: '12px',
                    color: COLORS.gray600,
                    margin: '2px 0 0 0',
                    maxWidth: '180px',
                    lineHeight: '1.3',
                  }}
                >
                  {tenant.address}
                </p>
              )}
            </div>
          </div>
          <div style={{ textAlign: 'right' }}>
            <h2
              style={{
                fontSize: '20px',
                fontWeight: 'bold',
                color: COLORS.pink600,
                margin: 0,
              }}
            >
              INVOICE
            </h2>
            <p style={{ fontSize: '12px', color: COLORS.gray600, margin: '4px 0 0 0' }}>
              #{order.orderNumber}
            </p>
            <p style={{ fontSize: '12px', color: COLORS.gray600, margin: '2px 0 0 0' }}>
              {formatDate(order.createdAt)}
            </p>
          </div>
        </div>

        {/* Customer Info */}
        <div
          style={{
            marginBottom: '16px',
            backgroundColor: COLORS.gray50,
            padding: '12px',
            borderRadius: '4px',
          }}
        >
          <h3
            style={{
              fontSize: '11px',
              fontWeight: '600',
              color: COLORS.gray500,
              margin: '0 0 4px 0',
              textTransform: 'uppercase',
            }}
          >
            Ditagihkan Kepada:
          </h3>
          <p style={{ fontWeight: '600', color: COLORS.gray900, margin: '0 0 2px 0' }}>
            {customerName}
          </p>
          <p style={{ fontSize: '12px', color: COLORS.gray600, margin: '0 0 2px 0' }}>
            {customerPhone}
          </p>
          {customerAddress !== '-' && (
            <p style={{ fontSize: '12px', color: COLORS.gray600, margin: 0 }}>
              {customerAddress}
            </p>
          )}
        </div>

        {/* Items Table */}
        <table
          style={{
            width: '100%',
            marginBottom: '16px',
            fontSize: '12px',
            borderCollapse: 'collapse',
          }}
        >
          <thead>
            <tr style={{ backgroundColor: COLORS.pink50 }}>
              <th
                style={{
                  textAlign: 'left',
                  padding: '8px',
                  fontWeight: '600',
                  color: COLORS.gray700,
                  borderTopLeftRadius: '4px',
                }}
              >
                Item
              </th>
              <th
                style={{
                  textAlign: 'center',
                  padding: '8px 4px',
                  fontWeight: '600',
                  color: COLORS.gray700,
                  width: '40px',
                }}
              >
                Qty
              </th>
              <th
                style={{
                  textAlign: 'right',
                  padding: '8px',
                  fontWeight: '600',
                  color: COLORS.gray700,
                  width: '80px',
                }}
              >
                Harga
              </th>
              <th
                style={{
                  textAlign: 'right',
                  padding: '8px',
                  fontWeight: '600',
                  color: COLORS.gray700,
                  width: '90px',
                  borderTopRightRadius: '4px',
                }}
              >
                Subtotal
              </th>
            </tr>
          </thead>
          <tbody>
            {order.items.map((item, index) => (
              <tr
                key={item.id}
                style={{
                  backgroundColor: index % 2 === 0 ? COLORS.white : COLORS.gray50,
                }}
              >
                <td style={{ padding: '8px' }}>
                  <p style={{ fontWeight: '500', color: COLORS.gray900, margin: 0 }}>
                    {item.name}
                  </p>
                  {item.notes && (
                    <p style={{ fontSize: '10px', color: COLORS.gray500, margin: '2px 0 0 0' }}>
                      {item.notes}
                    </p>
                  )}
                </td>
                <td
                  style={{
                    padding: '8px 4px',
                    textAlign: 'center',
                    color: COLORS.gray700,
                  }}
                >
                  {item.qty}
                </td>
                <td
                  style={{
                    padding: '8px',
                    textAlign: 'right',
                    color: COLORS.gray700,
                  }}
                >
                  {formatPrice(item.price)}
                </td>
                <td
                  style={{
                    padding: '8px',
                    textAlign: 'right',
                    fontWeight: '500',
                    color: COLORS.gray900,
                  }}
                >
                  {formatPrice(item.subtotal)}
                </td>
              </tr>
            ))}
          </tbody>
        </table>

        {/* Totals */}
        <div
          style={{
            borderTop: `1px solid ${COLORS.gray200}`,
            paddingTop: '12px',
          }}
        >
          <div style={{ display: 'flex', justifyContent: 'flex-end' }}>
            <div style={{ width: '180px', fontSize: '12px' }}>
              <div
                style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  padding: '4px 0',
                }}
              >
                <span style={{ color: COLORS.gray600 }}>Subtotal</span>
                <span style={{ color: COLORS.gray900 }}>{formatPrice(order.subtotal)}</span>
              </div>
              {order.discount > 0 && (
                <div
                  style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    padding: '4px 0',
                    color: COLORS.green600,
                  }}
                >
                  <span>Diskon</span>
                  <span>-{formatPrice(order.discount)}</span>
                </div>
              )}
              {order.tax > 0 && (
                <div
                  style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    padding: '4px 0',
                  }}
                >
                  <span style={{ color: COLORS.gray600 }}>Pajak</span>
                  <span style={{ color: COLORS.gray900 }}>{formatPrice(order.tax)}</span>
                </div>
              )}
              <div
                style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  padding: '8px 0',
                  borderTop: `2px solid ${COLORS.pink500}`,
                  marginTop: '4px',
                }}
              >
                <span style={{ fontWeight: 'bold', color: COLORS.gray900 }}>TOTAL</span>
                <span style={{ fontWeight: 'bold', color: COLORS.pink600 }}>
                  {formatPrice(order.total)}
                </span>
              </div>
            </div>
          </div>
        </div>

        {/* Payment Status */}
        <div
          style={{
            marginTop: '16px',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            fontSize: '12px',
          }}
        >
          <div>
            <span style={{ color: COLORS.gray500 }}>Status: </span>
            <PaymentBadge status={order.paymentStatus} />
          </div>
          {order.paymentMethod && (
            <span style={{ color: COLORS.gray500 }}>Metode: {order.paymentMethod}</span>
          )}
        </div>

        {/* Footer */}
        <div
          style={{
            marginTop: '16px',
            paddingTop: '12px',
            borderTop: `1px solid ${COLORS.gray200}`,
            textAlign: 'center',
          }}
        >
          <p style={{ fontSize: '12px', color: COLORS.gray500, margin: 0 }}>
            Terima kasih atas pesanan Anda!
          </p>
          <p style={{ fontSize: '10px', color: COLORS.gray400, margin: '4px 0 0 0' }}>
            Powered by fibidy.com
          </p>
        </div>
      </div>
    );
  }
);

// Payment Badge with inline styles
function PaymentBadge({ status }: { status: string }) {
  const config: Record<string, { label: string; bg: string; color: string }> = {
    PENDING: { label: 'Menunggu', bg: COLORS.yellow100, color: COLORS.yellow700 },
    PAID: { label: 'Lunas', bg: COLORS.green100, color: COLORS.green700 },
    PARTIAL: { label: 'Sebagian', bg: COLORS.orange100, color: COLORS.orange700 },
    FAILED: { label: 'Gagal', bg: COLORS.red100, color: COLORS.red700 },
  };

  const { label, bg, color } = config[status] || {
    label: status,
    bg: COLORS.gray100,
    color: COLORS.gray700,
  };

  return (
    <span
      style={{
        display: 'inline-flex',
        padding: '2px 8px',
        fontSize: '10px',
        fontWeight: '600',
        borderRadius: '9999px',
        backgroundColor: bg,
        color: color,
      }}
    >
      {label}
    </span>
  );
}

================================================
FILE: src/components/orders/order-cancel-dialog.tsx
Lines: 68
================================================

'use client';

import { Loader2, AlertTriangle } from 'lucide-react';
import {
  AlertDialog,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import { Button } from '@/components/ui/button';
import type { OrderListItem } from '@/types';

// ==========================================
// ORDER CANCEL DIALOG
// ==========================================

interface OrderCancelDialogProps {
  order: OrderListItem | null;
  isOpen: boolean;
  isLoading: boolean;
  onClose: () => void;
  onConfirm: () => void;
}

export function OrderCancelDialog({
  order,
  isOpen,
  isLoading,
  onClose,
  onConfirm,
}: OrderCancelDialogProps) {
  return (
    <AlertDialog open={isOpen} onOpenChange={onClose}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle className="flex items-center gap-2">
            <AlertTriangle className="h-5 w-5 text-destructive" />
            Batalkan Pesanan
          </AlertDialogTitle>
          <AlertDialogDescription>
            Apakah Anda yakin ingin membatalkan pesanan{' '}
            <strong>#{order?.orderNumber}</strong>? Tindakan ini tidak dapat
            dibatalkan.
          </AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel disabled={isLoading}>Tidak</AlertDialogCancel>
          <Button
            variant="destructive"
            onClick={onConfirm}
            disabled={isLoading}
          >
            {isLoading ? (
              <>
                <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                Membatalkan...
              </>
            ) : (
              'Ya, Batalkan'
            )}
          </Button>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}

================================================
FILE: src/components/orders/order-detail.tsx
Lines: 241
================================================

'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import {
  Phone,
  MapPin,
  Calendar,
  MessageCircle,
  Printer,
  XCircle,
  StickyNote,
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Separator } from '@/components/ui/separator';
import { OrderStatusSelect, PaymentStatusSelect } from './order-status-select';
import { OrderItemsTable } from './order-items-table';
import { OrderCancelDialog } from './order-cancel-dialog';
import { InvoiceModal } from './invoice-modal';
import { formatPhone, formatDateTime, formatPrice, generateWhatsAppLink } from '@/lib/format';
import { useCancelOrder } from '@/hooks';
import { useCurrentTenant } from '@/stores';
import type { Order } from '@/types';

// ==========================================
// ORDER DETAIL COMPONENT (WITH INVOICE)
// ==========================================

interface OrderDetailProps {
  order: Order;
}

export function OrderDetail({ order }: OrderDetailProps) {
  const router = useRouter();
  const tenant = useCurrentTenant();
  const [showCancelDialog, setShowCancelDialog] = useState(false);
  const [showInvoiceModal, setShowInvoiceModal] = useState(false);
  const { cancelOrder, isLoading: isCancelling } = useCancelOrder();

  const handleWhatsApp = () => {
    const phone = order.customer?.phone || order.customerPhone;
    if (!phone) return;

    const message = `Halo ${order.customer?.name || order.customerName},

Terima kasih atas pesanan Anda #${order.orderNumber}

Total: ${formatPrice(order.total)}
Status: ${order.status}

Ada yang bisa kami bantu?`;

    const link = generateWhatsAppLink(phone, message);
    window.open(link, '_blank');
  };

  const handleCancel = async () => {
    const success = await cancelOrder(order.id);
    if (success) {
      setShowCancelDialog(false);
      router.refresh();
    }
  };

  const canCancel = order.status !== 'CANCELLED' && order.status !== 'COMPLETED';

  return (
    <div className="grid gap-6 lg:grid-cols-3">
      {/* Main Content */}
      <div className="lg:col-span-2 space-y-6">
        {/* Order Header */}
        <Card>
          <CardHeader>
            <div>
              <CardTitle className="text-2xl font-bold">
                #{order.orderNumber}
              </CardTitle>
              <p className="text-sm text-muted-foreground flex items-center gap-1 mt-1">
                <Calendar className="h-4 w-4" />
                {formatDateTime(order.createdAt)}
              </p>
            </div>
          </CardHeader>
        </Card>

        {/* Order Items */}
        <Card>
          <CardHeader>
            <CardTitle>Daftar Produk</CardTitle>
          </CardHeader>
          <CardContent>
            <OrderItemsTable
              items={order.items || []}
              subtotal={order.subtotal}
              discount={order.discount}
              shippingCost={0}
              total={order.total}
            />
          </CardContent>
        </Card>

        {/* Notes */}
        {order.notes && (
          <Card>
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <StickyNote className="h-4 w-4" />
                Catatan Pesanan
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="whitespace-pre-wrap text-muted-foreground">
                {order.notes}
              </p>
            </CardContent>
          </Card>
        )}
      </div>

      {/* Sidebar */}
      <div className="space-y-6">
        {/* Customer Info */}
        <Card>
          <CardHeader>
            <CardTitle>Informasi Pelanggan</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div>
              <p className="font-medium text-lg">
                {order.customer?.name || order.customerName || 'Guest'}
              </p>
            </div>

            {(order.customer?.phone || order.customerPhone) && (
              <div className="flex items-center gap-2 text-sm">
                <Phone className="h-4 w-4 text-muted-foreground" />
                <span>{formatPhone(order.customer?.phone || order.customerPhone || '')}</span>
              </div>
            )}

            {order.customer?.address && (
              <div className="flex items-start gap-2 text-sm">
                <MapPin className="h-4 w-4 text-muted-foreground mt-0.5" />
                <span>{order.customer.address}</span>
              </div>
            )}

            {(order.customer?.phone || order.customerPhone) && (
              <Button onClick={handleWhatsApp} className="w-full">
                <MessageCircle className="h-4 w-4 mr-2" />
                Hubungi via WhatsApp
              </Button>
            )}
          </CardContent>
        </Card>

        {/* Status Management */}
        <Card>
          <CardHeader>
            <CardTitle>Kelola Status</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            <div>
              <label className="text-sm font-medium mb-2 block">
                Status Pesanan
              </label>
              <OrderStatusSelect
                orderId={order.id}
                currentStatus={order.status}
              />
            </div>

            <Separator />

            <div>
              <label className="text-sm font-medium mb-2 block">
                Status Pembayaran
              </label>
              <PaymentStatusSelect
                orderId={order.id}
                currentStatus={order.paymentStatus}
                orderStatus={order.status}
              />
            </div>
          </CardContent>
        </Card>

        {/* Actions */}
        <Card>
          <CardContent className="pt-6 space-y-2">
            {/* ‚úÖ INVOICE BUTTON - NOW ENABLED */}
            <Button
              variant="outline"
              className="w-full"
              onClick={() => setShowInvoiceModal(true)}
            >
              <Printer className="h-4 w-4 mr-2" />
              Cetak Invoice
            </Button>

            {canCancel && (
              <Button
                variant="destructive"
                className="w-full"
                onClick={() => setShowCancelDialog(true)}
              >
                <XCircle className="h-4 w-4 mr-2" />
                Batalkan Pesanan
              </Button>
            )}
          </CardContent>
        </Card>
      </div>

      {/* Cancel Dialog */}
      <OrderCancelDialog
        order={order}
        isOpen={showCancelDialog}
        isLoading={isCancelling}
        onClose={() => setShowCancelDialog(false)}
        onConfirm={handleCancel}
      />

      {/* ‚úÖ INVOICE MODAL */}
      {tenant && (
        <InvoiceModal
          order={order}
          tenant={{
            name: tenant.name,
            logo: tenant.logo,
            phone: tenant.phone,
            whatsapp: tenant.whatsapp,
            address: tenant.address,
          }}
          isOpen={showInvoiceModal}
          onClose={() => setShowInvoiceModal(false)}
        />
      )}
    </div>
  );
}

================================================
FILE: src/components/orders/order-form.tsx
Lines: 499
================================================

'use client';

import { useState, useMemo } from 'react';
import { useRouter } from 'next/navigation';
import { useForm, SubmitHandler, useWatch } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { Loader2, Save, ArrowLeft, Plus, Trash2 } from 'lucide-react';
import { z } from 'zod';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Command,
  CommandEmpty,
  CommandGroup,
  CommandInput,
  CommandItem,
  CommandList,
} from '@/components/ui/command';
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from '@/components/ui/popover';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Separator } from '@/components/ui/separator';
import { useCreateOrder } from '@/hooks';
import { formatPrice } from '@/lib/format';
import type { Product, Customer } from '@/types';

// ==========================================
// ZOD SCHEMA
// ==========================================

const orderFormSchema = z.object({
  customerId: z.string().optional(),
  customerName: z.string().min(1, 'Nama pelanggan wajib diisi'),
  customerPhone: z.string().min(10, 'Nomor telepon tidak valid'),
  notes: z.string().optional(),
  paymentMethod: z.string().min(1, 'Metode pembayaran wajib dipilih'),
});

type OrderFormData = z.infer<typeof orderFormSchema>;

interface OrderItem {
  productId: string;
  name: string;
  price: number;
  qty: number;
}

interface OrderFormProps {
  products: Product[];
  customers: Customer[];
  initialCustomerId?: string;
}

export function OrderForm({ products, customers, initialCustomerId }: OrderFormProps) {
  const router = useRouter();
  const { createOrder, isLoading } = useCreateOrder();

  const [items, setItems] = useState<OrderItem[]>([]);
  const [selectedProduct, setSelectedProduct] = useState<string>('');

  // ‚úÖ FIX: Customer search state
  const [customerSearchOpen, setCustomerSearchOpen] = useState(false);
  const [customerSearch, setCustomerSearch] = useState('');

  // ‚úÖ FIX: Use useMemo instead of useEffect + setState
  const filteredCustomers = useMemo(() => {
    if (customerSearch.length >= 2) {
      const searchLower = customerSearch.toLowerCase();
      return customers.filter(
        (c) =>
          c.name.toLowerCase().includes(searchLower) ||
          c.phone.includes(customerSearch)
      );
    }
    return customers.slice(0, 10); // Show first 10 by default
  }, [customerSearch, customers]);

  const initialCustomer = customers.find((c) => c.id === initialCustomerId);

  const form = useForm<OrderFormData>({
    resolver: zodResolver(orderFormSchema),
    defaultValues: {
      customerId: initialCustomer?.id || '',
      customerName: initialCustomer?.name || '',
      customerPhone: initialCustomer?.phone || '',
      notes: '',
      paymentMethod: 'cash',
    },
  });

  const customerName = useWatch({
    control: form.control,
    name: 'customerName',
  });

  const subtotal = items.reduce((sum, item) => sum + item.price * item.qty, 0);
  const total = subtotal;

  const handleAddProduct = () => {
    if (!selectedProduct) return;

    const product = products.find((p) => p.id === selectedProduct);
    if (!product) return;

    const existingIndex = items.findIndex((i) => i.productId === product.id);
    if (existingIndex >= 0) {
      setItems((prev) =>
        prev.map((item, index) =>
          index === existingIndex ? { ...item, qty: item.qty + 1 } : item
        )
      );
    } else {
      setItems((prev) => [
        ...prev,
        {
          productId: product.id,
          name: product.name,
          price: product.price,
          qty: 1,
        },
      ]);
    }

    setSelectedProduct('');
  };

  const handleUpdateQuantity = (index: number, qty: number) => {
    if (qty <= 0) {
      handleRemoveItem(index);
      return;
    }
    setItems((prev) =>
      prev.map((item, i) => (i === index ? { ...item, qty } : item))
    );
  };

  const handleRemoveItem = (index: number) => {
    setItems((prev) => prev.filter((_, i) => i !== index));
  };

  const handleSelectCustomer = (customer: Customer) => {
    form.setValue('customerId', customer.id);
    form.setValue('customerName', customer.name);
    form.setValue('customerPhone', customer.phone);
    setCustomerSearchOpen(false);
    setCustomerSearch('');
  };

  const onSubmit: SubmitHandler<OrderFormData> = async (data) => {
    if (items.length === 0) {
      return;
    }

    try {
      await createOrder({
        customerId: data.customerId || undefined,
        customerName: data.customerName,
        customerPhone: data.customerPhone,
        notes: data.notes || undefined,
        paymentMethod: data.paymentMethod,
        items: items.map((item) => ({
          productId: item.productId,
          name: item.name,
          price: item.price,
          qty: item.qty,
        })),
      });

      router.push('/dashboard/orders');
    } catch {
      // Error handled in hook
    }
  };

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-8">
        <div className="grid gap-8 lg:grid-cols-3">
          {/* Main Content */}
          <div className="lg:col-span-2 space-y-6">
            {/* Products */}
            <Card>
              <CardHeader>
                <CardTitle>Produk</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="flex gap-2">
                  <Select value={selectedProduct} onValueChange={setSelectedProduct}>
                    <SelectTrigger className="flex-1">
                      <SelectValue placeholder="Pilih produk..." />
                    </SelectTrigger>
                    <SelectContent>
                      {products
                        .filter((p) => p.isActive)
                        .map((product) => (
                          <SelectItem key={product.id} value={product.id}>
                            {product.name} - {formatPrice(product.price)}
                          </SelectItem>
                        ))}
                    </SelectContent>
                  </Select>
                  <Button type="button" onClick={handleAddProduct}>
                    <Plus className="h-4 w-4" />
                  </Button>
                </div>

                {items.length > 0 ? (
                  <div className="space-y-2">
                    {items.map((item, index) => (
                      <div
                        key={index}
                        className="flex items-center gap-4 p-3 rounded-lg border"
                      >
                        <div className="flex-1">
                          <p className="font-medium">{item.name}</p>
                          <p className="text-sm text-muted-foreground">
                            {formatPrice(item.price)}
                          </p>
                        </div>
                        <div className="flex items-center gap-2">
                          <Button
                            type="button"
                            variant="outline"
                            size="icon"
                            className="h-8 w-8"
                            onClick={() => handleUpdateQuantity(index, item.qty - 1)}
                          >
                            -
                          </Button>
                          <span className="w-8 text-center">{item.qty}</span>
                          <Button
                            type="button"
                            variant="outline"
                            size="icon"
                            className="h-8 w-8"
                            onClick={() => handleUpdateQuantity(index, item.qty + 1)}
                          >
                            +
                          </Button>
                        </div>
                        <p className="w-24 text-right font-medium">
                          {formatPrice(item.price * item.qty)}
                        </p>
                        <Button
                          type="button"
                          variant="ghost"
                          size="icon"
                          className="h-8 w-8 text-destructive"
                          onClick={() => handleRemoveItem(index)}
                        >
                          <Trash2 className="h-4 w-4" />
                        </Button>
                      </div>
                    ))}

                    <Separator />

                    <div className="space-y-2 pt-2">
                      <div className="flex justify-between text-lg font-semibold">
                        <span>Total</span>
                        <span className="text-primary">{formatPrice(total)}</span>
                      </div>
                    </div>
                  </div>
                ) : (
                  <div className="text-center py-8 text-muted-foreground">
                    Belum ada produk ditambahkan
                  </div>
                )}
              </CardContent>
            </Card>

            {/* ‚úÖ FIX: Customer Section dengan useMemo */}
            <Card>
              <CardHeader>
                <CardTitle>Pelanggan</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div>
                  <label className="text-sm font-medium mb-2 block">
                    Cari Pelanggan
                  </label>
                  <Popover open={customerSearchOpen} onOpenChange={setCustomerSearchOpen}>
                    <PopoverTrigger asChild>
                      <Button variant="outline" className="w-full justify-start">
                        {customerName || 'Ketik nama/telepon...'}
                      </Button>
                    </PopoverTrigger>
                    <PopoverContent className="w-[400px] p-0" align="start">
                      <Command shouldFilter={false}>
                        <CommandInput
                          placeholder="Cari nama atau nomor telepon..."
                          value={customerSearch}
                          onValueChange={setCustomerSearch}
                        />
                        <CommandList>
                          {filteredCustomers.length === 0 ? (
                            <CommandEmpty>
                              {customerSearch.length >= 2
                                ? 'Pelanggan tidak ditemukan'
                                : 'Ketik minimal 2 karakter...'}
                            </CommandEmpty>
                          ) : (
                            <CommandGroup heading={`${filteredCustomers.length} Pelanggan`}>
                              {filteredCustomers.map((customer) => (
                                <CommandItem
                                  key={customer.id}
                                  value={customer.id}
                                  onSelect={() => handleSelectCustomer(customer)}
                                >
                                  <div className="flex flex-col">
                                    <span className="font-medium">{customer.name}</span>
                                    <span className="text-xs text-muted-foreground">
                                      {customer.phone}
                                    </span>
                                  </div>
                                </CommandItem>
                              ))}
                            </CommandGroup>
                          )}
                        </CommandList>
                      </Command>
                    </PopoverContent>
                  </Popover>
                </div>

                <p className="text-center text-sm text-muted-foreground">
                  atau isi manual
                </p>

                <div className="grid gap-4 sm:grid-cols-2">
                  <FormField
                    control={form.control}
                    name="customerName"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Nama *</FormLabel>
                        <FormControl>
                          <Input placeholder="Nama pelanggan" {...field} />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />

                  <FormField
                    control={form.control}
                    name="customerPhone"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Telepon *</FormLabel>
                        <FormControl>
                          <Input type="tel" placeholder="08xxxxxxxxxx" {...field} />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />
                </div>
              </CardContent>
            </Card>

            {/* Notes */}
            <Card>
              <CardHeader>
                <CardTitle>Catatan Pesanan</CardTitle>
              </CardHeader>
              <CardContent>
                <FormField
                  control={form.control}
                  name="notes"
                  render={({ field }) => (
                    <FormItem>
                      <FormControl>
                        <Textarea
                          placeholder={`Contoh:\n- Alamat: Jl. Merdeka No. 10\n- Kirim sore jam 5\n- Hutang, bayar minggu depan`}
                          rows={4}
                          {...field}
                        />
                      </FormControl>
                      <p className="text-xs text-muted-foreground">
                        Bisa diisi alamat pengiriman, catatan khusus, dll.
                      </p>
                      <FormMessage />
                    </FormItem>
                  )}
                />
              </CardContent>
            </Card>
          </div>

          {/* Sidebar */}
          <div className="space-y-6">
            <Card>
              <CardHeader>
                <CardTitle>Ringkasan</CardTitle>
              </CardHeader>
              <CardContent className="space-y-3">
                <div className="flex justify-between">
                  <span className="text-muted-foreground">Jumlah Item</span>
                  <span>{items.reduce((sum, i) => sum + i.qty, 0)}</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-muted-foreground">Subtotal</span>
                  <span>{formatPrice(subtotal)}</span>
                </div>
                <Separator />
                <div className="flex justify-between text-lg font-semibold">
                  <span>Total</span>
                  <span className="text-primary">{formatPrice(total)}</span>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle>Pembayaran</CardTitle>
              </CardHeader>
              <CardContent>
                <FormField
                  control={form.control}
                  name="paymentMethod"
                  render={({ field }) => (
                    <FormItem>
                      <Select onValueChange={field.onChange} value={field.value}>
                        <FormControl>
                          <SelectTrigger>
                            <SelectValue />
                          </SelectTrigger>
                        </FormControl>
                        <SelectContent>
                          <SelectItem value="cash">Tunai</SelectItem>
                          <SelectItem value="transfer">Transfer Bank</SelectItem>
                          <SelectItem value="ewallet">E-Wallet</SelectItem>
                          <SelectItem value="cod">COD</SelectItem>
                          <SelectItem value="debt">Hutang</SelectItem>
                        </SelectContent>
                      </Select>
                      <FormMessage />
                    </FormItem>
                  )}
                />
              </CardContent>
            </Card>

            <Card>
              <CardContent className="pt-6 space-y-2">
                <Button
                  type="submit"
                  className="w-full"
                  disabled={isLoading || items.length === 0}
                >
                  {isLoading ? (
                    <>
                      <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                      Menyimpan...
                    </>
                  ) : (
                    <>
                      <Save className="h-4 w-4 mr-2" />
                      Buat Pesanan
                    </>
                  )}
                </Button>
                <Button
                  type="button"
                  variant="outline"
                  className="w-full"
                  onClick={() => router.back()}
                >
                  <ArrowLeft className="h-4 w-4 mr-2" />
                  Kembali
                </Button>
              </CardContent>
            </Card>
          </div>
        </div>
      </form>
    </Form>
  );
}

================================================
FILE: src/components/orders/order-items-table.tsx
Lines: 85
================================================

import { Package } from 'lucide-react';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
  TableFooter,
} from '@/components/ui/table';
import { formatPrice } from '@/lib/format';
import type { OrderItem } from '@/types';

// ==========================================
// ORDER ITEMS TABLE
// ==========================================

interface OrderItemsTableProps {
  items: OrderItem[];
  subtotal: number;
  discount?: number;
  shippingCost?: number;
  total: number;
}

export function OrderItemsTable({
  items,
  subtotal,
  discount = 0,
  shippingCost = 0,
  total,
}: OrderItemsTableProps) {
  return (
    <Table>
      <TableHeader>
        <TableRow>
          <TableHead className="w-[50%]">Produk</TableHead>
          <TableHead className="text-right">Harga</TableHead>
          <TableHead className="text-center">Qty</TableHead>
          <TableHead className="text-right">Subtotal</TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {items.map((item, index) => (
          <TableRow key={item.id || index}><TableCell>
              <div className="flex items-center gap-3">
                <div className="relative h-12 w-12 overflow-hidden rounded-lg bg-muted flex-shrink-0">
                  <div className="flex h-full items-center justify-center">
                    <Package className="h-5 w-5 text-muted-foreground" />
                  </div>
                </div>
                <div>
                  <p className="font-medium">{item.name}</p>
                  {item.notes && (
                    <p className="text-xs text-muted-foreground">{item.notes}</p>
                  )}
                </div>
              </div>
            </TableCell><TableCell className="text-right">{formatPrice(item.price)}</TableCell><TableCell className="text-center">{item.qty}</TableCell><TableCell className="text-right font-medium">{formatPrice(item.subtotal)}</TableCell></TableRow>
        ))}
      </TableBody>
      <TableFooter>
        <TableRow>
          <TableCell colSpan={3} className="text-right">Subtotal</TableCell>
          <TableCell className="text-right">{formatPrice(subtotal)}</TableCell>
        </TableRow>
        {discount > 0 && (
          <TableRow>
            <TableCell colSpan={3} className="text-right text-green-600">Diskon</TableCell>
            <TableCell className="text-right text-green-600">-{formatPrice(discount)}</TableCell>
          </TableRow>
        )}
        {shippingCost > 0 && (
          <TableRow>
            <TableCell colSpan={3} className="text-right">Ongkos Kirim</TableCell>
            <TableCell className="text-right">{formatPrice(shippingCost)}</TableCell>
          </TableRow>
        )}
        <TableRow>
          <TableCell colSpan={3} className="text-right font-semibold">Total</TableCell>
          <TableCell className="text-right font-bold text-lg text-primary">{formatPrice(total)}</TableCell>
        </TableRow>
      </TableFooter>
    </Table>
  );
}

================================================
FILE: src/components/orders/orders-table.tsx
Lines: 364
================================================

'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import {
  ColumnFiltersState,
  SortingState,
  VisibilityState,
  flexRender,
  getCoreRowModel,
  getFilteredRowModel,
  getPaginationRowModel,
  getSortedRowModel,
  useReactTable,
} from '@tanstack/react-table';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import {
  AlertDialog,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import { Button } from '@/components/ui/button';
import { AlertTriangle, Loader2, Trash2 } from 'lucide-react';
import { getOrderColumns } from './orders-table-columns';
import { OrdersTableToolbar } from './orders-table-toolbar';
import { OrderCancelDialog } from './order-cancel-dialog';
import { useCancelOrder } from '@/hooks';
import { ordersApi, getErrorMessage } from '@/lib/api';
import { toast } from '@/providers';
import type { OrderListItem } from '@/types';

// ==========================================
// ORDERS TABLE COMPONENT
// ==========================================

interface OrdersTableProps {
  orders: OrderListItem[];
  onRefresh?: () => void;
}

export function OrdersTable({ orders, onRefresh }: OrdersTableProps) {
  const router = useRouter();
  const [sorting, setSorting] = useState<SortingState>([
    { id: 'createdAt', desc: true },
  ]);
  const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([]);
  const [columnVisibility, setColumnVisibility] = useState<VisibilityState>({});
  const [rowSelection, setRowSelection] = useState({});

  // Cancel dialog state
  const [cancelOrder, setCancelOrder] = useState<OrderListItem | null>(null);
  const { cancelOrder: performCancel, isLoading: isCancelling } = useCancelOrder();

  // Delete dialog state
  const [deleteOrder, setDeleteOrder] = useState<OrderListItem | null>(null);
  const [isDeleting, setIsDeleting] = useState(false);

  // Bulk delete dialog state
  const [isBulkDeleteOpen, setIsBulkDeleteOpen] = useState(false);
  const [isBulkDeleting, setIsBulkDeleting] = useState(false);
  const [bulkDeleteIds, setBulkDeleteIds] = useState<string[]>([]);

  // Helper: Refresh data
  const refreshData = () => {
    if (onRefresh) {
      onRefresh();
    } else {
      router.refresh();
    }
  };

  // Column actions
  const columnActions = {
    onView: (order: OrderListItem) => {
      router.push(`/dashboard/orders/${order.id}`);
    },
    onCancel: (order: OrderListItem) => {
      setCancelOrder(order);
    },
    onDelete: (order: OrderListItem) => {
      setDeleteOrder(order);
    },
  };

  const columns = getOrderColumns(columnActions);

  const table = useReactTable({
    data: orders,
    columns,
    onSortingChange: setSorting,
    onColumnFiltersChange: setColumnFilters,
    getCoreRowModel: getCoreRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    getSortedRowModel: getSortedRowModel(),
    getFilteredRowModel: getFilteredRowModel(),
    onColumnVisibilityChange: setColumnVisibility,
    onRowSelectionChange: setRowSelection,
    state: {
      sorting,
      columnFilters,
      columnVisibility,
      rowSelection,
    },
  });

  // Handle cancel
  const handleCancel = async () => {
    if (!cancelOrder) return;

    const success = await performCancel(cancelOrder.id);
    if (success) {
      setCancelOrder(null);
      refreshData();
    }
  };

  // Handle single delete
  const handleDelete = async () => {
    if (!deleteOrder) return;

    setIsDeleting(true);

    try {
      await ordersApi.delete(deleteOrder.id);
      toast.success('Pesanan berhasil dihapus');
      setDeleteOrder(null);
      refreshData();
    } catch (err) {
      toast.error('Gagal menghapus pesanan', getErrorMessage(err));
    } finally {
      setIsDeleting(false);
    }
  };

  // Open bulk delete dialog
  const openBulkDeleteDialog = () => {
    const selectedRows = table.getFilteredSelectedRowModel().rows;
    const ids = selectedRows.map((row) => row.original.id);

    if (ids.length === 0) return;

    setBulkDeleteIds(ids);
    setIsBulkDeleteOpen(true);
  };

  // Handle bulk delete
  const handleBulkDelete = async () => {
    if (bulkDeleteIds.length === 0) return;

    setIsBulkDeleting(true);

    try {
      // Delete one by one (or implement bulk delete endpoint)
      let successCount = 0;
      for (const id of bulkDeleteIds) {
        try {
          await ordersApi.delete(id);
          successCount++;
        } catch {
          // Continue with others
        }
      }

      toast.success(`${successCount} pesanan berhasil dihapus`);
      setRowSelection({});
      setIsBulkDeleteOpen(false);
      setBulkDeleteIds([]);
      refreshData();
    } catch (err) {
      toast.error('Gagal menghapus pesanan', getErrorMessage(err));
    } finally {
      setIsBulkDeleting(false);
    }
  };

  // Check if any selected
  const selectedCount = table.getFilteredSelectedRowModel().rows.length;

  return (
    <div className="space-y-4">
      {/* Toolbar */}
      <OrdersTableToolbar table={table} />

      {/* Bulk Actions Bar */}
      {selectedCount > 0 && (
        <div className="flex items-center gap-2 p-2 bg-muted rounded-lg">
          <span className="text-sm font-medium">{selectedCount} dipilih</span>
          <Button
            variant="destructive"
            size="sm"
            onClick={openBulkDeleteDialog}
          >
            <Trash2 className="h-4 w-4 mr-2" />
            Hapus
          </Button>
        </div>
      )}

      {/* Table */}
      <div className="rounded-md border">
        <Table>
          <TableHeader>
            {table.getHeaderGroups().map((headerGroup) => (
              <TableRow key={headerGroup.id}>
                {headerGroup.headers.map((header) => (
                  <TableHead key={header.id}>
                    {header.isPlaceholder
                      ? null
                      : flexRender(
                        header.column.columnDef.header,
                        header.getContext()
                      )}
                  </TableHead>
                ))}
              </TableRow>
            ))}
          </TableHeader>
          <TableBody>
            {table.getRowModel().rows?.length ? (
              table.getRowModel().rows.map((row) => (
                <TableRow
                  key={row.id}
                  data-state={row.getIsSelected() && 'selected'}
                >
                  {row.getVisibleCells().map((cell) => (
                    <TableCell key={cell.id}>
                      {flexRender(
                        cell.column.columnDef.cell,
                        cell.getContext()
                      )}
                    </TableCell>
                  ))}
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell
                  colSpan={columns.length}
                  className="h-24 text-center"
                >
                  Tidak ada pesanan ditemukan.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>

      {/* Pagination */}
      <div className="flex items-center justify-between">
        <div className="text-sm text-muted-foreground">
          {table.getFilteredRowModel().rows.length} pesanan
        </div>
        <div className="flex items-center space-x-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.previousPage()}
            disabled={!table.getCanPreviousPage()}
          >
            Sebelumnya
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.nextPage()}
            disabled={!table.getCanNextPage()}
          >
            Selanjutnya
          </Button>
        </div>
      </div>

      {/* Cancel Dialog */}
      <OrderCancelDialog
        order={cancelOrder}
        isOpen={!!cancelOrder}
        isLoading={isCancelling}
        onClose={() => setCancelOrder(null)}
        onConfirm={handleCancel}
      />

      {/* Single Delete Dialog */}
      <AlertDialog open={!!deleteOrder} onOpenChange={() => setDeleteOrder(null)}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-destructive/10">
                <AlertTriangle className="h-5 w-5 text-destructive" />
              </div>
              <AlertDialogTitle>Hapus Pesanan</AlertDialogTitle>
            </div>
            <AlertDialogDescription className="pt-2">
              Apakah Anda yakin ingin menghapus pesanan <strong>#{deleteOrder?.orderNumber}</strong>?
              Tindakan ini tidak dapat dibatalkan.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel disabled={isDeleting}>Batal</AlertDialogCancel>
            <Button
              variant="destructive"
              onClick={handleDelete}
              disabled={isDeleting}
            >
              {isDeleting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Menghapus...
                </>
              ) : (
                'Hapus'
              )}
            </Button>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>

      {/* Bulk Delete Dialog */}
      <AlertDialog open={isBulkDeleteOpen} onOpenChange={setIsBulkDeleteOpen}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-destructive/10">
                <AlertTriangle className="h-5 w-5 text-destructive" />
              </div>
              <AlertDialogTitle>Hapus {bulkDeleteIds.length} Pesanan</AlertDialogTitle>
            </div>
            <AlertDialogDescription className="pt-2">
              Apakah Anda yakin ingin menghapus <strong>{bulkDeleteIds.length} pesanan</strong> yang dipilih?
              Tindakan ini tidak dapat dibatalkan.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel disabled={isBulkDeleting}>Batal</AlertDialogCancel>
            <Button
              variant="destructive"
              onClick={handleBulkDelete}
              disabled={isBulkDeleting}
            >
              {isBulkDeleting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Menghapus...
                </>
              ) : (
                'Hapus'
              )}
            </Button>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  );
}

================================================
FILE: src/components/orders/orders-table-columns.tsx
Lines: 223
================================================

'use client';

import { ColumnDef } from '@tanstack/react-table';
import Link from 'next/link';
import { MoreHorizontal, ArrowUpDown, Eye, XCircle, Trash2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Checkbox } from '@/components/ui/checkbox';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { OrderStatusBadge, PaymentStatusBadge } from './order-status-badge';
import { formatPrice, formatDateTime } from '@/lib/format';
import type { OrderListItem } from '@/types';

// ==========================================
// ORDERS TABLE COLUMNS
// ==========================================

interface ColumnActions {
  onView: (order: OrderListItem) => void;
  onCancel: (order: OrderListItem) => void;
  onDelete: (order: OrderListItem) => void; // ‚úÖ ADD: Delete action
}

export function getOrderColumns(actions: ColumnActions): ColumnDef<OrderListItem>[] {
  return [
    // Checkbox
    {
      id: 'select',
      header: ({ table }) => (
        <Checkbox
          checked={
            table.getIsAllPageRowsSelected() ||
            (table.getIsSomePageRowsSelected() && 'indeterminate')
          }
          onCheckedChange={(value) => table.toggleAllPageRowsSelected(!!value)}
          aria-label="Select all"
        />
      ),
      cell: ({ row }) => (
        <Checkbox
          checked={row.getIsSelected()}
          onCheckedChange={(value) => row.toggleSelected(!!value)}
          aria-label="Select row"
        />
      ),
      enableSorting: false,
      enableHiding: false,
    },

    // Order Number
    {
      accessorKey: 'orderNumber',
      header: 'No. Pesanan',
      cell: ({ row }) => {
        const order = row.original;
        return (
          <Link
            href={`/dashboard/orders/${order.id}`}
            className="font-mono font-medium text-primary hover:underline"
          >
            #{order.orderNumber}
          </Link>
        );
      },
    },

    // Customer
    {
      accessorKey: 'customer',
      header: 'Pelanggan',
      cell: ({ row }) => {
        const order = row.original;
        return (
          <div>
            <p className="font-medium">{order.customer?.name || order.customerName || 'Guest'}</p>
            <p className="text-xs text-muted-foreground">
              {order.customer?.phone || order.customerPhone || '-'}
            </p>
          </div>
        );
      },
    },

    // Items Count
    {
      id: 'items',
      header: 'Item',
      cell: ({ row }) => {
        const order = row.original;
        // Use _count if available from API
        const count = (order as unknown as { _count?: { items: number } })._count?.items;
        return (
          <span className="text-muted-foreground">
            {count !== undefined ? count : '-'}
          </span>
        );
      },
    },

    // Total
    {
      accessorKey: 'total',
      header: ({ column }) => (
        <Button
          variant="ghost"
          onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
        >
          Total
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      cell: ({ row }) => {
        const total = row.getValue('total') as number;
        return <span className="font-semibold">{formatPrice(total)}</span>;
      },
    },

    // Order Status
    {
      accessorKey: 'status',
      header: 'Status',
      cell: ({ row }) => {
        const status = row.getValue('status') as OrderListItem['status'];
        return <OrderStatusBadge status={status} />;
      },
      filterFn: (row, id, value) => {
        return value === 'all' || row.getValue(id) === value;
      },
    },

    // Payment Status
    {
      accessorKey: 'paymentStatus',
      header: 'Pembayaran',
      cell: ({ row }) => {
        const status = row.getValue('paymentStatus') as OrderListItem['paymentStatus'];
        return <PaymentStatusBadge status={status} />;
      },
      filterFn: (row, id, value) => {
        return value === 'all' || row.getValue(id) === value;
      },
    },

    // Created At
    {
      accessorKey: 'createdAt',
      header: ({ column }) => (
        <Button
          variant="ghost"
          onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
        >
          Tanggal
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      cell: ({ row }) => {
        const date = row.getValue('createdAt') as string;
        return (
          <span className="text-sm text-muted-foreground">
            {formatDateTime(date)}
          </span>
        );
      },
    },

    // Actions
    {
      id: 'actions',
      enableHiding: false,
      cell: ({ row }) => {
        const order = row.original;
        const canCancel = order.status !== 'CANCELLED' && order.status !== 'COMPLETED';

        return (
          <DropdownMenu>
            <DropdownMenuTrigger asChild>
              <Button variant="ghost" className="h-8 w-8 p-0">
                <span className="sr-only">Buka menu</span>
                <MoreHorizontal className="h-4 w-4" />
              </Button>
            </DropdownMenuTrigger>
            <DropdownMenuContent align="end">
              <DropdownMenuLabel>Aksi</DropdownMenuLabel>

              {/* View Detail */}
              <DropdownMenuItem onClick={() => actions.onView(order)}>
                <Eye className="h-4 w-4 mr-2" />
                Lihat Detail
              </DropdownMenuItem>

              <DropdownMenuSeparator />

              {/* Cancel - hanya jika belum cancelled/completed */}
              {canCancel && (
                <DropdownMenuItem
                  onClick={() => actions.onCancel(order)}
                  className="text-orange-600"
                >
                  <XCircle className="h-4 w-4 mr-2" />
                  Batalkan Pesanan
                </DropdownMenuItem>
              )}

              {/* ‚úÖ Delete - selalu tampil */}
              <DropdownMenuItem
                onClick={() => actions.onDelete(order)}
                className="text-destructive focus:text-destructive"
              >
                <Trash2 className="h-4 w-4 mr-2" />
                Hapus Pesanan
              </DropdownMenuItem>
            </DropdownMenuContent>
          </DropdownMenu>
        );
      },
    },
  ];
}

================================================
FILE: src/components/orders/orders-table-toolbar.tsx
Lines: 110
================================================

'use client';

import { Table } from '@tanstack/react-table';
import { X, Search } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import type { OrderListItem } from '@/types';

// ==========================================
// ORDERS TABLE TOOLBAR
// ==========================================

interface OrdersTableToolbarProps {
  table: Table<OrderListItem>;
}

const orderStatusOptions = [
  { value: 'all', label: 'Semua Status' },
  { value: 'pending', label: 'Menunggu' },
  { value: 'confirmed', label: 'Dikonfirmasi' },
  { value: 'processing', label: 'Diproses' },
  { value: 'shipped', label: 'Dikirim' },
  { value: 'delivered', label: 'Selesai' },
  { value: 'cancelled', label: 'Dibatalkan' },
];

const paymentStatusOptions = [
  { value: 'all', label: 'Semua Pembayaran' },
  { value: 'unpaid', label: 'Belum Bayar' },
  { value: 'partial', label: 'Sebagian' },
  { value: 'paid', label: 'Lunas' },
  { value: 'refunded', label: 'Refund' },
];

export function OrdersTableToolbar({ table }: OrdersTableToolbarProps) {
  const isFiltered = table.getState().columnFilters.length > 0;

  return (
    <div className="flex flex-col gap-4 sm:flex-row sm:items-center">
      {/* Search */}
      <div className="relative w-full sm:w-64">
        <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
        <Input
          placeholder="Cari pesanan..."
          value={(table.getColumn('orderNumber')?.getFilterValue() as string) ?? ''}
          onChange={(event) =>
            table.getColumn('orderNumber')?.setFilterValue(event.target.value)
          }
          className="pl-8"
        />
      </div>

      {/* Order Status Filter */}
      <Select
        value={(table.getColumn('status')?.getFilterValue() as string) ?? 'all'}
        onValueChange={(value) =>
          table.getColumn('status')?.setFilterValue(value === 'all' ? '' : value)
        }
      >
        <SelectTrigger className="w-[150px]">
          <SelectValue placeholder="Status" />
        </SelectTrigger>
        <SelectContent>
          {orderStatusOptions.map((option) => (
            <SelectItem key={option.value} value={option.value}>
              {option.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      {/* Payment Status Filter */}
      <Select
        value={(table.getColumn('paymentStatus')?.getFilterValue() as string) ?? 'all'}
        onValueChange={(value) =>
          table.getColumn('paymentStatus')?.setFilterValue(value === 'all' ? '' : value)
        }
      >
        <SelectTrigger className="w-[160px]">
          <SelectValue placeholder="Pembayaran" />
        </SelectTrigger>
        <SelectContent>
          {paymentStatusOptions.map((option) => (
            <SelectItem key={option.value} value={option.value}>
              {option.label}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>

      {/* Reset Filters */}
      {isFiltered && (
        <Button
          variant="ghost"
          onClick={() => table.resetColumnFilters()}
          className="px-2 lg:px-3"
        >
          Reset
          <X className="ml-2 h-4 w-4" />
        </Button>
      )}
    </div>
  );
}

================================================
FILE: src/components/orders/order-status-badge.tsx
Lines: 46
================================================

import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/cn';
import type { OrderStatus, PaymentStatus } from '@/types';

// ==========================================
// ‚úÖ FIX: Use UPPERCASE enum values from backend
// ==========================================

const orderStatusConfig: Record<OrderStatus, { label: string; variant: string }> = {
  PENDING: { label: 'Menunggu', variant: 'bg-yellow-100 text-yellow-800 border-yellow-200' },
  PROCESSING: { label: 'Diproses', variant: 'bg-blue-100 text-blue-800 border-blue-200' },
  COMPLETED: { label: 'Selesai', variant: 'bg-green-100 text-green-800 border-green-200' },
  CANCELLED: { label: 'Dibatalkan', variant: 'bg-red-100 text-red-800 border-red-200' },
};

const paymentStatusConfig: Record<PaymentStatus, { label: string; variant: string }> = {
  PENDING: { label: 'Belum Bayar', variant: 'bg-red-100 text-red-800 border-red-200' },
  PARTIAL: { label: 'Sebagian', variant: 'bg-yellow-100 text-yellow-800 border-yellow-200' },
  PAID: { label: 'Lunas', variant: 'bg-green-100 text-green-800 border-green-200' },
  FAILED: { label: 'Gagal', variant: 'bg-gray-100 text-gray-800 border-gray-200' },
};

interface OrderStatusBadgeProps {
  status: OrderStatus;
}

export function OrderStatusBadge({ status }: OrderStatusBadgeProps) {
  const config = orderStatusConfig[status];
  return (
    <Badge variant="outline" className={cn('font-medium', config.variant)}>
      {config.label}
    </Badge>
  );
}

interface PaymentStatusBadgeProps {
  status: PaymentStatus;
}

export function PaymentStatusBadge({ status }: PaymentStatusBadgeProps) {
  const config = paymentStatusConfig[status];
  return (
    <Badge variant="outline" className={cn('font-medium', config.variant)}>
      {config.label}
    </Badge>
  );
}

================================================
FILE: src/components/orders/order-status-select.tsx
Lines: 186
================================================

'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { Loader2 } from 'lucide-react';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { ordersApi, getErrorMessage } from '@/lib/api';
import { toast } from '@/providers';
import type { OrderStatus, PaymentStatus } from '@/types';

// ==========================================
// STATUS OPTIONS
// ==========================================

const orderStatusOptions: { value: OrderStatus; label: string }[] = [
  { value: 'PENDING', label: 'Menunggu' },
  { value: 'PROCESSING', label: 'Diproses' },
  { value: 'COMPLETED', label: 'Selesai' },
  { value: 'CANCELLED', label: 'Dibatalkan' },
];

const paymentStatusOptions: { value: PaymentStatus; label: string }[] = [
  { value: 'PENDING', label: 'Belum Bayar' },
  { value: 'PARTIAL', label: 'Sebagian' },
  { value: 'PAID', label: 'Lunas' },
  { value: 'FAILED', label: 'Gagal' },
];

// ==========================================
// ORDER STATUS SELECT
// ==========================================

interface OrderStatusSelectProps {
  orderId: string;
  currentStatus: OrderStatus;
  disabled?: boolean;
  onSuccess?: () => void;
}

export function OrderStatusSelect({
  orderId,
  currentStatus,
  disabled,
  onSuccess,
}: OrderStatusSelectProps) {
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);
  const [status, setStatus] = useState<OrderStatus>(currentStatus);

  const handleChange = async (value: OrderStatus) => {
    if (value === status) return;

    setIsLoading(true);

    try {
      await ordersApi.updateStatus(orderId, { status: value });
      setStatus(value); // ‚úÖ Update local state immediately
      toast.success('Status pesanan diperbarui');

      // Refresh page data
      router.refresh();
      onSuccess?.();
    } catch (err) {
      toast.error('Gagal memperbarui status', getErrorMessage(err));
    } finally {
      setIsLoading(false);
    }
  };

  // ‚úÖ Jika CANCELLED, tampilkan text saja (tidak bisa diubah)
  if (status === 'CANCELLED') {
    return (
      <span className="text-sm text-muted-foreground">Dibatalkan</span>
    );
  }

  // ‚úÖ Jika COMPLETED, tampilkan text saja
  if (status === 'COMPLETED') {
    return (
      <span className="text-sm text-muted-foreground">Selesai</span>
    );
  }

  return (
    <Select
      value={status}
      onValueChange={handleChange}
      disabled={disabled || isLoading}
    >
      <SelectTrigger className="w-[140px]">
        {isLoading ? (
          <Loader2 className="h-4 w-4 animate-spin" />
        ) : (
          <SelectValue />
        )}
      </SelectTrigger>
      <SelectContent>
        {orderStatusOptions.map((option) => (
          <SelectItem key={option.value} value={option.value}>
            {option.label}
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  );
}

// ==========================================
// PAYMENT STATUS SELECT
// ==========================================

interface PaymentStatusSelectProps {
  orderId: string;
  currentStatus: PaymentStatus;
  orderStatus?: OrderStatus; // ‚úÖ ADD: untuk cek apakah order cancelled
  disabled?: boolean;
  onSuccess?: () => void;
}

export function PaymentStatusSelect({
  orderId,
  currentStatus,
  orderStatus,
  disabled,
  onSuccess,
}: PaymentStatusSelectProps) {
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);
  const [status, setStatus] = useState<PaymentStatus>(currentStatus);

  const handleChange = async (value: PaymentStatus) => {
    if (value === status) return;

    setIsLoading(true);

    try {
      await ordersApi.updatePayment(orderId, { paymentStatus: value });
      setStatus(value); // ‚úÖ Update local state immediately
      toast.success('Status pembayaran diperbarui');

      // Refresh page data
      router.refresh();
      onSuccess?.();
    } catch (err) {
      toast.error('Gagal memperbarui pembayaran', getErrorMessage(err));
    } finally {
      setIsLoading(false);
    }
  };

  // ‚úÖ Jika order CANCELLED, tampilkan text saja (tidak bisa ubah payment)
  if (orderStatus === 'CANCELLED') {
    const label = paymentStatusOptions.find(o => o.value === status)?.label || status;
    return (
      <span className="text-sm text-muted-foreground">{label}</span>
    );
  }

  return (
    <Select
      value={status}
      onValueChange={handleChange}
      disabled={disabled || isLoading}
    >
      <SelectTrigger className="w-[130px]">
        {isLoading ? (
          <Loader2 className="h-4 w-4 animate-spin" />
        ) : (
          <SelectValue />
        )}
      </SelectTrigger>
      <SelectContent>
        {paymentStatusOptions.map((option) => (
          <SelectItem key={option.value} value={option.value}>
            {option.label}
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  );
}


################################################################
##
##  CATEGORY: Product Components
##  Path: src/components/products
##
################################################################

================================================
FILE: src/components/products/index.ts
Lines: 8
================================================

// ==========================================
// PRODUCTS COMPONENTS INDEX
// ==========================================

export { ProductsTable } from './products-table';
export { getProductColumns } from './products-table-columns';
export { ProductsTableToolbar } from './products-table-toolbar';
export { ProductForm } from './product-form';
export { ProductDeleteDialog } from './product-delete-dialog';

================================================
FILE: src/components/products/product-delete-dialog.tsx
Lines: 68
================================================

'use client';

import { Loader2, AlertTriangle } from 'lucide-react';
import {
  AlertDialog,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import { Button } from '@/components/ui/button';
import type { Product } from '@/types';

// ==========================================
// PRODUCT DELETE DIALOG
// ==========================================

interface ProductDeleteDialogProps {
  product: Product | null;
  isOpen: boolean;
  isLoading: boolean;
  onClose: () => void;
  onConfirm: () => void;
}

export function ProductDeleteDialog({
  product,
  isOpen,
  isLoading,
  onClose,
  onConfirm,
}: ProductDeleteDialogProps) {
  return (
    <AlertDialog open={isOpen} onOpenChange={onClose}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle className="flex items-center gap-2">
            <AlertTriangle className="h-5 w-5 text-destructive" />
            Hapus Produk
          </AlertDialogTitle>
          <AlertDialogDescription>
            Apakah Anda yakin ingin menghapus produk{' '}
            <strong>&#34;{product?.name}&#34;</strong>? Tindakan ini tidak dapat
            dibatalkan.
          </AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel disabled={isLoading}>Batal</AlertDialogCancel>
          <Button
            variant="destructive"
            onClick={onConfirm}
            disabled={isLoading}
          >
            {isLoading ? (
              <>
                <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                Menghapus...
              </>
            ) : (
              'Hapus'
            )}
          </Button>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}

================================================
FILE: src/components/products/product-form.tsx
Lines: 626
================================================

'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { Loader2, Save, ArrowLeft, Check, ChevronsUpDown } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import { Switch } from '@/components/ui/switch';
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from '@/components/ui/popover';
import {
  Command,
  CommandEmpty,
  CommandGroup,
  CommandInput,
  CommandItem,
  CommandList,
} from '@/components/ui/command';
import { Separator } from '@/components/ui/separator';
import { cn } from '@/lib/utils';
import { useCreateProduct, useUpdateProduct } from '@/hooks';
import { productSchema, type ProductFormData } from '@/lib/validations';
import { UNIT_OPTIONS } from '@/config/constants';
import { MultiImageUpload } from '@/components/upload';
import type { Product } from '@/types';

// ==========================================
// PRODUCT FORM COMPONENT
// ==========================================

interface ProductFormProps {
  product?: Product;
  categories?: string[];
}

export function ProductForm({ product, categories = [] }: ProductFormProps) {
  const router = useRouter();
  const isEditing = !!product;

  const { createProduct, isLoading: isCreating } = useCreateProduct();
  const { updateProduct, isLoading: isUpdating } = useUpdateProduct();
  const isLoading = isCreating || isUpdating;

  // ‚úÖ State untuk category combobox
  const [categoryOpen, setCategoryOpen] = useState(false);
  const [categorySearch, setCategorySearch] = useState('');

  const form = useForm<ProductFormData>({
    resolver: zodResolver(productSchema),
    defaultValues: {
      name: product?.name || '',
      description: product?.description || '',
      category: product?.category || '',
      sku: product?.sku || '',
      price: product?.price || 0,
      comparePrice: product?.comparePrice || undefined,
      costPrice: product?.costPrice || undefined,
      stock: product?.stock || undefined,
      minStock: product?.minStock || 5,
      trackStock: product?.trackStock ?? true,
      unit: product?.unit || 'pcs',
      images: product?.images || [],
      isActive: product?.isActive ?? true,
      isFeatured: product?.isFeatured ?? false,
    },
  });

  // eslint-disable-next-line react-hooks/incompatible-library
  const watchTrackStock = form.watch('trackStock');
  const watchCategory = form.watch('category');
  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  const watchImages = form.watch('images');

  // ‚úÖ Filter categories berdasarkan search
  const filteredCategories = categories.filter((cat) =>
    cat.toLowerCase().includes(categorySearch.toLowerCase())
  );

  // ‚úÖ Check apakah search adalah kategori baru
  const isNewCategory =
    categorySearch.trim() !== '' &&
    !categories.some((cat) => cat.toLowerCase() === categorySearch.toLowerCase());

  const onSubmit = async (data: ProductFormData) => {
    try {
      if (isEditing) {
        await updateProduct(product.id, data);
      } else {
        await createProduct(data);
      }

      router.push('/dashboard/products');
    } catch {
      // Error handled in hooks
    }
  };

  // ‚úÖ Handle select category (existing or new)
  const handleSelectCategory = (value: string) => {
    form.setValue('category', value);
    setCategorySearch('');
    setCategoryOpen(false);
  };

  // ‚úÖ Handle create new category
  const handleCreateCategory = () => {
    const newCategory = categorySearch.trim();
    if (newCategory) {
      form.setValue('category', newCategory);
      setCategorySearch('');
      setCategoryOpen(false);
    }
  };

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-8">
        <div className="grid gap-8 lg:grid-cols-3">
          {/* Main Content */}
          <div className="lg:col-span-2 space-y-6">
            {/* Basic Info */}
            <Card>
              <CardHeader>
                <CardTitle>Informasi Produk</CardTitle>
                <CardDescription>
                  Informasi dasar tentang produk Anda
                </CardDescription>
              </CardHeader>
              <CardContent className="space-y-4">
                {/* Name */}
                <FormField
                  control={form.control}
                  name="name"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Nama Produk *</FormLabel>
                      <FormControl>
                        <Input placeholder="Contoh: Nasi Goreng Spesial" {...field} />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                {/* Description */}
                <FormField
                  control={form.control}
                  name="description"
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Deskripsi</FormLabel>
                      <FormControl>
                        <Textarea
                          placeholder="Deskripsi produk..."
                          rows={4}
                          {...field}
                        />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                {/* Category & SKU */}
                <div className="grid gap-4 sm:grid-cols-2">
                  {/* Category Combobox */}
                  <FormField
                    control={form.control}
                    name="category"
                    render={({ field }) => (
                      <FormItem className="flex flex-col">
                        <FormLabel>Kategori</FormLabel>
                        <Popover open={categoryOpen} onOpenChange={setCategoryOpen}>
                          <PopoverTrigger asChild>
                            <FormControl>
                              <Button
                                variant="outline"
                                role="combobox"
                                aria-expanded={categoryOpen}
                                className={cn(
                                  "w-full justify-between font-normal",
                                  !field.value && "text-muted-foreground"
                                )}
                              >
                                {field.value || "Pilih atau ketik kategori"}
                                <ChevronsUpDown className="ml-2 h-4 w-4 shrink-0 opacity-50" />
                              </Button>
                            </FormControl>
                          </PopoverTrigger>
                          <PopoverContent className="w-[300px] p-0" align="start">
                            <Command shouldFilter={false}>
                              <CommandInput
                                placeholder="Cari atau buat kategori..."
                                value={categorySearch}
                                onValueChange={setCategorySearch}
                              />
                              <CommandList>
                                <CommandEmpty className="py-2 px-4 text-sm text-muted-foreground">
                                  {categorySearch ? (
                                    <span>Tidak ada kategori &quot;{categorySearch}&quot;</span>
                                  ) : (
                                    <span>Ketik untuk mencari atau membuat kategori baru</span>
                                  )}
                                </CommandEmpty>

                                {/* Existing Categories */}
                                {filteredCategories.length > 0 && (
                                  <CommandGroup heading="Kategori">
                                    {filteredCategories.map((cat) => (
                                      <CommandItem
                                        key={cat}
                                        value={cat}
                                        onSelect={() => handleSelectCategory(cat)}
                                      >
                                        <Check
                                          className={cn(
                                            "mr-2 h-4 w-4",
                                            watchCategory === cat ? "opacity-100" : "opacity-0"
                                          )}
                                        />
                                        {cat}
                                      </CommandItem>
                                    ))}
                                  </CommandGroup>
                                )}

                                {/* Create New Category */}
                                {isNewCategory && (
                                  <CommandGroup heading="Buat Baru">
                                    <CommandItem
                                      value={`create-${categorySearch}`}
                                      onSelect={handleCreateCategory}
                                      className="text-primary"
                                    >
                                      <span className="mr-2">+</span>
                                      Buat &quot;{categorySearch}&quot;
                                    </CommandItem>
                                  </CommandGroup>
                                )}
                              </CommandList>
                            </Command>
                          </PopoverContent>
                        </Popover>
                        <FormDescription>
                          Pilih kategori yang ada atau ketik untuk membuat baru
                        </FormDescription>
                      </FormItem>
                    )}
                  />

                  <FormField
                    control={form.control}
                    name="sku"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>SKU</FormLabel>
                        <FormControl>
                          <Input placeholder="SKU-001" {...field} />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />
                </div>
              </CardContent>
            </Card>

            {/* ‚úÖ CLOUDINARY IMAGE UPLOAD */}
            <Card>
              <CardHeader>
                <CardTitle>Gambar Produk</CardTitle>
                <CardDescription>
                  Upload gambar produk (maksimal 5 gambar). Gambar pertama akan jadi thumbnail utama.
                </CardDescription>
              </CardHeader>
              <CardContent>
                <FormField
                  control={form.control}
                  name="images"
                  render={({ field }) => (
                    <FormItem>
                      <FormControl>
                        <MultiImageUpload
                          value={field.value || []}
                          onChange={field.onChange}
                          folder="fibidy/products"
                          maxImages={5}
                        />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />
              </CardContent>
            </Card>

            {/* Pricing */}
            <Card>
              <CardHeader>
                <CardTitle>Harga</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <div className="grid gap-4 sm:grid-cols-3">
                  {/* Price */}
                  <FormField
                    control={form.control}
                    name="price"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Harga Jual *</FormLabel>
                        <FormControl>
                          <div className="relative">
                            <span className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground">
                              Rp
                            </span>
                            <Input
                              type="number"
                              placeholder="0"
                              className="pl-10"
                              {...field}
                              onChange={(e) => field.onChange(Number(e.target.value))}
                            />
                          </div>
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />

                  {/* Compare Price */}
                  <FormField
                    control={form.control}
                    name="comparePrice"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Harga Coret</FormLabel>
                        <FormControl>
                          <div className="relative">
                            <span className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground">
                              Rp
                            </span>
                            <Input
                              type="number"
                              placeholder="0"
                              className="pl-10"
                              {...field}
                              value={field.value || ''}
                              onChange={(e) =>
                                field.onChange(
                                  e.target.value ? Number(e.target.value) : undefined
                                )
                              }
                            />
                          </div>
                        </FormControl>
                        <FormDescription>
                          Harga sebelum diskon
                        </FormDescription>

                      </FormItem>
                    )}
                  />

                  {/* Cost Price */}
                  <FormField
                    control={form.control}
                    name="costPrice"
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Harga Modal</FormLabel>
                        <FormControl>
                          <div className="relative">
                            <span className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground">
                              Rp
                            </span>
                            <Input
                              type="number"
                              placeholder="0"
                              className="pl-10"
                              {...field}
                              value={field.value || ''}
                              onChange={(e) =>
                                field.onChange(
                                  e.target.value ? Number(e.target.value) : undefined
                                )
                              }
                            />
                          </div>
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />
                </div>
              </CardContent>
            </Card>

            {/* Inventory */}
            <Card>
              <CardHeader>
                <CardTitle>Inventori</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                {/* Track Stock */}
                <FormField
                  control={form.control}
                  name="trackStock"
                  render={({ field }) => (
                    <FormItem className="flex items-center justify-between rounded-lg border p-4">
                      <div className="space-y-0.5">
                        <FormLabel className="text-base">Lacak Stok</FormLabel>
                        <FormDescription>
                          Aktifkan untuk melacak jumlah stok produk
                        </FormDescription>
                      </div>
                      <FormControl>
                        <Switch
                          checked={field.value}
                          onCheckedChange={field.onChange}
                        />
                      </FormControl>
                    </FormItem>
                  )}
                />

                {/* Stock Fields */}
                {watchTrackStock && (
                  <div className="grid gap-4 sm:grid-cols-3">
                    <FormField
                      control={form.control}
                      name="stock"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Jumlah Stok</FormLabel>
                          <FormControl>
                            <Input
                              type="number"
                              placeholder="0"
                              {...field}
                              value={field.value ?? ''}
                              onChange={(e) =>
                                field.onChange(
                                  e.target.value ? Number(e.target.value) : undefined
                                )
                              }
                            />
                          </FormControl>
                          <FormMessage />
                        </FormItem>
                      )}
                    />

                    <FormField
                      control={form.control}
                      name="minStock"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Stok Minimum</FormLabel>
                          <FormControl>
                            <Input
                              type="number"
                              placeholder="5"
                              {...field}
                              value={field.value ?? ''}
                              onChange={(e) =>
                                field.onChange(
                                  e.target.value ? Number(e.target.value) : undefined
                                )
                              }
                            />
                          </FormControl>
                          <FormDescription>
                            Peringatan jika stok di bawah ini
                          </FormDescription>
                        </FormItem>
                      )}
                    />

                    <FormField
                      control={form.control}
                      name="unit"
                      render={({ field }) => (
                        <FormItem>
                          <FormLabel>Satuan</FormLabel>
                          <Select
                            onValueChange={field.onChange}
                            value={field.value || 'pcs'}
                          >
                            <FormControl>
                              <SelectTrigger>
                                <SelectValue />
                              </SelectTrigger>
                            </FormControl>
                            <SelectContent>
                              {UNIT_OPTIONS.map((unit) => (
                                <SelectItem key={unit.value} value={unit.value}>
                                  {unit.label}
                                </SelectItem>
                              ))}
                            </SelectContent>
                          </Select>
                          <FormMessage />
                        </FormItem>
                      )}
                    />
                  </div>
                )}
              </CardContent>
            </Card>
          </div>

          {/* Sidebar */}
          <div className="space-y-6">
            {/* Status */}
            <Card>
              <CardHeader>
                <CardTitle>Status</CardTitle>
              </CardHeader>
              <CardContent className="space-y-4">
                <FormField
                  control={form.control}
                  name="isActive"
                  render={({ field }) => (
                    <FormItem className="flex items-center justify-between">
                      <div>
                        <FormLabel>Aktif</FormLabel>
                        <FormDescription>
                          Tampilkan di toko
                        </FormDescription>
                      </div>
                      <FormControl>
                        <Switch
                          checked={field.value}
                          onCheckedChange={field.onChange}
                        />
                      </FormControl>
                    </FormItem>
                  )}
                />

                <Separator />

                <FormField
                  control={form.control}
                  name="isFeatured"
                  render={({ field }) => (
                    <FormItem className="flex items-center justify-between">
                      <div>
                        <FormLabel>Unggulan</FormLabel>
                        <FormDescription>
                          Tampilkan di halaman utama
                        </FormDescription>
                      </div>
                      <FormControl>
                        <Switch
                          checked={field.value}
                          onCheckedChange={field.onChange}
                        />
                      </FormControl>
                    </FormItem>
                  )}
                />
              </CardContent>
            </Card>

            {/* Actions */}
            <Card>
              <CardContent className="pt-6 space-y-2">
                <Button type="submit" className="w-full" disabled={isLoading}>
                  {isLoading ? (
                    <>
                      <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                      {isEditing ? 'Menyimpan...' : 'Membuat...'}
                    </>
                  ) : (
                    <>
                      <Save className="h-4 w-4 mr-2" />
                      {isEditing ? 'Simpan Perubahan' : 'Simpan Produk'}
                    </>
                  )}
                </Button>
                <Button
                  type="button"
                  variant="outline"
                  className="w-full"
                  onClick={() => router.back()}
                >
                  <ArrowLeft className="h-4 w-4 mr-2" />
                  Kembali
                </Button>
              </CardContent>
            </Card>
          </div>
        </div>
      </form>
    </Form>
  );
}

================================================
FILE: src/components/products/products-table.tsx
Lines: 295
================================================

'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import {
  ColumnFiltersState,
  SortingState,
  VisibilityState,
  flexRender,
  getCoreRowModel,
  getFilteredRowModel,
  getPaginationRowModel,
  getSortedRowModel,
  useReactTable,
} from '@tanstack/react-table';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { getProductColumns } from './products-table-columns';
import { ProductsTableToolbar } from './products-table-toolbar';
import { ProductDeleteDialog } from './product-delete-dialog';
import { useDeleteProduct, useUpdateProduct } from '@/hooks';
import { toast } from '@/providers';
import { productsApi, getErrorMessage } from '@/lib/api';
import type { Product } from '@/types';

// ‚úÖ Import AlertDialog for bulk delete
import {
  AlertDialog,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from '@/components/ui/alert-dialog';
import { AlertTriangle, Loader2 } from 'lucide-react';

// ==========================================
// PRODUCTS TABLE COMPONENT
// ==========================================

interface ProductsTableProps {
  products: Product[];
  categories: string[];
  onRefresh?: () => void; // ‚úÖ ADD: Callback untuk refetch data
}

export function ProductsTable({ products, categories, onRefresh }: ProductsTableProps) {
  const router = useRouter();
  const [sorting, setSorting] = useState<SortingState>([]);
  const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([]);
  const [columnVisibility, setColumnVisibility] = useState<VisibilityState>({});
  const [rowSelection, setRowSelection] = useState({});

  // Delete dialog state (single)
  const [deleteProduct, setDeleteProduct] = useState<Product | null>(null);

  // ‚úÖ Bulk delete dialog state
  const [isBulkDeleteOpen, setIsBulkDeleteOpen] = useState(false);
  const [isBulkDeleting, setIsBulkDeleting] = useState(false);
  const [bulkDeleteIds, setBulkDeleteIds] = useState<string[]>([]);

  // Hooks
  const { deleteProduct: performDelete, isLoading: isDeleting } = useDeleteProduct();
  const { updateProduct } = useUpdateProduct();

  // ‚úÖ Helper: Refresh data
  const refreshData = () => {
    if (onRefresh) {
      onRefresh(); // Use callback if provided
    } else {
      router.refresh(); // Fallback to router refresh
    }
  };

  // Column actions
  const columnActions = {
    onEdit: (product: Product) => {
      router.push(`/dashboard/products/${product.id}/edit`);
    },
    onDelete: (product: Product) => {
      setDeleteProduct(product);
    },
    onToggleActive: async (product: Product) => {
      try {
        await updateProduct(product.id, { isActive: !product.isActive });
        refreshData(); // ‚úÖ Use helper
      } catch {
        // Error handled in hook
      }
    },
  };

  const columns = getProductColumns(columnActions);

  const table = useReactTable({
    data: products,
    columns,
    onSortingChange: setSorting,
    onColumnFiltersChange: setColumnFilters,
    getCoreRowModel: getCoreRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    getSortedRowModel: getSortedRowModel(),
    getFilteredRowModel: getFilteredRowModel(),
    onColumnVisibilityChange: setColumnVisibility,
    onRowSelectionChange: setRowSelection,
    state: {
      sorting,
      columnFilters,
      columnVisibility,
      rowSelection,
    },
  });

  // Handle single delete
  const handleDelete = async () => {
    if (!deleteProduct) return;

    const success = await performDelete(deleteProduct.id);
    if (success) {
      setDeleteProduct(null);
      refreshData(); // ‚úÖ Use helper
    }
  };

  // ‚úÖ Open bulk delete dialog (tidak langsung delete)
  const openBulkDeleteDialog = () => {
    const selectedRows = table.getFilteredSelectedRowModel().rows;
    const ids = selectedRows.map((row) => row.original.id);

    if (ids.length === 0) return;

    setBulkDeleteIds(ids);
    setIsBulkDeleteOpen(true);
  };

  // ‚úÖ Perform bulk delete
  const handleBulkDelete = async () => {
    if (bulkDeleteIds.length === 0) return;

    setIsBulkDeleting(true);

    try {
      const result = await productsApi.bulkDelete(bulkDeleteIds);

      toast.success(result.message || `${result.count} produk berhasil dihapus`);
      setRowSelection({});
      setIsBulkDeleteOpen(false);
      setBulkDeleteIds([]);
      refreshData(); // ‚úÖ Use helper instead of router.refresh()
    } catch (err) {
      toast.error('Gagal menghapus produk', getErrorMessage(err));
    } finally {
      setIsBulkDeleting(false);
    }
  };

  return (
    <div className="space-y-4">
      {/* Toolbar */}
      <ProductsTableToolbar
        table={table}
        categories={categories}
        onBulkDelete={openBulkDeleteDialog}
        isBulkDeleting={isBulkDeleting}
      />

      {/* Table */}
      <div className="rounded-md border">
        <Table>
          <TableHeader>
            {table.getHeaderGroups().map((headerGroup) => (
              <TableRow key={headerGroup.id}>
                {headerGroup.headers.map((header) => (
                  <TableHead key={header.id}>
                    {header.isPlaceholder
                      ? null
                      : flexRender(
                        header.column.columnDef.header,
                        header.getContext()
                      )}
                  </TableHead>
                ))}
              </TableRow>
            ))}
          </TableHeader>
          <TableBody>
            {table.getRowModel().rows?.length ? (
              table.getRowModel().rows.map((row) => (
                <TableRow
                  key={row.id}
                  data-state={row.getIsSelected() && 'selected'}
                >
                  {row.getVisibleCells().map((cell) => (
                    <TableCell key={cell.id}>
                      {flexRender(
                        cell.column.columnDef.cell,
                        cell.getContext()
                      )}
                    </TableCell>
                  ))}
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell
                  colSpan={columns.length}
                  className="h-24 text-center"
                >
                  Tidak ada produk ditemukan.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>

      {/* Pagination */}
      <div className="flex items-center justify-between">
        <div className="text-sm text-muted-foreground">
          {table.getFilteredSelectedRowModel().rows.length} dari{' '}
          {table.getFilteredRowModel().rows.length} baris dipilih.
        </div>
        <div className="flex items-center space-x-2">
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.previousPage()}
            disabled={!table.getCanPreviousPage()}
          >
            Sebelumnya
          </Button>
          <Button
            variant="outline"
            size="sm"
            onClick={() => table.nextPage()}
            disabled={!table.getCanNextPage()}
          >
            Selanjutnya
          </Button>
        </div>
      </div>

      {/* Single Delete Dialog */}
      <ProductDeleteDialog
        product={deleteProduct}
        isOpen={!!deleteProduct}
        isLoading={isDeleting}
        onClose={() => setDeleteProduct(null)}
        onConfirm={handleDelete}
      />

      {/* ‚úÖ Bulk Delete Dialog - styled like single delete */}
      <AlertDialog open={isBulkDeleteOpen} onOpenChange={setIsBulkDeleteOpen}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-destructive/10">
                <AlertTriangle className="h-5 w-5 text-destructive" />
              </div>
              <AlertDialogTitle>Hapus {bulkDeleteIds.length} Produk</AlertDialogTitle>
            </div>
            <AlertDialogDescription className="pt-2">
              Apakah Anda yakin ingin menghapus <strong>{bulkDeleteIds.length} produk</strong> yang dipilih?
              Tindakan ini tidak dapat dibatalkan.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel disabled={isBulkDeleting}>Batal</AlertDialogCancel>
            <Button
              variant="destructive"
              onClick={handleBulkDelete}
              disabled={isBulkDeleting}
            >
              {isBulkDeleting ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                  Menghapus...
                </>
              ) : (
                'Hapus'
              )}
            </Button>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </div>
  );
}

================================================
FILE: src/components/products/products-table-columns.tsx
Lines: 224
================================================

'use client';

import { ColumnDef } from '@tanstack/react-table';
import Image from 'next/image';
import { MoreHorizontal, ArrowUpDown, Package } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Checkbox } from '@/components/ui/checkbox';
import { Badge } from '@/components/ui/badge';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { formatPrice, formatDateShort } from '@/lib/format';
import type { Product } from '@/types';

// ==========================================
// PRODUCTS TABLE COLUMNS
// ==========================================

interface ColumnActions {
  onEdit: (product: Product) => void;
  onDelete: (product: Product) => void;
  onToggleActive: (product: Product) => void;
}

export function getProductColumns(actions: ColumnActions): ColumnDef<Product>[] {
  return [
    // Checkbox
    {
      id: 'select',
      header: ({ table }) => (
        <Checkbox
          checked={
            table.getIsAllPageRowsSelected() ||
            (table.getIsSomePageRowsSelected() && 'indeterminate')
          }
          onCheckedChange={(value) => table.toggleAllPageRowsSelected(!!value)}
          aria-label="Select all"
        />
      ),
      cell: ({ row }) => (
        <Checkbox
          checked={row.getIsSelected()}
          onCheckedChange={(value) => row.toggleSelected(!!value)}
          aria-label="Select row"
        />
      ),
      enableSorting: false,
      enableHiding: false,
    },

    // Image + Name
    {
      accessorKey: 'name',
      header: ({ column }) => (
        <Button
          variant="ghost"
          onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
        >
          Produk
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      cell: ({ row }) => {
        const product = row.original;
        return (
          <div className="flex items-center gap-3">
            <div className="relative h-10 w-10 overflow-hidden rounded-lg bg-muted flex-shrink-0">
              {product.images[0] ? (
                <Image
                  src={product.images[0]}
                  alt={product.name}
                  fill
                  className="object-cover"
                />
              ) : (
                <div className="flex h-full items-center justify-center">
                  <Package className="h-4 w-4 text-muted-foreground" />
                </div>
              )}
            </div>
            <div className="min-w-0">
              <p className="font-medium truncate max-w-[200px]">{product.name}</p>
              {product.sku && (
                <p className="text-xs text-muted-foreground">SKU: {product.sku}</p>
              )}
            </div>
          </div>
        );
      },
    },

    // Category
    {
      accessorKey: 'category',
      header: 'Kategori',
      cell: ({ row }) => {
        const category = row.getValue('category') as string | null;
        return category ? (
          <Badge variant="outline">{category}</Badge>
        ) : (
          <span className="text-muted-foreground">-</span>
        );
      },
    },

    // Price
    {
      accessorKey: 'price',
      header: ({ column }) => (
        <Button
          variant="ghost"
          onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
        >
          Harga
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      cell: ({ row }) => {
        const price = row.getValue('price') as number;
        return <span className="font-medium">{formatPrice(price)}</span>;
      },
    },

    // Stock
    {
      accessorKey: 'stock',
      header: ({ column }) => (
        <Button
          variant="ghost"
          onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
        >
          Stok
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      cell: ({ row }) => {
        const product = row.original;
        if (!product.trackStock) {
          return <span className="text-muted-foreground">-</span>;
        }
        const stock = product.stock ?? 0;
        const minStock = product.minStock ?? 5;
        const isLow = stock <= minStock;
        return (
          <span className={isLow ? 'text-orange-500 font-medium' : ''}>
            {stock} {product.unit || 'pcs'}
          </span>
        );
      },
    },

    // Status
    {
      accessorKey: 'isActive',
      header: 'Status',
      cell: ({ row }) => {
        const isActive = row.getValue('isActive') as boolean;
        return (
          <Badge variant={isActive ? 'default' : 'secondary'}>
            {isActive ? 'Aktif' : 'Nonaktif'}
          </Badge>
        );
      },
    },

    // Created At
    {
      accessorKey: 'createdAt',
      header: ({ column }) => (
        <Button
          variant="ghost"
          onClick={() => column.toggleSorting(column.getIsSorted() === 'asc')}
        >
          Dibuat
          <ArrowUpDown className="ml-2 h-4 w-4" />
        </Button>
      ),
      cell: ({ row }) => {
        const date = row.getValue('createdAt') as string;
        return <span className="text-muted-foreground">{formatDateShort(date)}</span>;
      },
    },

    // Actions
    {
      id: 'actions',
      enableHiding: false,
      cell: ({ row }) => {
        const product = row.original;

        return (
          <DropdownMenu>
            <DropdownMenuTrigger asChild>
              <Button variant="ghost" className="h-8 w-8 p-0">
                <span className="sr-only">Buka menu</span>
                <MoreHorizontal className="h-4 w-4" />
              </Button>
            </DropdownMenuTrigger>
            <DropdownMenuContent align="end">
              <DropdownMenuLabel>Aksi</DropdownMenuLabel>
              <DropdownMenuItem onClick={() => actions.onEdit(product)}>
                Edit
              </DropdownMenuItem>
              <DropdownMenuItem onClick={() => actions.onToggleActive(product)}>
                {product.isActive ? 'Nonaktifkan' : 'Aktifkan'}
              </DropdownMenuItem>
              <DropdownMenuSeparator />
              <DropdownMenuItem
                onClick={() => actions.onDelete(product)}
                className="text-destructive"
              >
                Hapus
              </DropdownMenuItem>
            </DropdownMenuContent>
          </DropdownMenu>
        );
      },
    },
  ];
}

================================================
FILE: src/components/products/products-table-toolbar.tsx
Lines: 139
================================================

'use client';

import { Table } from '@tanstack/react-table';
import { X, Search, Trash2, Loader2 } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import type { Product } from '@/types';

// ==========================================
// PRODUCTS TABLE TOOLBAR
// ==========================================

interface ProductsTableToolbarProps {
  table: Table<Product>;
  categories: string[];
  onBulkDelete?: () => void;
  isBulkDeleting?: boolean;  // ‚úÖ ADDED
}

export function ProductsTableToolbar({
  table,
  categories,
  onBulkDelete,
  isBulkDeleting = false,  // ‚úÖ ADDED with default
}: ProductsTableToolbarProps) {
  const isFiltered = table.getState().columnFilters.length > 0;
  const selectedCount = table.getFilteredSelectedRowModel().rows.length;

  return (
    <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
      <div className="flex flex-1 items-center gap-2">
        {/* Search */}
        <div className="relative w-full sm:w-64">
          <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
          <Input
            placeholder="Cari produk..."
            value={(table.getColumn('name')?.getFilterValue() as string) ?? ''}
            onChange={(event) =>
              table.getColumn('name')?.setFilterValue(event.target.value)
            }
            className="pl-8"
          />
        </div>

        {/* Category Filter */}
        <Select
          value={(table.getColumn('category')?.getFilterValue() as string) ?? 'all'}
          onValueChange={(value) =>
            table.getColumn('category')?.setFilterValue(value === 'all' ? '' : value)
          }
        >
          <SelectTrigger className="w-40">
            <SelectValue placeholder="Kategori" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">Semua Kategori</SelectItem>
            {categories.map((cat) => (
              <SelectItem key={cat} value={cat}>
                {cat}
              </SelectItem>
            ))}
          </SelectContent>
        </Select>

        {/* Status Filter */}
        <Select
          value={
            table.getColumn('isActive')?.getFilterValue() === true
              ? 'active'
              : table.getColumn('isActive')?.getFilterValue() === false
                ? 'inactive'
                : 'all'
          }
          onValueChange={(value) =>
            table
              .getColumn('isActive')
              ?.setFilterValue(
                value === 'all' ? undefined : value === 'active'
              )
          }
        >
          <SelectTrigger className="w-32">
            <SelectValue placeholder="Status" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">Semua</SelectItem>
            <SelectItem value="active">Aktif</SelectItem>
            <SelectItem value="inactive">Nonaktif</SelectItem>
          </SelectContent>
        </Select>

        {/* Reset Filters */}
        {isFiltered && (
          <Button
            variant="ghost"
            onClick={() => table.resetColumnFilters()}
            className="px-2 lg:px-3"
          >
            Reset
            <X className="ml-2 h-4 w-4" />
          </Button>
        )}
      </div>

      {/* Bulk Actions */}
      {selectedCount > 0 && (
        <div className="flex items-center gap-2">
          <span className="text-sm text-muted-foreground">
            {selectedCount} dipilih
          </span>
          <Button
            variant="destructive"
            size="sm"
            onClick={onBulkDelete}
            disabled={isBulkDeleting}  // ‚úÖ ADDED
          >
            {isBulkDeleting ? (
              <>
                <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                Menghapus...
              </>
            ) : (
              <>
                <Trash2 className="h-4 w-4 mr-2" />
                Hapus
              </>
            )}
          </Button>
        </div>
      )}
    </div>
  );
}


################################################################
##
##  CATEGORY: Settings Components
##  Path: src/components/settings
##
################################################################

================================================
FILE: src/components/settings/index.ts
Lines: 9
================================================

// ==========================================
// SETTINGS COMPONENTS INDEX
// ==========================================

export { SettingsTabs } from './settings-tabs';
export { StoreProfileForm } from './store-profile-form';
export { StoreContactForm } from './store-contact-form';
export { AccountSettingsForm } from './account-settings-form';
export { AppearanceSettings } from './appearance-settings';
export { DangerZone } from './danger-zone';

================================================
FILE: src/components/settings/account-settings-form.tsx
Lines: 246
================================================

'use client';

import { useRouter } from 'next/navigation';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Loader2, Save, Eye, EyeOff } from 'lucide-react';
import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import { useUpdateTenant, useChangePassword } from '@/hooks';
import type { Tenant } from '@/types';

// ==========================================
// ACCOUNT SETTINGS FORM
// ==========================================

const accountSchema = z.object({
  email: z.string().email('Email tidak valid'),
});

const passwordSchema = z.object({
  currentPassword: z.string().min(1, 'Password saat ini wajib diisi'),
  newPassword: z.string().min(6, 'Password minimal 6 karakter'),
  confirmPassword: z.string(),
}).refine((data) => data.newPassword === data.confirmPassword, {
  message: 'Password tidak cocok',
  path: ['confirmPassword'],
});

type AccountData = z.infer<typeof accountSchema>;
type PasswordData = z.infer<typeof passwordSchema>;

interface AccountSettingsFormProps {
  tenant: Tenant;
}

export function AccountSettingsForm({ tenant }: AccountSettingsFormProps) {
  const router = useRouter();
  const { updateTenant, isLoading: isUpdating } = useUpdateTenant();
  const { changePassword, isLoading: isChangingPassword } = useChangePassword();

  const [showCurrentPassword, setShowCurrentPassword] = useState(false);
  const [showNewPassword, setShowNewPassword] = useState(false);

  // Account form
  const accountForm = useForm<AccountData>({
    resolver: zodResolver(accountSchema),
    defaultValues: {
      email: tenant.email || '',
    },
  });

  // Password form
  const passwordForm = useForm<PasswordData>({
    resolver: zodResolver(passwordSchema),
    defaultValues: {
      currentPassword: '',
      newPassword: '',
      confirmPassword: '',
    },
  });

  const onAccountSubmit = async (data: AccountData) => {
    try {
      await updateTenant({ email: data.email });
      router.refresh();
    } catch {
      // Error handled in hook
    }
  };

  const onPasswordSubmit = async (data: PasswordData) => {
    try {
      await changePassword(data.currentPassword, data.newPassword);
      passwordForm.reset();
    } catch {
      // Error handled in hook
    }
  };

  return (
    <div className="space-y-6">
      {/* Email Settings */}
      <Card>
        <CardHeader>
          <CardTitle>Email Akun</CardTitle>
          <CardDescription>
            Email yang digunakan untuk login ke dashboard
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Form {...accountForm}>
            <form onSubmit={accountForm.handleSubmit(onAccountSubmit)} className="space-y-4">
              <FormField
                control={accountForm.control}
                name="email"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Email</FormLabel>
                    <FormControl>
                      <Input type="email" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <Button type="submit" disabled={isUpdating}>
                {isUpdating ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    Menyimpan...
                  </>
                ) : (
                  <>
                    <Save className="h-4 w-4 mr-2" />
                    Simpan Email
                  </>
                )}
              </Button>
            </form>
          </Form>
        </CardContent>
      </Card>

      {/* Password Settings */}
      <Card>
        <CardHeader>
          <CardTitle>Ubah Password</CardTitle>
          <CardDescription>
            Pastikan password Anda kuat dan tidak digunakan di tempat lain
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Form {...passwordForm}>
            <form onSubmit={passwordForm.handleSubmit(onPasswordSubmit)} className="space-y-4">
              <FormField
                control={passwordForm.control}
                name="currentPassword"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Password Saat Ini</FormLabel>
                    <FormControl>
                      <div className="relative">
                        <Input
                          type={showCurrentPassword ? 'text' : 'password'}
                          {...field}
                        />
                        <button
                          type="button"
                          onClick={() => setShowCurrentPassword(!showCurrentPassword)}
                          className="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground"
                        >
                          {showCurrentPassword ? (
                            <EyeOff className="h-4 w-4" />
                          ) : (
                            <Eye className="h-4 w-4" />
                          )}
                        </button>
                      </div>
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <FormField
                control={passwordForm.control}
                name="newPassword"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Password Baru</FormLabel>
                    <FormControl>
                      <div className="relative">
                        <Input
                          type={showNewPassword ? 'text' : 'password'}
                          {...field}
                        />
                        <button
                          type="button"
                          onClick={() => setShowNewPassword(!showNewPassword)}
                          className="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground"
                        >
                          {showNewPassword ? (
                            <EyeOff className="h-4 w-4" />
                          ) : (
                            <Eye className="h-4 w-4" />
                          )}
                        </button>
                      </div>
                    </FormControl>
                    <FormDescription>
                      Minimal 6 karakter
                    </FormDescription>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <FormField
                control={passwordForm.control}
                name="confirmPassword"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Konfirmasi Password Baru</FormLabel>
                    <FormControl>
                      <Input type="password" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <Button type="submit" disabled={isChangingPassword}>
                {isChangingPassword ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    Mengubah...
                  </>
                ) : (
                  'Ubah Password'
                )}
              </Button>
            </form>
          </Form>
        </CardContent>
      </Card>
    </div>
  );
}

================================================
FILE: src/components/settings/appearance-settings.tsx
Lines: 224
================================================

"use client";

import { useState, useEffect } from "react";
import { Check, Loader2 } from "lucide-react";
import { toast } from "sonner";

import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import { ImageUpload } from "@/components/upload/image-upload";

// ==========================================
// THEME COLORS - Connect ke backend theme.primaryColor
// ==========================================
const THEME_COLORS = [
  { name: "Default", value: "#0ea5e9", class: "bg-sky-500" },
  { name: "Emerald", value: "#10b981", class: "bg-emerald-500" },
  { name: "Rose", value: "#f43f5e", class: "bg-rose-500" },
  { name: "Amber", value: "#f59e0b", class: "bg-amber-500" },
  { name: "Violet", value: "#8b5cf6", class: "bg-violet-500" },
  { name: "Orange", value: "#f97316", class: "bg-orange-500" },
] as const;

interface AppearanceSettingsProps {
  tenantData: {
    logo?: string | null;
    banner?: string | null;
    theme?: {
      primaryColor?: string;
    } | null;
  };
  onUpdate: (data: {
    logo?: string;
    banner?: string;
    theme?: { primaryColor: string };
  }) => Promise<void>;
  isLoading?: boolean;
}

export function AppearanceSettings({
  tenantData,
  onUpdate,
  isLoading: externalLoading,
}: AppearanceSettingsProps) {
  // Local state for optimistic updates
  const [logo, setLogo] = useState(tenantData?.logo || "");
  const [banner, setBanner] = useState(tenantData?.banner || "");
  const [primaryColor, setPrimaryColor] = useState(
    tenantData?.theme?.primaryColor || THEME_COLORS[0].value
  );
  const [isSaving, setIsSaving] = useState(false);
  const [hasChanges, setHasChanges] = useState(false);

  // Sync state when tenantData changes
  useEffect(() => {
    setLogo(tenantData?.logo || "");
    setBanner(tenantData?.banner || "");
    setPrimaryColor(tenantData?.theme?.primaryColor || THEME_COLORS[0].value);
  }, [tenantData]);

  // Track changes
  useEffect(() => {
    const originalLogo = tenantData?.logo || "";
    const originalBanner = tenantData?.banner || "";
    const originalColor = tenantData?.theme?.primaryColor || THEME_COLORS[0].value;

    const changed =
      logo !== originalLogo ||
      banner !== originalBanner ||
      primaryColor !== originalColor;

    setHasChanges(changed);
  }, [logo, banner, primaryColor, tenantData]);

  // Handle save
  const handleSave = async () => {
    setIsSaving(true);
    try {
      await onUpdate({
        logo: logo || undefined,
        banner: banner || undefined,
        theme: { primaryColor },
      });

      toast.success("Tampilan berhasil diperbarui");
      setHasChanges(false);
    } catch (error) {
      console.error("Failed to update appearance:", error);
      toast.error("Gagal memperbarui tampilan");
    } finally {
      setIsSaving(false);
    }
  };

  const isLoading = externalLoading || isSaving;

  return (
    <div className="space-y-6">
      {/* Logo & Banner */}
      <Card>
        <CardHeader>
          <CardTitle>Logo & Banner</CardTitle>
          <CardDescription>
            Gambar yang ditampilkan di toko online Anda
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-6">
          {/* Logo */}
          <div className="space-y-2">
            <label className="text-sm font-medium">Logo Toko</label>
            <p className="text-xs text-muted-foreground">
              Rasio 1:1 (kotak), ukuran rekomendasi 512x512px
            </p>
            <div className="w-32">
              <ImageUpload
                value={logo}
                onChange={setLogo}
                onRemove={() => setLogo("")}
                aspectRatio={1}
                folder="tenant-logos"
                placeholder="Upload Logo"
                disabled={isLoading}
              />
            </div>
          </div>

          {/* Banner */}
          <div className="space-y-2">
            <label className="text-sm font-medium">Banner Toko</label>
            <p className="text-xs text-muted-foreground">
              Rasio 3:1 (landscape), ukuran rekomendasi 1200x400px
            </p>
            <div className="max-w-md">
              <ImageUpload
                value={banner}
                onChange={setBanner}
                onRemove={() => setBanner("")}
                aspectRatio={3}
                folder="tenant-banners"
                placeholder="Upload Banner"
                disabled={isLoading}
              />
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Theme Color */}
      <Card>
        <CardHeader>
          <CardTitle>Warna Tema</CardTitle>
          <CardDescription>
            Pilih warna utama untuk toko online Anda
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-3 sm:grid-cols-6 gap-3">
            {THEME_COLORS.map((color) => (
              <button
                key={color.value}
                type="button"
                onClick={() => setPrimaryColor(color.value)}
                disabled={isLoading}
                className={cn(
                  "relative flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition-all",
                  primaryColor === color.value
                    ? "border-primary bg-primary/5"
                    : "border-transparent hover:border-muted-foreground/20",
                  isLoading && "opacity-50 cursor-not-allowed"
                )}
              >
                <div
                  className={cn(
                    "w-10 h-10 rounded-full flex items-center justify-center",
                    color.class
                  )}
                >
                  {primaryColor === color.value && (
                    <Check className="h-5 w-5 text-white" />
                  )}
                </div>
                <span className="text-xs font-medium">{color.name}</span>
              </button>
            ))}
          </div>
          <p className="text-xs text-muted-foreground mt-4">
            Warna tema akan diterapkan pada tombol, link, dan elemen aksen di toko online Anda.
          </p>
        </CardContent>
      </Card>

      {/* Dark Mode Info */}
      <Card>
        <CardHeader>
          <CardTitle>Mode Gelap</CardTitle>
          <CardDescription>
            Ubah tampilan antara mode terang dan gelap
          </CardDescription>
        </CardHeader>
        <CardContent>
          <p className="text-sm text-muted-foreground">
            Gunakan tombol üåô/‚òÄÔ∏è di header untuk mengubah mode tampilan.
            Preferensi akan disimpan secara otomatis di browser Anda.
          </p>
        </CardContent>
      </Card>

      {/* Save Button */}
      {hasChanges && (
        <div className="flex justify-end">
          <Button onClick={handleSave} disabled={isLoading}>
            {isSaving && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            Simpan Perubahan
          </Button>
        </div>
      )}
    </div>
  );
}

================================================
FILE: src/components/settings/danger-zone.tsx
Lines: 123
================================================

'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { Loader2, AlertTriangle, Trash2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import {
  AlertDialog,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from '@/components/ui/alert-dialog';
import { useDeleteAccount, useAuth } from '@/hooks';

// ==========================================
// DANGER ZONE
// ==========================================

export function DangerZone() {
  const router = useRouter();
  const { tenant } = useAuth();
  const { deleteAccount, isLoading } = useDeleteAccount();

  const [confirmText, setConfirmText] = useState('');
  const [isOpen, setIsOpen] = useState(false);

  const confirmationText = tenant?.slug || 'hapus-akun';
  const isConfirmed = confirmText === confirmationText;

  const handleDelete = async () => {
    if (!isConfirmed) return;

    try {
      await deleteAccount();
      router.push('/');
    } catch {
      // Error handled in hook
    }
  };

  return (
    <Card className="border-destructive/50">
      <CardHeader>
        <CardTitle className="text-destructive flex items-center gap-2">
          <AlertTriangle className="h-5 w-5" />
          Zona Berbahaya
        </CardTitle>
        <CardDescription>
          Tindakan di sini bersifat permanen dan tidak dapat dibatalkan
        </CardDescription>
      </CardHeader>
      <CardContent>
        <AlertDialog open={isOpen} onOpenChange={setIsOpen}>
          <AlertDialogTrigger asChild>
            <Button variant="destructive">
              <Trash2 className="h-4 w-4 mr-2" />
              Hapus Akun
            </Button>
          </AlertDialogTrigger>
          <AlertDialogContent>
            <AlertDialogHeader>
              <AlertDialogTitle className="flex items-center gap-2">
                <AlertTriangle className="h-5 w-5 text-destructive" />
                Hapus Akun Permanen
              </AlertDialogTitle>
              <AlertDialogDescription className="space-y-4">
                <p>
                  Tindakan ini akan menghapus akun Anda secara permanen beserta
                  semua data toko, produk, pelanggan, dan pesanan. Tindakan ini
                  tidak dapat dibatalkan.
                </p>
                <p>
                  Untuk konfirmasi, ketik{' '}
                  <strong className="text-foreground">{confirmationText}</strong>{' '}
                  di bawah:
                </p>
                <Input
                  value={confirmText}
                  onChange={(e) => setConfirmText(e.target.value)}
                  placeholder={confirmationText}
                  className="mt-2"
                />
              </AlertDialogDescription>
            </AlertDialogHeader>
            <AlertDialogFooter>
              <AlertDialogCancel
                onClick={() => setConfirmText('')}
                disabled={isLoading}
              >
                Batal
              </AlertDialogCancel>
              <Button
                variant="destructive"
                onClick={handleDelete}
                disabled={!isConfirmed || isLoading}
              >
                {isLoading ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    Menghapus...
                  </>
                ) : (
                  'Hapus Akun Saya'
                )}
              </Button>
            </AlertDialogFooter>
          </AlertDialogContent>
        </AlertDialog>
      </CardContent>
    </Card>
  );
}

================================================
FILE: src/components/settings/settings-tabs.tsx
Lines: 73
================================================

'use client';

import { usePathname, useRouter, useSearchParams } from 'next/navigation';
import { Store, Phone, User, Palette } from 'lucide-react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { StoreProfileForm } from './store-profile-form';
import { StoreContactForm } from './store-contact-form';
import { AccountSettingsForm } from './account-settings-form';
import { AppearanceSettings } from './appearance-settings';
import { DangerZone } from './danger-zone';
import type { Tenant } from '@/types';

// ==========================================
// SETTINGS TABS
// ==========================================

interface SettingsTabsProps {
  tenant: Tenant;
}

const tabs = [
  { value: 'store', label: 'Profil Toko', icon: Store },
  { value: 'contact', label: 'Kontak', icon: Phone },
  { value: 'account', label: 'Akun', icon: User },
  { value: 'appearance', label: 'Tampilan', icon: Palette },
];

export function SettingsTabs({ tenant }: SettingsTabsProps) {
  const router = useRouter();
  const pathname = usePathname();
  const searchParams = useSearchParams();

  const currentTab = searchParams.get('tab') || 'store';

  const handleTabChange = (value: string) => {
    const params = new URLSearchParams(searchParams);
    params.set('tab', value);
    router.push(`${pathname}?${params.toString()}`);
  };

  return (
    <Tabs value={currentTab} onValueChange={handleTabChange} className="space-y-6">
      <TabsList className="grid w-full grid-cols-2 lg:grid-cols-4">
        {tabs.map((tab) => (
          <TabsTrigger
            key={tab.value}
            value={tab.value}
            className="flex items-center gap-2"
          >
            <tab.icon className="h-4 w-4" />
            <span className="hidden sm:inline">{tab.label}</span>
          </TabsTrigger>
        ))}
      </TabsList>

      <TabsContent value="store" className="space-y-6">
        <StoreProfileForm tenant={tenant} />
      </TabsContent>

      <TabsContent value="contact" className="space-y-6">
        <StoreContactForm tenant={tenant} />
      </TabsContent>

      <TabsContent value="account" className="space-y-6">
        <AccountSettingsForm tenant={tenant} />
      </TabsContent>

      <TabsContent value="appearance" className="space-y-6">
        <AppearanceSettings />
        <DangerZone />
      </TabsContent>
    </Tabs>
  );
}

================================================
FILE: src/components/settings/store-contact-form.tsx
Lines: 288
================================================

'use client';

import { useRouter } from 'next/navigation';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Loader2, Save } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import { useUpdateTenant } from '@/hooks';
import type { Tenant } from '@/types';

// ==========================================
// STORE CONTACT FORM
// ==========================================

const storeContactSchema = z.object({
  phone: z.string().min(10, 'Nomor telepon tidak valid'),
  email: z.string().email('Email tidak valid').optional().or(z.literal('')),
  address: z.string().optional(),
  instagram: z.string().optional(),
  facebook: z.string().optional(),
  tiktok: z.string().optional(),
});

type StoreContactData = z.infer<typeof storeContactSchema>;

interface StoreContactFormProps {
  tenant: Tenant;
}

export function StoreContactForm({ tenant }: StoreContactFormProps) {
  const router = useRouter();
  const { updateTenant, isLoading } = useUpdateTenant();

  const form = useForm<StoreContactData>({
    resolver: zodResolver(storeContactSchema),
    defaultValues: {
      phone: tenant.phone || '',
      email: tenant.email || '',
      address: tenant.address || '',
      instagram: tenant.socialMedia?.instagram || '',
      facebook: tenant.socialMedia?.facebook || '',
      tiktok: tenant.socialMedia?.tiktok || '',
    },
  });

  const onSubmit = async (data: StoreContactData) => {
    try {
      await updateTenant({
        phone: data.phone,
        email: data.email || undefined,
        address: data.address || undefined,
        socialMedia: {
          instagram: data.instagram || undefined,
          facebook: data.facebook || undefined,
          tiktok: data.tiktok || undefined,
        },
      });
      router.refresh();
    } catch {
      // Error handled in hook
    }
  };

  return (
    <div className="space-y-6">
      {/* Contact Info */}
      <Card>
        <CardHeader>
          <CardTitle>Informasi Kontak</CardTitle>
          <CardDescription>
            Informasi kontak yang akan ditampilkan kepada pelanggan
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Form {...form}>
            <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
              {/* Phone */}
              <FormField
                control={form.control}
                name="phone"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Nomor WhatsApp *</FormLabel>
                    <FormControl>
                      <div className="flex">
                        <span className="inline-flex items-center px-3 rounded-l-md border border-r-0 bg-muted text-sm text-muted-foreground">
                          +62
                        </span>
                        <Input
                          type="tel"
                          placeholder="81234567890"
                          className="rounded-l-none"
                          {...field}
                          onChange={(e) => {
                            let value = e.target.value.replace(/\D/g, '');
                            if (value.startsWith('0')) {
                              value = value.slice(1);
                            }
                            if (value.startsWith('62')) {
                              value = value.slice(2);
                            }
                            field.onChange(value);
                          }}
                        />
                      </div>
                    </FormControl>
                    <FormDescription>
                      Nomor ini digunakan untuk menerima pesanan via WhatsApp
                    </FormDescription>
                    <FormMessage />
                  </FormItem>
                )}
              />

              {/* Email */}
              <FormField
                control={form.control}
                name="email"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Email</FormLabel>
                    <FormControl>
                      <Input
                        type="email"
                        placeholder="toko@email.com"
                        {...field}
                      />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              {/* Address */}
              <FormField
                control={form.control}
                name="address"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Alamat</FormLabel>
                    <FormControl>
                      <Textarea
                        placeholder="Alamat lengkap toko..."
                        rows={3}
                        {...field}
                      />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <Button type="submit" disabled={isLoading}>
                {isLoading ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    Menyimpan...
                  </>
                ) : (
                  <>
                    <Save className="h-4 w-4 mr-2" />
                    Simpan Perubahan
                  </>
                )}
              </Button>
            </form>
          </Form>
        </CardContent>
      </Card>

      {/* Social Media */}
      <Card>
        <CardHeader>
          <CardTitle>Media Sosial</CardTitle>
          <CardDescription>
            Link media sosial yang akan ditampilkan di toko
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Form {...form}>
            <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
              <FormField
                control={form.control}
                name="instagram"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Instagram</FormLabel>
                    <FormControl>
                      <div className="flex">
                        <span className="inline-flex items-center px-3 rounded-l-md border border-r-0 bg-muted text-sm text-muted-foreground">
                          instagram.com/
                        </span>
                        <Input
                          placeholder="username"
                          className="rounded-l-none"
                          {...field}
                        />
                      </div>
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <FormField
                control={form.control}
                name="facebook"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Facebook</FormLabel>
                    <FormControl>
                      <div className="flex">
                        <span className="inline-flex items-center px-3 rounded-l-md border border-r-0 bg-muted text-sm text-muted-foreground">
                          facebook.com/
                        </span>
                        <Input
                          placeholder="username"
                          className="rounded-l-none"
                          {...field}
                        />
                      </div>
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <FormField
                control={form.control}
                name="tiktok"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>TikTok</FormLabel>
                    <FormControl>
                      <div className="flex">
                        <span className="inline-flex items-center px-3 rounded-l-md border border-r-0 bg-muted text-sm text-muted-foreground">
                          tiktok.com/@
                        </span>
                        <Input
                          placeholder="username"
                          className="rounded-l-none"
                          {...field}
                        />
                      </div>
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <Button type="submit" disabled={isLoading}>
                {isLoading ? (
                  <>
                    <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                    Menyimpan...
                  </>
                ) : (
                  <>
                    <Save className="h-4 w-4 mr-2" />
                    Simpan Perubahan
                  </>
                )}
              </Button>
            </form>
          </Form>
        </CardContent>
      </Card>
    </div>
  );
}

================================================
FILE: src/components/settings/store-profile-form.tsx
Lines: 294
================================================

'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import Image from 'next/image';
import { Loader2, Save, Upload, X, Store, ImageIcon } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Textarea } from '@/components/ui/textarea';
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { useUpdateTenant } from '@/hooks';
import { BUSINESS_CATEGORIES } from '@/config/constants';
import type { Tenant } from '@/types';

// ==========================================
// STORE PROFILE FORM
// ==========================================

const storeProfileSchema = z.object({
  name: z.string().min(2, 'Nama toko minimal 2 karakter'),
  description: z.string().optional(),
  category: z.string().optional(),
  logo: z.string().optional(),
  banner: z.string().optional(),
});

type StoreProfileData = z.infer<typeof storeProfileSchema>;

interface StoreProfileFormProps {
  tenant: Tenant;
}

export function StoreProfileForm({ tenant }: StoreProfileFormProps) {
  const router = useRouter();
  const { updateTenant, isLoading } = useUpdateTenant();

  const [logo, setLogo] = useState(tenant.logo || '');
  const [banner, setBanner] = useState(tenant.banner || '');

  const form = useForm<StoreProfileData>({
    resolver: zodResolver(storeProfileSchema),
    defaultValues: {
      name: tenant.name || '',
      description: tenant.description || '',
      category: tenant.category || '',
      logo: tenant.logo || '',
      banner: tenant.banner || '',
    },
  });

  const onSubmit = async (data: StoreProfileData) => {
    try {
      await updateTenant({
        ...data,
        logo,
        banner,
      });
      router.refresh();
    } catch {
      // Error handled in hook
    }
  };

  // Placeholder image upload handlers
  const handleLogoUpload = () => {
    const url = prompt('Masukkan URL logo:');
    if (url) setLogo(url);
  };

  const handleBannerUpload = () => {
    const url = prompt('Masukkan URL banner:');
    if (url) setBanner(url);
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle>Profil Toko</CardTitle>
        <CardDescription>
          Informasi dasar tentang toko Anda yang akan ditampilkan kepada pelanggan
        </CardDescription>
      </CardHeader>
      <CardContent>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
            {/* Logo & Banner */}
            <div className="grid gap-6 sm:grid-cols-2">
              {/* Logo */}
              <div className="space-y-2">
                <label className="text-sm font-medium">Logo Toko</label>
                <div className="flex items-center gap-4">
                  <div className="relative h-20 w-20 rounded-lg border-2 border-dashed border-muted-foreground/25 overflow-hidden">
                    {logo ? (
                      <>
                        <Image
                          src={logo}
                          alt="Logo"
                          fill
                          className="object-cover"
                          sizes="80px"
                        />
                        <button
                          type="button"
                          onClick={() => setLogo('')}
                          className="absolute top-1 right-1 p-1 rounded-full bg-destructive text-destructive-foreground z-10"
                        >
                          <X className="h-3 w-3" />
                        </button>
                      </>
                    ) : (
                      <div className="flex h-full items-center justify-center">
                        <Store className="h-8 w-8 text-muted-foreground" />
                      </div>
                    )}
                  </div>
                  <Button
                    type="button"
                    variant="outline"
                    size="sm"
                    onClick={handleLogoUpload}
                  >
                    <Upload className="h-4 w-4 mr-2" />
                    Upload
                  </Button>
                </div>
                <p className="text-xs text-muted-foreground">
                  Rekomendasi: 200x200 pixels
                </p>
              </div>

              {/* Banner */}
              <div className="space-y-2">
                <label className="text-sm font-medium">Banner Toko</label>
                <div className="relative h-20 w-full rounded-lg border-2 border-dashed border-muted-foreground/25 overflow-hidden">
                  {banner ? (
                    <>
                      <Image
                        src={banner}
                        alt="Banner"
                        fill
                        className="object-cover"
                        sizes="(max-width: 640px) 100vw, 50vw"
                      />
                      <button
                        type="button"
                        onClick={() => setBanner('')}
                        className="absolute top-1 right-1 p-1 rounded-full bg-destructive text-destructive-foreground z-10"
                      >
                        <X className="h-3 w-3" />
                      </button>
                    </>
                  ) : (
                    <div className="flex h-full items-center justify-center">
                      <ImageIcon className="h-8 w-8 text-muted-foreground" />
                    </div>
                  )}
                </div>
                <div className="flex items-center gap-2">
                  <Button
                    type="button"
                    variant="outline"
                    size="sm"
                    onClick={handleBannerUpload}
                  >
                    <Upload className="h-4 w-4 mr-2" />
                    Upload Banner
                  </Button>
                  <p className="text-xs text-muted-foreground">
                    Rekomendasi: 1200x400 pixels
                  </p>
                </div>
              </div>
            </div>

            {/* Name */}
            <FormField
              control={form.control}
              name="name"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Nama Toko *</FormLabel>
                  <FormControl>
                    <Input placeholder="Nama toko Anda" {...field} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Slug (read-only) */}
            <div className="space-y-2">
              <label className="text-sm font-medium">Alamat Toko</label>
              <div className="flex items-center gap-2">
                <span className="text-sm text-muted-foreground">
                  {typeof window !== 'undefined' ? window.location.origin : ''}/store/
                </span>
                <Input value={tenant.slug} disabled className="max-w-[200px]" />
              </div>
              <p className="text-xs text-muted-foreground">
                Alamat toko tidak dapat diubah
              </p>
            </div>

            {/* Category */}
            <FormField
              control={form.control}
              name="category"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Kategori Usaha</FormLabel>
                  <Select onValueChange={field.onChange} value={field.value}>
                    <FormControl>
                      <SelectTrigger>
                        <SelectValue placeholder="Pilih kategori" />
                      </SelectTrigger>
                    </FormControl>
                    <SelectContent>
                      {BUSINESS_CATEGORIES.map((cat) => (
                        <SelectItem key={cat.value} value={cat.value}>
                          {cat.label}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Description */}
            <FormField
              control={form.control}
              name="description"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Deskripsi</FormLabel>
                  <FormControl>
                    <Textarea
                      placeholder="Ceritakan tentang toko Anda..."
                      rows={4}
                      {...field}
                    />
                  </FormControl>
                  <FormDescription>
                    Deskripsi ini akan ditampilkan di halaman toko Anda
                  </FormDescription>
                  <FormMessage />
                </FormItem>
              )}
            />

            <Button type="submit" disabled={isLoading}>
              {isLoading ? (
                <>
                  <Loader2 className="h-4 w-4 mr-2 animate-spin" />
                  Menyimpan...
                </>
              ) : (
                <>
                  <Save className="h-4 w-4 mr-2" />
                  Simpan Perubahan
                </>
              )}
            </Button>
          </form>
        </Form>
      </CardContent>
    </Card>
  );
}


################################################################
##
##  CATEGORY: Store Components
##  Path: src/components/store
##
################################################################

================================================
FILE: src/components/store/index.ts
Lines: 41
================================================

// ==========================================
// STORE COMPONENTS INDEX
// ==========================================

// Layout components
export { StoreHeader } from './store-header';
export { StoreFooter } from './store-footer';
export { StoreNav } from './store-nav';
export { StoreNotFound } from './store-not-found';
export { StoreHero } from './store-hero';
export { StoreBreadcrumb } from './store-breadcrumb';

// Cart components
export { CartBadge } from './cart-badge';
export { CartSheet } from './cart-sheet';

// Product components
export { ProductCard } from './product-card';
export { ProductGrid } from './product-grid';
export { AddToCartButton } from './add-to-cart-button';
export { FeaturedProducts } from './featured-products';
export { RelatedProducts } from './related-products';

// Product Detail components
export { ProductGallery } from './product-gallery';
export { ProductInfo } from './product-info';
export { ProductActions } from './product-actions';
export { ProductShare } from './product-share';
export { WhatsAppOrderButton } from './whatsapp-order-button';
export { WhatsAppCheckoutDialog } from './whatsapp-checkout-dialog';

// Filter & Navigation
export { CategoryList } from './category-list';
export { ProductFilters } from './product-filters';
export { ProductPagination } from './product-pagination';

// Skeletons
export {
  StoreHeaderSkeleton,
  ProductCardSkeleton,
  ProductGridSkeleton,
} from './store-skeleton';

================================================
FILE: src/components/store/add-to-cart-button.tsx
Lines: 134
================================================

'use client';

import { useState } from 'react';
import { Plus, Minus, ShoppingCart, Check } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { useCartStore, useItemQty } from '@/stores';
import { cn } from '@/lib/cn';
import type { Product } from '@/types';

interface AddToCartButtonProps {
  product: Product;
  variant?: 'default' | 'icon' | 'full';
  size?: 'default' | 'sm' | 'lg';
  className?: string;
}

export function AddToCartButton({
  product,
  variant = 'default',
  size = 'default',
  className,
}: AddToCartButtonProps) {
  const [showAdded, setShowAdded] = useState(false);

  // Get actions directly from store (stable references)
  const addItem = useCartStore((state) => state.addItem);
  const incrementQty = useCartStore((state) => state.incrementQty);
  const decrementQty = useCartStore((state) => state.decrementQty);

  // Get qty with memoized selector
  const qty = useItemQty(product.id);

  const handleAdd = () => {
    addItem({
      id: product.id,
      name: product.name,
      price: product.price,
      image: product.images?.[0],
      unit: product.unit || undefined,
      maxStock: product.trackStock ? (product.stock ?? undefined) : undefined,
    });

    // Show feedback
    setShowAdded(true);
    setTimeout(() => setShowAdded(false), 1500);
  };

  const handleIncrement = () => {
    incrementQty(product.id);
  };

  const handleDecrement = () => {
    decrementQty(product.id);
  };

  // Check stock
  const isOutOfStock = product.trackStock && (product.stock ?? 0) <= 0;
  const isMaxStock = product.trackStock && (product.stock ?? 0) > 0 && qty >= (product.stock ?? 0);

  // Icon only variant
  if (variant === 'icon') {
    return (
      <Button
        size="icon"
        variant={qty > 0 ? 'default' : 'outline'}
        onClick={qty > 0 ? handleIncrement : handleAdd}
        disabled={isOutOfStock || isMaxStock}
        className={cn('relative', className)}
      >
        {showAdded ? (
          <Check className="h-4 w-4" />
        ) : qty > 0 ? (
          <>
            <Plus className="h-4 w-4" />
            <span className="absolute -top-1 -right-1 h-4 w-4 rounded-full bg-primary text-[10px] text-primary-foreground flex items-center justify-center">
              {qty}
            </span>
          </>
        ) : (
          <ShoppingCart className="h-4 w-4" />
        )}
      </Button>
    );
  }

  // Full variant with quantity controls
  if (variant === 'full' && qty > 0) {
    return (
      <div className={cn('flex items-center gap-2', className)}>
        <Button
          size="icon"
          variant="outline"
          onClick={handleDecrement}
          className="h-9 w-9"
        >
          <Minus className="h-4 w-4" />
        </Button>
        <span className="w-8 text-center font-medium">{qty}</span>
        <Button
          size="icon"
          variant="outline"
          onClick={handleIncrement}
          disabled={isMaxStock}
          className="h-9 w-9"
        >
          <Plus className="h-4 w-4" />
        </Button>
      </div>
    );
  }

  // Default variant
  return (
    <Button
      size={size}
      onClick={handleAdd}
      disabled={isOutOfStock}
      className={cn('gap-2', className)}
    >
      {showAdded ? (
        <>
          <Check className="h-4 w-4" />
          Ditambahkan Keranjang
        </>
      ) : isOutOfStock ? (
        'Stok Habis'
      ) : (
        <>
          <ShoppingCart className="h-4 w-4" />
          {qty > 0 ? `Tambah (${qty})` : 'Tambah'}
        </>
      )}
    </Button>
  );
}

================================================
FILE: src/components/store/cart-badge.tsx
Lines: 25
================================================

'use client';

import { ShoppingCart } from 'lucide-react';
import { useCartTotalItems, useCartHydrated } from '@/stores';

// ==========================================
// CART BADGE COMPONENT
// Shows cart icon with item count
// ==========================================

export function CartBadge() {
  const totalItems = useCartTotalItems();
  const isHydrated = useCartHydrated();

  return (
    <>
      <ShoppingCart className="h-5 w-5" />
      {isHydrated && totalItems > 0 && (
        <span className="absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] font-medium text-primary-foreground">
          {totalItems > 99 ? '99+' : totalItems}
        </span>
      )}
      <span className="sr-only">Keranjang</span>
    </>
  );
}

================================================
FILE: src/components/store/cart-sheet.tsx
Lines: 222
================================================

'use client';

import { useMemo, useState } from 'react';
import Image from 'next/image';
import { ShoppingCart, Plus, Minus, Trash2, ShoppingBag } from 'lucide-react';
import { Button } from '@/components/ui/button';
import {
  Sheet,
  SheetContent,
  SheetHeader,
  SheetTitle,
  SheetTrigger,
  SheetFooter,
} from '@/components/ui/sheet';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Separator } from '@/components/ui/separator';
import {
  useCartStore,
  useCartItems,
  useCartTotalPrice,
  useCartIsEmpty,
  useCartHydrated,
} from '@/stores';
import { formatPrice } from '@/lib/format';
import { getThumbnailUrl } from '@/lib/cloudinary';
import { WhatsAppCheckoutDialog } from './whatsapp-checkout-dialog';

interface CartSheetProps {
  storeSlug: string;
  storeName: string;
  storeWhatsApp: string;
}

export function CartSheet({ storeSlug, storeName, storeWhatsApp }: CartSheetProps) {
  const [checkoutOpen, setCheckoutOpen] = useState(false);
  const [sheetOpen, setSheetOpen] = useState(false);

  const items = useCartItems();
  const totalPrice = useCartTotalPrice();
  const isEmpty = useCartIsEmpty();
  const isHydrated = useCartHydrated();

  // Get actions directly
  const incrementQty = useCartStore((state) => state.incrementQty);
  const decrementQty = useCartStore((state) => state.decrementQty);
  const removeItem = useCartStore((state) => state.removeItem);
  const clearCart = useCartStore((state) => state.clearCart);

  // Calculate total items
  const totalItems = useMemo(
    () => items.reduce((sum, item) => sum + item.qty, 0),
    [items]
  );

  const handleCheckout = () => {
    setSheetOpen(false); // Close cart sheet
    setCheckoutOpen(true); // Open checkout dialog
  };

  return (
    <>
      <Sheet open={sheetOpen} onOpenChange={setSheetOpen}>
        <SheetTrigger asChild>
          <Button variant="outline" size="icon" className="relative">
            <ShoppingCart className="h-5 w-5" />
            {isHydrated && totalItems > 0 && (
              <span className="absolute -top-1 -right-1 h-5 w-5 rounded-full bg-primary text-[11px] font-medium text-primary-foreground flex items-center justify-center">
                {totalItems > 99 ? '99+' : totalItems}
              </span>
            )}
          </Button>
        </SheetTrigger>

        <SheetContent className="flex flex-col w-full sm:max-w-md">
          <SheetHeader>
            <SheetTitle className="flex items-center gap-2">
              <ShoppingBag className="h-5 w-5" />
              Keranjang Belanja
              {isHydrated && totalItems > 0 && (
                <span className="text-sm font-normal text-muted-foreground">
                  ({totalItems} item)
                </span>
              )}
            </SheetTitle>
          </SheetHeader>

          {!isHydrated ? (
            // Loading state
            <div className="flex-1 flex items-center justify-center">
              <div className="animate-pulse text-muted-foreground">
                Memuat keranjang...
              </div>
            </div>
          ) : isEmpty ? (
            // Empty state
            <div className="flex-1 flex flex-col items-center justify-center gap-4 text-center">
              <div className="h-20 w-20 rounded-full bg-muted flex items-center justify-center">
                <ShoppingCart className="h-10 w-10 text-muted-foreground" />
              </div>
              <div>
                <p className="font-medium">Keranjang kosong</p>
                <p className="text-sm text-muted-foreground">
                  Tambahkan produk untuk mulai belanja
                </p>
              </div>
            </div>
          ) : (
            <>
              {/* Cart Items */}
              <ScrollArea className="flex-1 -mx-6 px-6">
                <div className="space-y-4 py-4">
                  {items.map((item) => (
                    <div key={item.id} className="flex gap-3">
                      {/* Image */}
                      <div className="relative h-16 w-16 rounded-md overflow-hidden bg-muted flex-shrink-0">
                        {item.image ? (
                          <Image
                            src={getThumbnailUrl(item.image)}
                            alt={item.name}
                            fill
                            className="object-cover"
                          />
                        ) : (
                          <div className="h-full w-full flex items-center justify-center">
                            <ShoppingBag className="h-6 w-6 text-muted-foreground" />
                          </div>
                        )}
                      </div>

                      {/* Details */}
                      <div className="flex-1 min-w-0">
                        <h4 className="font-medium text-sm leading-tight truncate">
                          {item.name}
                        </h4>
                        <p className="text-sm text-muted-foreground">
                          {formatPrice(item.price)}
                          {item.unit && ` / ${item.unit}`}
                        </p>

                        {/* Quantity Controls */}
                        <div className="flex items-center gap-2 mt-2">
                          <Button
                            variant="outline"
                            size="icon"
                            className="h-7 w-7"
                            onClick={() => decrementQty(item.id)}
                          >
                            <Minus className="h-3 w-3" />
                          </Button>
                          <span className="w-8 text-center text-sm font-medium">
                            {item.qty}
                          </span>
                          <Button
                            variant="outline"
                            size="icon"
                            className="h-7 w-7"
                            onClick={() => incrementQty(item.id)}
                            disabled={item.maxStock !== undefined && item.qty >= item.maxStock}
                          >
                            <Plus className="h-3 w-3" />
                          </Button>
                          <Button
                            variant="ghost"
                            size="icon"
                            className="h-7 w-7 text-destructive hover:text-destructive ml-auto"
                            onClick={() => removeItem(item.id)}
                          >
                            <Trash2 className="h-3 w-3" />
                          </Button>
                        </div>
                      </div>

                      {/* Subtotal */}
                      <div className="text-right">
                        <p className="font-medium text-sm">
                          {formatPrice(item.price * item.qty)}
                        </p>
                      </div>
                    </div>
                  ))}
                </div>
              </ScrollArea>

              <Separator />

              {/* Footer */}
              <SheetFooter className="flex-col gap-3 sm:flex-col">
                {/* Total */}
                <div className="flex items-center justify-between w-full">
                  <span className="font-medium">Total</span>
                  <span className="text-lg font-bold">{formatPrice(totalPrice)}</span>
                </div>

                {/* Actions */}
                <div className="flex gap-2 w-full">
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={clearCart}
                    className="flex-1"
                  >
                    Kosongkan
                  </Button>
                  <Button className="flex-1" onClick={handleCheckout}>
                    Checkout
                  </Button>
                </div>
              </SheetFooter>
            </>
          )}
        </SheetContent>
      </Sheet>

      {/* WhatsApp Checkout Dialog */}
      <WhatsAppCheckoutDialog
        open={checkoutOpen}
        onOpenChange={setCheckoutOpen}
        storeName={storeName}
        storeWhatsApp={storeWhatsApp}
      />
    </>
  );
}

================================================
FILE: src/components/store/category-list.tsx
Lines: 71
================================================

'use client';

import { useRouter, useSearchParams } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { ScrollArea, ScrollBar } from '@/components/ui/scroll-area';

// ==========================================
// CATEGORY LIST COMPONENT
// Horizontal scrollable category chips
// ==========================================

interface CategoryListProps {
  categories: string[];
  storeSlug: string;
  currentCategory?: string;
}

export function CategoryList({
  categories,
  storeSlug,
  currentCategory,
}: CategoryListProps) {
  const router = useRouter();
  const searchParams = useSearchParams();

  const handleCategoryClick = (category: string | null) => {
    const params = new URLSearchParams(searchParams.toString());

    if (category) {
      params.set('category', category);
    } else {
      params.delete('category');
    }
    params.delete('page'); // Reset page on category change

    router.push(`/store/${storeSlug}/products?${params.toString()}`);
  };

  if (categories.length === 0) {
    return null;
  }

  return (
    <ScrollArea className="w-full whitespace-nowrap">
      <div className="flex gap-2 pb-2">
        {/* All Category */}
        <Button
          variant={!currentCategory ? "default" : "outline"}
          size="sm"
          className="rounded-full"
          onClick={() => handleCategoryClick(null)}
        >
          Semua
        </Button>

        {/* Category Chips */}
        {categories.map((category) => (
          <Button
            key={category}
            variant={currentCategory === category ? "default" : "outline"}
            size="sm"
            className="rounded-full"
            onClick={() => handleCategoryClick(category)}
          >
            {category}
          </Button>
        ))}
      </div>
      <ScrollBar orientation="horizontal" />
    </ScrollArea>
  );
}

================================================
FILE: src/components/store/featured-products.tsx
Lines: 43
================================================

import Link from 'next/link';
import { ArrowRight } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { ProductGrid } from './product-grid';
import type { Product } from '@/types';

// ==========================================
// FEATURED PRODUCTS SECTION
// ==========================================

interface FeaturedProductsProps {
  products: Product[];
  storeSlug: string;
  title?: string;
  showViewAll?: boolean;
}

export function FeaturedProducts({
  products,
  storeSlug,
  title = 'Produk Unggulan',
  showViewAll = true,
}: FeaturedProductsProps) {
  if (products.length === 0) {
    return null;
  }

  return (
    <section>
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-xl md:text-2xl font-semibold">{title}</h2>
        {showViewAll && (
          <Button asChild variant="ghost" size="sm">
            <Link href={`/store/${storeSlug}/products`}>
              Lihat Semua
              <ArrowRight className="h-4 w-4 ml-1" />
            </Link>
          </Button>
        )}
      </div>
      <ProductGrid products={products} storeSlug={storeSlug} />
    </section>
  );
}

================================================
FILE: src/components/store/product-actions.tsx
Lines: 37
================================================

'use client';

import { Separator } from '@/components/ui/separator';
import { AddToCartButton } from './add-to-cart-button';
import { WhatsAppOrderButton } from './whatsapp-order-button';
import { ProductShare } from './product-share';
import type { Product, PublicTenant } from '@/types';

// ==========================================
// PRODUCT ACTIONS COMPONENT
// Cart + WhatsApp + Share
// ==========================================

interface ProductActionsProps {
  product: Product;
  tenant: PublicTenant;
}

export function ProductActions({ product, tenant }: ProductActionsProps) {
  return (
    <div className="space-y-4">
      {/* Add to Cart */}
      <AddToCartButton product={product} />

      {/* WhatsApp Order */}
      <WhatsAppOrderButton
        product={product}
        tenant={tenant}
        className="w-full"
      />

      <Separator />

      {/* Share */}
      <ProductShare product={product} tenant={tenant} />
    </div>
  );
}

================================================
FILE: src/components/store/product-card.tsx
Lines: 191
================================================

'use client';

import { useState } from 'react';
import Image from 'next/image';
import Link from 'next/link';
import { ShoppingCart, Plus, Check } from 'lucide-react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { useCartStore, useItemQty } from '@/stores';
import { formatPrice } from '@/lib/format';
import { cn } from '@/lib/cn';
import type { Product } from '@/types';

// ==========================================
// PRODUCT CARD COMPONENT
// ==========================================

interface ProductCardProps {
  product: Product;
  storeSlug: string;
  showAddToCart?: boolean;
}

export function ProductCard({
  product,
  storeSlug,
  showAddToCart = true,
}: ProductCardProps) {
  const [isAdding, setIsAdding] = useState(false);
  const { addItem } = useCartStore();
  const itemQty = useItemQty(product.id);

  const productUrl = `/store/${storeSlug}/products/${product.id}`;
  const hasDiscount = product.comparePrice && product.comparePrice > product.price;
  const discountPercent = hasDiscount
    ? Math.round(((product.comparePrice! - product.price) / product.comparePrice!) * 100)
    : 0;
  const isOutOfStock = product.trackStock && (product.stock ?? 0) <= 0;

  const handleAddToCart = (e: React.MouseEvent) => {
    e.preventDefault();
    e.stopPropagation();

    if (isOutOfStock) return;

    setIsAdding(true);
    addItem({
      id: product.id,
      name: product.name,
      price: product.price,
      image: product.images[0],
      unit: product.unit || undefined,
      maxStock: product.trackStock ? product.stock ?? undefined : undefined,
    });

    // Brief animation feedback
    setTimeout(() => setIsAdding(false), 500);
  };

  return (
    <Card className="group overflow-hidden transition-shadow hover:shadow-md">
      <Link href={productUrl}>
        {/* Image Container */}
        <div className="relative aspect-square overflow-hidden bg-muted">
          {product.images[0] ? (
            <Image
              src={product.images[0]}
              alt={product.name}
              fill
              className="object-cover transition-transform group-hover:scale-105"
              sizes="(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 25vw"
            />
          ) : (
            <div className="flex h-full items-center justify-center">
              <ShoppingCart className="h-12 w-12 text-muted-foreground/30" />
            </div>
          )}

          {/* Badges */}
          <div className="absolute top-2 left-2 flex flex-col gap-1">
            {hasDiscount && (
              <Badge variant="destructive" className="text-xs">
                -{discountPercent}%
              </Badge>
            )}
            {product.isFeatured && (
              <Badge className="text-xs bg-primary">
                Unggulan
              </Badge>
            )}
          </div>

          {/* Out of Stock Overlay */}
          {isOutOfStock && (
            <div className="absolute inset-0 flex items-center justify-center bg-black/50">
              <Badge variant="secondary" className="text-sm">
                Stok Habis
              </Badge>
            </div>
          )}

          {/* Quick Add Button (Desktop) */}
          {showAddToCart && !isOutOfStock && (
            <div className="absolute bottom-2 right-2 opacity-0 transition-opacity group-hover:opacity-100">
              <Button
                size="icon"
                className={cn(
                  "h-9 w-9 rounded-full shadow-lg",
                  isAdding && "bg-green-500 hover:bg-green-500"
                )}
                onClick={handleAddToCart}
              >
                {isAdding ? (
                  <Check className="h-4 w-4" />
                ) : (
                  <Plus className="h-4 w-4" />
                )}
              </Button>
            </div>
          )}
        </div>

        {/* Content */}
        <CardContent className="p-3">
          {/* Category */}
          {product.category && (
            <p className="text-xs text-muted-foreground mb-1 truncate">
              {product.category}
            </p>
          )}

          {/* Name */}
          <h3 className="font-medium text-sm leading-tight line-clamp-2 min-h-[2.5rem]">
            {product.name}
          </h3>

          {/* Price */}
          <div className="mt-2 flex items-baseline gap-2">
            <span className="font-semibold text-primary">
              {formatPrice(product.price)}
            </span>
            {hasDiscount && (
              <span className="text-xs text-muted-foreground line-through">
                {formatPrice(product.comparePrice!)}
              </span>
            )}
          </div>

          {/* Unit */}
          {product.unit && (
            <p className="text-xs text-muted-foreground mt-1">
              per {product.unit}
            </p>
          )}

          {/* Cart Indicator */}
          {itemQty > 0 && (
            <div className="mt-2 flex items-center gap-1 text-xs text-primary">
              <ShoppingCart className="h-3 w-3" />
              <span>{itemQty} di keranjang</span>
            </div>
          )}
        </CardContent>
      </Link>

      {/* Mobile Add to Cart */}
      {showAddToCart && !isOutOfStock && (
        <div className="px-3 pb-3 md:hidden">
          <Button
            size="sm"
            variant="outline"
            className="w-full"
            onClick={handleAddToCart}
          >
            {isAdding ? (
              <>
                <Check className="h-4 w-4 mr-2" />
                Ditambahkan
              </>
            ) : (
              <>
                <Plus className="h-4 w-4 mr-2" />
                Tambah
              </>
            )}
          </Button>
        </div>
      )}
    </Card>
  );
}

================================================
FILE: src/components/store/product-filters.tsx
Lines: 255
================================================

'use client';

import { useState, useEffect, useRef } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { Search, SlidersHorizontal, X } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Sheet,
  SheetContent,
  SheetHeader,
  SheetTitle,
  SheetTrigger,
} from '@/components/ui/sheet';
import { useDebounce } from '@/hooks';
import { cn } from '@/lib/cn';

interface ProductFiltersProps {
  storeSlug: string;
  categories?: string[];
  className?: string;
}

export function ProductFilters({
  storeSlug,
  categories = [],
  className,
}: ProductFiltersProps) {
  const router = useRouter();
  const searchParams = useSearchParams();
  const isFirstRender = useRef(true);

  // Get initial values from URL
  const initialSearch = searchParams.get('search') || '';
  const initialCategory = searchParams.get('category') || '';
  const initialSort = searchParams.get('sort') || 'newest';

  // Local state
  const [search, setSearch] = useState(initialSearch);
  const [category, setCategory] = useState(initialCategory);
  const [sort, setSort] = useState(initialSort);
  const [isOpen, setIsOpen] = useState(false);

  // Debounce search
  const debouncedSearch = useDebounce(search, 400);

  // ‚úÖ FIXED: Update URL when debounced search changes
  useEffect(() => {
    // Skip first render
    if (isFirstRender.current) {
      isFirstRender.current = false;
      return;
    }

    // Get current search from URL
    const currentSearch = searchParams.get('search') || '';

    // Only update if actually changed
    if (debouncedSearch === currentSearch) return;

    const params = new URLSearchParams(searchParams.toString());

    if (debouncedSearch) {
      params.set('search', debouncedSearch);
    } else {
      params.delete('search');
    }
    params.delete('page'); // Reset page on search

    router.push(`/store/${storeSlug}/products?${params.toString()}`);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [debouncedSearch, storeSlug]);

  // Handle category change
  const handleCategoryChange = (value: string) => {
    setCategory(value);

    const params = new URLSearchParams(searchParams.toString());

    if (value && value !== 'all') {
      params.set('category', value);
    } else {
      params.delete('category');
    }
    params.delete('page');

    router.push(`/store/${storeSlug}/products?${params.toString()}`);
  };

  // Handle sort change
  const handleSortChange = (value: string) => {
    setSort(value);

    const params = new URLSearchParams(searchParams.toString());

    if (value && value !== 'newest') {
      params.set('sort', value);
    } else {
      params.delete('sort');
    }

    router.push(`/store/${storeSlug}/products?${params.toString()}`);
  };

  // Clear all filters
  const clearFilters = () => {
    setSearch('');
    setCategory('');
    setSort('newest');
    router.push(`/store/${storeSlug}/products`);
  };

  const hasActiveFilters = search || category || sort !== 'newest';

  return (
    <div className={cn('space-y-4', className)}>
      {/* Search Bar */}
      <div className="flex gap-2">
        <div className="relative flex-1">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
          <Input
            type="text"
            placeholder="Cari produk..."
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            className="pl-10"
          />
          {search && (
            <button
              onClick={() => setSearch('')}
              className="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"
            >
              <X className="h-4 w-4" />
            </button>
          )}
        </div>

        {/* Mobile Filter Button */}
        <Sheet open={isOpen} onOpenChange={setIsOpen}>
          <SheetTrigger asChild>
            <Button variant="outline" size="icon" className="md:hidden">
              <SlidersHorizontal className="h-4 w-4" />
            </Button>
          </SheetTrigger>
          <SheetContent side="right">
            <SheetHeader>
              <SheetTitle>Filter</SheetTitle>
            </SheetHeader>
            <div className="mt-6 space-y-4">
              {/* Category Filter Mobile */}
              {categories.length > 0 && (
                <div className="space-y-2">
                  <label className="text-sm font-medium">Kategori</label>
                  <Select value={category} onValueChange={handleCategoryChange}>
                    <SelectTrigger>
                      <SelectValue placeholder="Semua Kategori" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="all">Semua Kategori</SelectItem>
                      {categories.map((cat) => (
                        <SelectItem key={cat} value={cat}>
                          {cat}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
              )}

              {/* Sort Mobile */}
              <div className="space-y-2">
                <label className="text-sm font-medium">Urutkan</label>
                <Select value={sort} onValueChange={handleSortChange}>
                  <SelectTrigger>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="newest">Terbaru</SelectItem>
                    <SelectItem value="oldest">Terlama</SelectItem>
                    <SelectItem value="price-low">Harga Terendah</SelectItem>
                    <SelectItem value="price-high">Harga Tertinggi</SelectItem>
                    <SelectItem value="name-asc">Nama A-Z</SelectItem>
                    <SelectItem value="name-desc">Nama Z-A</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              {hasActiveFilters && (
                <Button
                  variant="outline"
                  onClick={() => {
                    clearFilters();
                    setIsOpen(false);
                  }}
                  className="w-full"
                >
                  Reset Filter
                </Button>
              )}
            </div>
          </SheetContent>
        </Sheet>
      </div>

      {/* Desktop Filters */}
      <div className="hidden md:flex items-center gap-4">
        {/* Category Filter */}
        {categories.length > 0 && (
          <Select value={category} onValueChange={handleCategoryChange}>
            <SelectTrigger className="w-[180px]">
              <SelectValue placeholder="Semua Kategori" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">Semua Kategori</SelectItem>
              {categories.map((cat) => (
                <SelectItem key={cat} value={cat}>
                  {cat}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        )}

        {/* Sort */}
        <Select value={sort} onValueChange={handleSortChange}>
          <SelectTrigger className="w-[180px]">
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="newest">Terbaru</SelectItem>
            <SelectItem value="oldest">Terlama</SelectItem>
            <SelectItem value="price-low">Harga Terendah</SelectItem>
            <SelectItem value="price-high">Harga Tertinggi</SelectItem>
            <SelectItem value="name-asc">Nama A-Z</SelectItem>
            <SelectItem value="name-desc">Nama Z-A</SelectItem>
          </SelectContent>
        </Select>

        {/* Clear Filters */}
        {hasActiveFilters && (
          <Button variant="ghost" size="sm" onClick={clearFilters}>
            <X className="h-4 w-4 mr-1" />
            Reset
          </Button>
        )}
      </div>
    </div>
  );
}

================================================
FILE: src/components/store/product-gallery.tsx
Lines: 161
================================================

'use client';

import { useState } from 'react';
import Image from 'next/image';
import { ChevronLeft, ChevronRight, ZoomIn, Package } from 'lucide-react';
import { Button } from '@/components/ui/button';
import {
  Dialog,
  DialogContent,
  DialogTrigger,
} from '@/components/ui/dialog';
import { cn } from '@/lib/cn';
import {
  getProductImageUrl,
  getThumbnailUrl,
  isCloudinaryUrl
} from '@/lib/cloudinary';

// ==========================================
// PRODUCT GALLERY COMPONENT
// ==========================================

interface ProductGalleryProps {
  images: string[];
  productName: string;
}

export function ProductGallery({ images, productName }: ProductGalleryProps) {
  const [selectedIndex, setSelectedIndex] = useState(0);
  const [zoomOpen, setZoomOpen] = useState(false);

  const hasImages = images.length > 0;
  const hasMultipleImages = images.length > 1;

  // ‚úÖ Get current image URL
  const currentImageUrl = hasImages ? images[selectedIndex] : null;

  // ‚úÖ Use optimized Cloudinary URLs
  const optimizedMainImage = currentImageUrl
    ? isCloudinaryUrl(currentImageUrl)
      ? getProductImageUrl(currentImageUrl) // 800px max, auto quality
      : currentImageUrl
    : null;

  const goToPrevious = () => {
    setSelectedIndex((prev) => (prev === 0 ? images.length - 1 : prev - 1));
  };

  const goToNext = () => {
    setSelectedIndex((prev) => (prev === images.length - 1 ? 0 : prev + 1));
  };

  // ‚úÖ Get optimized thumbnail URL
  const getOptimizedThumbnail = (imageUrl: string) => {
    return isCloudinaryUrl(imageUrl) ? getThumbnailUrl(imageUrl) : imageUrl;
  };

  return (
    <div className="space-y-4">
      {/* Main Image */}
      <div className="relative aspect-square overflow-hidden rounded-xl bg-muted">
        {hasImages && optimizedMainImage ? (
          <>
            <Image
              src={optimizedMainImage}
              alt={`${productName} - Gambar ${selectedIndex + 1}`}
              fill
              className="object-cover"
              priority
              sizes="(max-width: 768px) 100vw, 50vw"
            />

            {/* Zoom Button */}
            <Dialog open={zoomOpen} onOpenChange={setZoomOpen}>
              <DialogTrigger asChild>
                <Button
                  variant="secondary"
                  size="icon"
                  className="absolute top-4 right-4 rounded-full shadow-lg"
                >
                  <ZoomIn className="h-4 w-4" />
                </Button>
              </DialogTrigger>
              <DialogContent className="max-w-4xl p-0">
                <div className="relative aspect-square w-full">
                  {/* ‚úÖ Use original URL for zoom (full quality) */}
                  <Image
                    src={currentImageUrl!}
                    alt={`${productName} - Gambar ${selectedIndex + 1}`}
                    fill
                    className="object-contain"
                    sizes="100vw"
                  />
                </div>
              </DialogContent>
            </Dialog>

            {/* Navigation Arrows */}
            {hasMultipleImages && (
              <>
                <Button
                  variant="secondary"
                  size="icon"
                  className="absolute left-4 top-1/2 -translate-y-1/2 rounded-full shadow-lg"
                  onClick={goToPrevious}
                >
                  <ChevronLeft className="h-4 w-4" />
                </Button>
                <Button
                  variant="secondary"
                  size="icon"
                  className="absolute right-4 top-1/2 -translate-y-1/2 rounded-full shadow-lg"
                  onClick={goToNext}
                >
                  <ChevronRight className="h-4 w-4" />
                </Button>
              </>
            )}

            {/* Image Counter */}
            {hasMultipleImages && (
              <div className="absolute bottom-4 left-1/2 -translate-x-1/2 rounded-full bg-black/60 px-3 py-1 text-xs text-white">
                {selectedIndex + 1} / {images.length}
              </div>
            )}
          </>
        ) : (
          <div className="flex h-full items-center justify-center">
            <Package className="h-24 w-24 text-muted-foreground/30" />
          </div>
        )}
      </div>

      {/* Thumbnail Strip */}
      {hasMultipleImages && (
        <div className="flex gap-2 overflow-x-auto pb-2">
          {images.map((image, index) => (
            <button
              key={index}
              onClick={() => setSelectedIndex(index)}
              className={cn(
                'relative h-20 w-20 flex-shrink-0 overflow-hidden rounded-lg border-2 transition-colors',
                selectedIndex === index
                  ? 'border-primary'
                  : 'border-transparent hover:border-muted-foreground/30'
              )}
            >
              {/* ‚úÖ Use optimized thumbnail for strip */}
              <Image
                src={getOptimizedThumbnail(image)}
                alt={`${productName} - Thumbnail ${index + 1}`}
                fill
                className="object-cover"
                sizes="80px"
              />
            </button>
          ))}
        </div>
      )}
    </div>
  );
}

================================================
FILE: src/components/store/product-grid.tsx
Lines: 55
================================================

import { ProductCard } from './product-card';
import { ProductGridSkeleton } from './store-skeleton';
import type { Product } from '@/types';

// ==========================================
// PRODUCT GRID COMPONENT
// ==========================================

interface ProductGridProps {
  products: Product[];
  storeSlug: string;
  isLoading?: boolean;
  showAddToCart?: boolean;
  columns?: 2 | 3 | 4;
}

export function ProductGrid({
  products,
  storeSlug,
  isLoading = false,
  showAddToCart = true,
  columns = 4,
}: ProductGridProps) {
  if (isLoading) {
    return <ProductGridSkeleton count={8} />;
  }

  if (products.length === 0) {
    return (
      <div className="text-center py-12 bg-muted/30 rounded-lg">
        <p className="text-muted-foreground">
          Tidak ada produk ditemukan
        </p>
      </div>
    );
  }

  const gridCols = {
    2: 'grid-cols-2',
    3: 'grid-cols-2 md:grid-cols-3',
    4: 'grid-cols-2 md:grid-cols-3 lg:grid-cols-4',
  };

  return (
    <div className={`grid ${gridCols[columns]} gap-4`}>
      {products.map((product) => (
        <ProductCard
          key={product.id}
          product={product}
          storeSlug={storeSlug}
          showAddToCart={showAddToCart}
        />
      ))}
    </div>
  );
}

================================================
FILE: src/components/store/product-info.tsx
Lines: 86
================================================

import { Badge } from '@/components/ui/badge';
import { Separator } from '@/components/ui/separator';
import { formatPrice } from '@/lib/format';
import type { Product } from '@/types';

// ==========================================
// PRODUCT INFO COMPONENT
// ==========================================

interface ProductInfoProps {
  product: Product;
}

export function ProductInfo({ product }: ProductInfoProps) {
  const hasDiscount = product.comparePrice && product.comparePrice > product.price;
  const discountPercent = hasDiscount
    ? Math.round(((product.comparePrice! - product.price) / product.comparePrice!) * 100)
    : 0;
  const isOutOfStock = product.trackStock && (product.stock ?? 0) <= 0;

  return (
    <div className="space-y-4">
      {/* Category */}
      {product.category && (
        <p className="text-sm text-muted-foreground">{product.category}</p>
      )}

      {/* Product Name */}
      <h1 className="text-2xl font-bold md:text-3xl">{product.name}</h1>

      {/* Badges */}
      <div className="flex flex-wrap gap-2">
        {product.isFeatured && (
          <Badge className="bg-primary">‚≠ê Produk Unggulan</Badge>
        )}
        {isOutOfStock && (
          <Badge variant="destructive">Stok Habis</Badge>
        )}
        {product.trackStock && !isOutOfStock && (product.stock ?? 0) <= (product.minStock ?? 5) && (product.stock ?? 0) > 0 && (
          <Badge variant="secondary">Stok Terbatas</Badge>
        )}
      </div>

      {/* Price */}
      <div className="flex items-baseline gap-3">
        <span className="text-3xl font-bold text-primary">
          {formatPrice(product.price)}
        </span>
        {hasDiscount && (
          <>
            <span className="text-lg text-muted-foreground line-through">
              {formatPrice(product.comparePrice!)}
            </span>
            <Badge variant="destructive">-{discountPercent}%</Badge>
          </>
        )}
      </div>

      {/* Unit */}
      {product.unit && (
        <p className="text-sm text-muted-foreground">
          Harga per {product.unit}
        </p>
      )}

      <Separator />

      {/* Stock Info */}
      {product.trackStock && product.stock !== null && (
        <div className="flex items-center gap-2 text-sm">
          <span className="text-muted-foreground">Stok:</span>
          <span className={isOutOfStock ? 'text-destructive' : 'font-medium'}>
            {product.stock} {product.unit || 'pcs'}
          </span>
        </div>
      )}

      {/* SKU */}
      {product.sku && (
        <div className="flex items-center gap-2 text-sm">
          <span className="text-muted-foreground">SKU:</span>
          <span className="font-mono">{product.sku}</span>
        </div>
      )}
    </div>
  );
}

================================================
FILE: src/components/store/product-pagination.tsx
Lines: 149
================================================

'use client';

import { useRouter, useSearchParams } from 'next/navigation';
import {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
} from '@/components/ui/pagination';

// ==========================================
// PRODUCT PAGINATION COMPONENT
// ==========================================

interface ProductPaginationProps {
  storeSlug: string;
  currentPage: number;
  totalPages: number;
  total: number;
}

export function ProductPagination({
  storeSlug,
  currentPage,
  totalPages,
  total,
}: ProductPaginationProps) {
  const router = useRouter();
  const searchParams = useSearchParams();

  if (totalPages <= 1) {
    return null;
  }

  const handlePageChange = (page: number) => {
    const params = new URLSearchParams(searchParams.toString());
    params.set('page', page.toString());
    router.push(`/store/${storeSlug}/products?${params.toString()}`);
  };

  // Generate page numbers to show
  const getPageNumbers = () => {
    const pages: (number | 'ellipsis')[] = [];
    const showPages = 5;

    if (totalPages <= showPages) {
      return Array.from({ length: totalPages }, (_, i) => i + 1);
    }

    // Always show first page
    pages.push(1);

    // Calculate range around current page
    let start = Math.max(2, currentPage - 1);
    let end = Math.min(totalPages - 1, currentPage + 1);

    // Adjust if at start or end
    if (currentPage <= 3) {
      end = Math.min(4, totalPages - 1);
    }
    if (currentPage >= totalPages - 2) {
      start = Math.max(2, totalPages - 3);
    }

    // Add ellipsis if needed
    if (start > 2) {
      pages.push('ellipsis');
    }

    // Add middle pages
    for (let i = start; i <= end; i++) {
      pages.push(i);
    }

    // Add ellipsis if needed
    if (end < totalPages - 1) {
      pages.push('ellipsis');
    }

    // Always show last page
    if (totalPages > 1) {
      pages.push(totalPages);
    }

    return pages;
  };

  return (
    <div className="flex flex-col sm:flex-row items-center justify-between gap-4 pt-8">
      {/* Info */}
      <p className="text-sm text-muted-foreground">
        Menampilkan halaman {currentPage} dari {totalPages} ({total} produk)
      </p>

      {/* Pagination */}
      <Pagination>
        <PaginationContent>
          {/* Previous */}
          <PaginationItem>
            <PaginationPrevious
              href="#"
              onClick={(e) => {
                e.preventDefault();
                if (currentPage > 1) handlePageChange(currentPage - 1);
              }}
              className={currentPage <= 1 ? 'pointer-events-none opacity-50' : ''}
            />
          </PaginationItem>

          {/* Page Numbers */}
          {getPageNumbers().map((page, index) =>
            page === 'ellipsis' ? (
              <PaginationItem key={`ellipsis-${index}`}>
                <PaginationEllipsis />
              </PaginationItem>
            ) : (
              <PaginationItem key={page}>
                <PaginationLink
                  href="#"
                  onClick={(e) => {
                    e.preventDefault();
                    handlePageChange(page);
                  }}
                  isActive={page === currentPage}
                >
                  {page}
                </PaginationLink>
              </PaginationItem>
            )
          )}

          {/* Next */}
          <PaginationItem>
            <PaginationNext
              href="#"
              onClick={(e) => {
                e.preventDefault();
                if (currentPage < totalPages) handlePageChange(currentPage + 1);
              }}
              className={currentPage >= totalPages ? 'pointer-events-none opacity-50' : ''}
            />
          </PaginationItem>
        </PaginationContent>
      </Pagination>
    </div>
  );
}

================================================
FILE: src/components/store/product-share.tsx
Lines: 122
================================================

'use client';

import { useState } from 'react';
import { Share2, Link2, Check, Facebook, Twitter } from 'lucide-react';
import { Button } from '@/components/ui/button';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { toast } from '@/providers';
import type { Product, PublicTenant } from '@/types';

// ==========================================
// PRODUCT SHARE COMPONENT
// ==========================================

interface ProductShareProps {
  product: Product;
  tenant: PublicTenant;
}

export function ProductShare({ product, tenant }: ProductShareProps) {
  const [copied, setCopied] = useState(false);

  const productUrl = typeof window !== 'undefined'
    ? window.location.href
    : '';

  const shareText = `${product.name} - ${tenant.name}`;

  const copyLink = async () => {
    try {
      await navigator.clipboard.writeText(productUrl);
      setCopied(true);
      toast.success('Link berhasil disalin!');
      setTimeout(() => setCopied(false), 2000);
    } catch {
      toast.error('Gagal menyalin link');
    }
  };

  const shareToWhatsApp = () => {
    const url = `https://wa.me/?text=${encodeURIComponent(`${shareText}\n${productUrl}`)}`;
    window.open(url, '_blank');
  };

  const shareToFacebook = () => {
    const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(productUrl)}`;
    window.open(url, '_blank');
  };

  const shareToTwitter = () => {
    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(productUrl)}`;
    window.open(url, '_blank');
  };

  const handleNativeShare = async () => {
    if (navigator.share) {
      try {
        await navigator.share({
          title: product.name,
          text: shareText,
          url: productUrl,
        });
      } catch {
        // User cancelled or error
      }
    }
  };

  return (
    <div className="flex items-center gap-2">
      <span className="text-sm text-muted-foreground">Bagikan:</span>

      {/* Copy Link */}
      <Button
        variant="outline"
        size="icon"
        onClick={copyLink}
        title="Salin Link"
      >
        {copied ? (
          <Check className="h-4 w-4 text-green-500" />
        ) : (
          <Link2 className="h-4 w-4" />
        )}
      </Button>

      {/* Share Dropdown */}
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button variant="outline" size="icon" title="Bagikan">
            <Share2 className="h-4 w-4" />
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="end">
          <DropdownMenuItem onClick={shareToWhatsApp}>
            <svg className="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="currentColor">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
            </svg>
            WhatsApp
          </DropdownMenuItem>
          <DropdownMenuItem onClick={shareToFacebook}>
            <Facebook className="h-4 w-4 mr-2" />
            Facebook
          </DropdownMenuItem>
          <DropdownMenuItem onClick={shareToTwitter}>
            <Twitter className="h-4 w-4 mr-2" />
            Twitter
          </DropdownMenuItem>
          {typeof navigator !== 'undefined' && 'share' in navigator && (
            <DropdownMenuItem onClick={handleNativeShare}>
              <Share2 className="h-4 w-4 mr-2" />
              Lainnya...
            </DropdownMenuItem>
          )}
        </DropdownMenuContent>
      </DropdownMenu>
    </div>
  );
}

================================================
FILE: src/components/store/related-products.tsx
Lines: 27
================================================

import { ProductGrid } from './product-grid';
import type { Product } from '@/types';

// ==========================================
// RELATED PRODUCTS COMPONENT
// ==========================================

interface RelatedProductsProps {
  products: Product[];
  storeSlug: string;
}

export function RelatedProducts({ products, storeSlug }: RelatedProductsProps) {
  if (products.length === 0) {
    return null;
  }

  return (
    <section className="mt-12">
      <h2 className="text-xl font-semibold mb-6">Produk Terkait</h2>
      <ProductGrid
        products={products}
        storeSlug={storeSlug}
        columns={4}
      />
    </section>
  );
}

================================================
FILE: src/components/store/store-breadcrumb.tsx
Lines: 67
================================================

import Link from 'next/link';
import { ChevronRight, Home } from 'lucide-react';
import {
  Breadcrumb,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbList,
  BreadcrumbPage,
  BreadcrumbSeparator,
} from '@/components/ui/breadcrumb';
import { Fragment } from 'react';

// ==========================================
// STORE BREADCRUMB COMPONENT
// ==========================================

interface BreadcrumbItemData {
  label: string;
  href?: string;
}

interface StoreBreadcrumbProps {
  items: BreadcrumbItemData[];
  storeSlug: string;
  storeName: string;
}

export function StoreBreadcrumb({
  items,
  storeSlug,
  storeName,
}: StoreBreadcrumbProps) {
  return (
    <Breadcrumb>
      <BreadcrumbList>
        {/* Home */}
        <BreadcrumbItem>
          <BreadcrumbLink asChild>
            <Link href={`/store/${storeSlug}`} className="flex items-center gap-1">
              <Home className="h-4 w-4" />
              <span className="hidden sm:inline">{storeName}</span>
            </Link>
          </BreadcrumbLink>
        </BreadcrumbItem>

        {/* Dynamic Items */}
        {items.map((item, index) => (
          <Fragment key={index}>
            <BreadcrumbSeparator>
              <ChevronRight className="h-4 w-4" />
            </BreadcrumbSeparator>
            <BreadcrumbItem>
              {item.href ? (
                <BreadcrumbLink asChild>
                  <Link href={item.href}>{item.label}</Link>
                </BreadcrumbLink>
              ) : (
                <BreadcrumbPage className="max-w-[200px] truncate">
                  {item.label}
                </BreadcrumbPage>
              )}
            </BreadcrumbItem>
          </Fragment>
        ))}
      </BreadcrumbList>
    </Breadcrumb>
  );
}

================================================
FILE: src/components/store/store-footer.tsx
Lines: 129
================================================

'use client';

import Link from 'next/link';
import { Phone, MapPin, MessageCircle } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Separator } from '@/components/ui/separator';
import { formatPhone } from '@/lib/format';
import { siteConfig } from '@/config/site';
import type { PublicTenant } from '@/types';

// ==========================================
// STORE FOOTER COMPONENT
// ==========================================

interface StoreFooterProps {
  tenant: PublicTenant;
}

export function StoreFooter({ tenant }: StoreFooterProps) {
  const storeUrl = `/store/${tenant.slug}`;
  const currentYear = new Date().getFullYear();

  return (
    <footer className="border-t bg-muted/30">
      <div className="container px-4 py-8 md:py-12">
        <div className="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
          {/* Store Info */}
          <div className="space-y-4">
            <h3 className="font-semibold text-lg">{tenant.name}</h3>
            {tenant.description && (
              <p className="text-sm text-muted-foreground leading-relaxed">
                {tenant.description}
              </p>
            )}

            {/* WhatsApp CTA */}
            <Button asChild className="mt-4">
              <a
                href={`https://wa.me/${tenant.whatsapp}`}
                target="_blank"
                rel="noopener noreferrer"
              >
                <MessageCircle className="h-4 w-4 mr-2" />
                Hubungi Kami
              </a>
            </Button>
          </div>

          {/* Quick Links */}
          <div className="space-y-4">
            <h3 className="font-semibold">Menu</h3>
            <ul className="space-y-2">
              <li>
                <Link
                  href={storeUrl}
                  className="text-sm text-muted-foreground hover:text-foreground transition-colors"
                >
                  Beranda
                </Link>
              </li>
              <li>
                <Link
                  href={`${storeUrl}/products`}
                  className="text-sm text-muted-foreground hover:text-foreground transition-colors"
                >
                  Semua Produk
                </Link>
              </li>
            </ul>
          </div>

          {/* Contact Info */}
          <div className="space-y-4">
            <h3 className="font-semibold">Kontak</h3>
            <ul className="space-y-3">
              {tenant.whatsapp && (
                <li>
                  <a
                    href={`https://wa.me/${tenant.whatsapp}`}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors"
                  >
                    <Phone className="h-4 w-4" />
                    {formatPhone(tenant.whatsapp)}
                  </a>
                </li>
              )}
              {tenant.phone && tenant.phone !== tenant.whatsapp && (
                <li>
                  <a
                    href={`tel:${tenant.phone}`}
                    className="flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors"
                  >
                    <Phone className="h-4 w-4" />
                    {formatPhone(tenant.phone)}
                  </a>
                </li>
              )}
              {tenant.address && (
                <li className="flex items-start gap-2 text-sm text-muted-foreground">
                  <MapPin className="h-4 w-4 mt-0.5 flex-shrink-0" />
                  <span>{tenant.address}</span>
                </li>
              )}
            </ul>
          </div>
        </div>

        <Separator className="my-8" />

        {/* Bottom Bar */}
        <div className="flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-muted-foreground">
          <p>
            ¬© {currentYear} {tenant.name}. Hak cipta dilindungi.
          </p>
          <p>
            Dibuat dengan{' '}
            <Link
              href="/"
              className="font-medium text-primary hover:underline"
            >
              {siteConfig.name}
            </Link>
          </p>
        </div>
      </div>
    </footer>
  );
}

================================================
FILE: src/components/store/store-header.tsx
Lines: 100
================================================

'use client';

import Link from 'next/link';
import Image from 'next/image';
import { Menu, Search } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Sheet, SheetContent, SheetTrigger } from '@/components/ui/sheet';
import { CartSheet } from './cart-sheet';
import { StoreNav } from './store-nav';
import type { PublicTenant } from '@/types';

// ==========================================
// STORE HEADER COMPONENT
// ==========================================

interface StoreHeaderProps {
  tenant: PublicTenant;
}

export function StoreHeader({ tenant }: StoreHeaderProps) {
  const storeUrl = `/store/${tenant.slug}`;

  return (
    <header className="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container flex h-16 items-center justify-between px-4">
        {/* Left: Mobile Menu + Logo */}
        <div className="flex items-center gap-3">
          {/* Mobile Menu */}
          <Sheet>
            <SheetTrigger asChild>
              <Button variant="ghost" size="icon" className="md:hidden">
                <Menu className="h-5 w-5" />
                <span className="sr-only">Menu</span>
              </Button>
            </SheetTrigger>
            <SheetContent side="left" className="w-[280px] p-0">
              <StoreNav tenant={tenant} />
            </SheetContent>
          </Sheet>

          {/* Logo & Store Name */}
          <Link href={storeUrl} className="flex items-center gap-3">
            {tenant.logo ? (
              <Image
                src={tenant.logo}
                alt={tenant.name}
                width={40}
                height={40}
                className="rounded-full object-cover"
              />
            ) : (
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-primary text-primary-foreground font-semibold">
                {tenant.name.charAt(0).toUpperCase()}
              </div>
            )}
            <div className="hidden sm:block">
              <h1 className="font-semibold text-lg leading-tight">
                {tenant.name}
              </h1>
              <p className="text-xs text-muted-foreground">
                {tenant.category.replace(/_/g, ' ')}
              </p>
            </div>
          </Link>
        </div>

        {/* Center: Desktop Navigation */}
        <nav className="hidden md:flex items-center gap-6">
          <Link
            href={storeUrl}
            className="text-sm font-medium text-muted-foreground hover:text-foreground transition-colors"
          >
            Beranda
          </Link>
          <Link
            href={`${storeUrl}/products`}
            className="text-sm font-medium text-muted-foreground hover:text-foreground transition-colors"
          >
            Produk
          </Link>
        </nav>

        {/* Right: Search + Cart */}
        <div className="flex items-center gap-2">
          {/* Search Button (Optional - for future) */}
          <Button variant="ghost" size="icon" className="hidden sm:flex">
            <Search className="h-5 w-5" />
            <span className="sr-only">Cari</span>
          </Button>

          {/* Cart - Fix: provide default empty string for whatsapp */}
          <CartSheet
            storeSlug={tenant.slug}
            storeName={tenant.name}
            storeWhatsApp={tenant.whatsapp || ''}
          />
        </div>
      </div>
    </header>
  );
}

================================================
FILE: src/components/store/store-hero.tsx
Lines: 77
================================================

import Image from 'next/image';
import { MessageCircle } from 'lucide-react';
import { Button } from '@/components/ui/button';
import type { PublicTenant } from '@/types';

// ==========================================
// STORE HERO COMPONENT
// Banner section with CTA
// ==========================================

interface StoreHeroProps {
  tenant: PublicTenant;
}

export function StoreHero({ tenant }: StoreHeroProps) {
  if (tenant.banner) {
    return (
      <section className="relative h-48 md:h-64 lg:h-80 rounded-xl overflow-hidden bg-muted">
        <Image
          src={tenant.banner}
          alt={tenant.name}
          fill
          className="object-cover"
          priority
        />
        <div className="absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent" />
        <div className="absolute bottom-0 left-0 right-0 p-6 text-white">
          <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold">
            {tenant.name}
          </h1>
          {tenant.description && (
            <p className="mt-2 text-white/80 max-w-2xl line-clamp-2">
              {tenant.description}
            </p>
          )}
          <Button
            asChild
            className="mt-4"
            size="lg"
          >
            <a
              href={`https://wa.me/${tenant.whatsapp}`}
              target="_blank"
              rel="noopener noreferrer"
            >
              <MessageCircle className="h-5 w-5 mr-2" />
              Hubungi Kami
            </a>
          </Button>
        </div>
      </section>
    );
  }

  // No banner - simple hero
  return (
    <section className="text-center py-12 px-4 bg-gradient-to-b from-primary/5 to-transparent rounded-xl">
      <h1 className="text-3xl md:text-4xl font-bold mb-3">
        Selamat Datang di {tenant.name}
      </h1>
      {tenant.description && (
        <p className="text-muted-foreground max-w-2xl mx-auto mb-6">
          {tenant.description}
        </p>
      )}
      <Button asChild size="lg">
        <a
          href={`https://wa.me/${tenant.whatsapp}`}
          target="_blank"
          rel="noopener noreferrer"
        >
          <MessageCircle className="h-5 w-5 mr-2" />
          Hubungi Kami
        </a>
      </Button>
    </section>
  );
}

================================================
FILE: src/components/store/store-nav.tsx
Lines: 97
================================================

'use client';

import Link from 'next/link';
import Image from 'next/image';
import { Home, Package, Phone, MapPin } from 'lucide-react';
import { SheetHeader, SheetTitle } from '@/components/ui/sheet';
import { Separator } from '@/components/ui/separator';
import { formatPhone } from '@/lib/format';
import type { PublicTenant } from '@/types';

// ==========================================
// STORE NAVIGATION (Mobile Sidebar)
// ==========================================

interface StoreNavProps {
  tenant: PublicTenant;
}

export function StoreNav({ tenant }: StoreNavProps) {
  const storeUrl = `/store/${tenant.slug}`;

  const navItems = [
    { href: storeUrl, label: 'Beranda', icon: Home },
    { href: `${storeUrl}/products`, label: 'Semua Produk', icon: Package },
  ];

  return (
    <div className="flex flex-col h-full">
      {/* Header */}
      <SheetHeader className="p-4 border-b">
        <div className="flex items-center gap-3">
          {tenant.logo ? (
            <Image
              src={tenant.logo}
              alt={tenant.name}
              width={48}
              height={48}
              className="rounded-full object-cover"
            />
          ) : (
            <div className="flex h-12 w-12 items-center justify-center rounded-full bg-primary text-primary-foreground font-semibold text-lg">
              {tenant.name.charAt(0).toUpperCase()}
            </div>
          )}
          <div>
            <SheetTitle className="text-left">{tenant.name}</SheetTitle>
            <p className="text-xs text-muted-foreground">
              {tenant.category.replace(/_/g, ' ')}
            </p>
          </div>
        </div>
      </SheetHeader>

      {/* Navigation Links */}
      <nav className="flex-1 p-4">
        <ul className="space-y-1">
          {navItems.map((item) => (
            <li key={item.href}>
              <Link
                href={item.href}
                className="flex items-center gap-3 rounded-lg px-3 py-2 text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors"
              >
                <item.icon className="h-4 w-4" />
                {item.label}
              </Link>
            </li>
          ))}
        </ul>
      </nav>

      <Separator />

      {/* Store Info */}
      <div className="p-4 space-y-3">
        <h3 className="text-sm font-semibold">Informasi Toko</h3>

        {tenant.whatsapp && (
          <a
            href={`https://wa.me/${tenant.whatsapp}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center gap-3 text-sm text-muted-foreground hover:text-foreground"
          >
            <Phone className="h-4 w-4" />
            {formatPhone(tenant.whatsapp)}
          </a>
        )}

        {tenant.address && (
          <div className="flex items-start gap-3 text-sm text-muted-foreground">
            <MapPin className="h-4 w-4 mt-0.5 flex-shrink-0" />
            <span>{tenant.address}</span>
          </div>
        )}
      </div>
    </div>
  );
}

================================================
FILE: src/components/store/store-not-found.tsx
Lines: 50
================================================

import Link from 'next/link';
import { Store, ArrowLeft } from 'lucide-react';
import { Button } from '@/components/ui/button';

// ==========================================
// STORE NOT FOUND COMPONENT
// 404 page for invalid store slug
// ==========================================

interface StoreNotFoundProps {
  slug?: string;
}

export function StoreNotFound({ slug }: StoreNotFoundProps) {
  return (
    <div className="min-h-screen flex items-center justify-center p-4">
      <div className="text-center max-w-md">
        <div className="flex justify-center mb-6">
          <div className="rounded-full bg-muted p-6">
            <Store className="h-12 w-12 text-muted-foreground" />
          </div>
        </div>

        <h1 className="text-2xl font-bold mb-2">Toko Tidak Ditemukan</h1>

        <p className="text-muted-foreground mb-6">
          {slug ? (
            <>
              Toko dengan alamat <span className="font-medium">&quot;{slug}&quot;</span> tidak
              ditemukan atau sudah tidak aktif.
            </>
          ) : (
            'Toko yang Anda cari tidak ditemukan atau sudah tidak aktif.'
          )}
        </p>

        <div className="flex flex-col sm:flex-row gap-3 justify-center">
          <Button asChild variant="outline">
            <Link href="/">
              <ArrowLeft className="h-4 w-4 mr-2" />
              Kembali ke Beranda
            </Link>
          </Button>
          <Button asChild>
            <Link href="/register">Buat Toko Gratis</Link>
          </Button>
        </div>
      </div>
    </div>
  );
}

================================================
FILE: src/components/store/store-skeleton.tsx
Lines: 85
================================================

import { Skeleton } from '@/components/ui/skeleton';

// ==========================================
// STORE LOADING SKELETONS
// ==========================================

export function StoreHeaderSkeleton() {
  return (
    <header className="sticky top-0 z-50 w-full border-b bg-background">
      <div className="container flex h-16 items-center justify-between px-4">
        <div className="flex items-center gap-3">
          <Skeleton className="h-10 w-10 rounded-full" />
          <div className="hidden sm:block">
            <Skeleton className="h-5 w-32 mb-1" />
            <Skeleton className="h-3 w-20" />
          </div>
        </div>
        <div className="flex items-center gap-2">
          <Skeleton className="h-10 w-10 rounded-md" />
          <Skeleton className="h-10 w-10 rounded-md" />
        </div>
      </div>
    </header>
  );
}

export function ProductCardSkeleton() {
  return (
    <div className="rounded-lg border bg-card overflow-hidden">
      <Skeleton className="aspect-square w-full" />
      <div className="p-4">
        <Skeleton className="h-3 w-16 mb-2" />
        <Skeleton className="h-4 w-full mb-1" />
        <Skeleton className="h-4 w-3/4 mb-3" />
        <Skeleton className="h-5 w-24" />
      </div>
    </div>
  );
}

export function ProductGridSkeleton({ count = 8 }: { count?: number }) {
  return (
    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      {Array.from({ length: count }).map((_, i) => (
        <ProductCardSkeleton key={i} />
      ))}
    </div>
  );
}

export function ProductDetailSkeleton() {
  return (
    <div className="container px-4 py-8">
      {/* Breadcrumb */}
      <Skeleton className="h-5 w-64 mb-6" />

      <div className="grid gap-8 lg:grid-cols-2">
        {/* Gallery */}
        <div className="space-y-4">
          <Skeleton className="aspect-square w-full rounded-xl" />
          <div className="flex gap-2">
            {Array.from({ length: 4 }).map((_, i) => (
              <Skeleton key={i} className="h-20 w-20 rounded-lg" />
            ))}
          </div>
        </div>

        {/* Info */}
        <div className="space-y-4">
          <Skeleton className="h-4 w-24" />
          <Skeleton className="h-8 w-3/4" />
          <Skeleton className="h-6 w-20" />
          <Skeleton className="h-10 w-40" />
          <Skeleton className="h-px w-full" />
          <Skeleton className="h-4 w-32" />
          <Skeleton className="h-px w-full" />
          <div className="space-y-3">
            <Skeleton className="h-10 w-full" />
            <Skeleton className="h-12 w-full" />
            <Skeleton className="h-12 w-full" />
          </div>
        </div>
      </div>
    </div>
  );
}

================================================
FILE: src/components/store/whatsapp-checkout-dialog.tsx
Lines: 153
================================================

'use client';

import { useState } from 'react';
import { MessageCircle } from 'lucide-react';
import { Button } from '@/components/ui/button';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Separator } from '@/components/ui/separator';
import { formatPrice, generateWhatsAppLink } from '@/lib/format';
import { useCartStore, useCartItems, useCartTotalPrice } from '@/stores';

// ==========================================
// WHATSAPP CHECKOUT DIALOG
// Modal for cart checkout via WhatsApp
// ==========================================

interface WhatsAppCheckoutDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  storeName: string;
  storeWhatsApp: string;
}

export function WhatsAppCheckoutDialog({
  open,
  onOpenChange,
  storeName,
  storeWhatsApp,
}: WhatsAppCheckoutDialogProps) {
  const [name, setName] = useState('');
  const [notes, setNotes] = useState('');

  const items = useCartItems();
  const totalPrice = useCartTotalPrice();
  const clearCart = useCartStore((state) => state.clearCart);

  const handleOrder = () => {
    // Build items list
    const itemsList = items
      .map((item) => `‚Ä¢ ${item.name} x${item.qty} = ${formatPrice(item.price * item.qty)}`)
      .join('\n');

    const message = `Halo ${storeName},

Saya ingin memesan:

${itemsList}

*Total: ${formatPrice(totalPrice)}*
${name ? `\nNama: ${name}` : ''}${notes ? `\nCatatan: ${notes}` : ''}

Mohon konfirmasi ketersediaan.
Terima kasih!`;

    const link = generateWhatsAppLink(storeWhatsApp, message);
    window.open(link, '_blank');

    // Clear cart after order
    clearCart();
    onOpenChange(false);
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle>Pesan via WhatsApp</DialogTitle>
          <DialogDescription>
            Isi detail pesanan Anda, lalu klik tombol pesan untuk langsung
            terhubung dengan penjual via WhatsApp.
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-4 py-4">
          {/* Order Items */}
          <div className="rounded-lg bg-muted p-4">
            <ScrollArea className="max-h-[200px]">
              <div className="space-y-2">
                {items.map((item) => (
                  <div key={item.id} className="flex justify-between text-sm">
                    <div>
                      <span className="font-medium">{item.name}</span>
                      <span className="text-muted-foreground"> x{item.qty}</span>
                    </div>
                    <span>{formatPrice(item.price * item.qty)}</span>
                  </div>
                ))}
              </div>
            </ScrollArea>
          </div>

          <Separator />

          {/* Name (Optional) */}
          <div className="space-y-2">
            <Label htmlFor="checkout-name">Nama (opsional)</Label>
            <Input
              id="checkout-name"
              placeholder="Nama Anda"
              value={name}
              onChange={(e) => setName(e.target.value)}
            />
          </div>

          {/* Notes (Optional) */}
          <div className="space-y-2">
            <Label htmlFor="checkout-notes">Catatan (opsional)</Label>
            <Textarea
              id="checkout-notes"
              placeholder="Catatan tambahan untuk penjual..."
              value={notes}
              onChange={(e) => setNotes(e.target.value)}
              rows={3}
            />
          </div>

          {/* Total */}
          <div className="flex items-center justify-between rounded-lg bg-primary/10 p-4">
            <span className="font-medium">Total</span>
            <span className="text-xl font-bold text-primary">
              {formatPrice(totalPrice)}
            </span>
          </div>
        </div>

        <DialogFooter>
          <Button variant="outline" onClick={() => onOpenChange(false)}>
            Batal
          </Button>
          <Button onClick={handleOrder} disabled={items.length === 0}>
            <svg
              className="h-5 w-5 mr-2"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
            </svg>
            Pesan Sekarang
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}

================================================
FILE: src/components/store/whatsapp-order-button.tsx
Lines: 167
================================================

'use client';

import { useState } from 'react';
import { MessageCircle } from 'lucide-react';
import { Button } from '@/components/ui/button';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { formatPrice, generateWhatsAppLink } from '@/lib/format';
import type { Product, PublicTenant } from '@/types';

// ==========================================
// WHATSAPP ORDER BUTTON
// Direct order via WhatsApp
// ==========================================

interface WhatsAppOrderButtonProps {
  product: Product;
  tenant: PublicTenant;
  className?: string;
}

export function WhatsAppOrderButton({
  product,
  tenant,
  className,
}: WhatsAppOrderButtonProps) {
  const [open, setOpen] = useState(false);
  const [qty, setQty] = useState(1);
  const [name, setName] = useState('');
  const [notes, setNotes] = useState('');

  const isOutOfStock = product.trackStock && (product.stock ?? 0) <= 0;
  const maxQty = product.trackStock ? (product.stock ?? 99) : 99;
  const total = product.price * qty;

  const handleOrder = () => {
    const message = `Halo ${tenant.name},

Saya ingin memesan:
*${product.name}*
Jumlah: ${qty} ${product.unit || 'pcs'}
Harga: ${formatPrice(product.price)}
Total: ${formatPrice(total)}
${name ? `\nNama: ${name}` : ''}${notes ? `\nCatatan: ${notes}` : ''}

Mohon konfirmasi ketersediaan.
Terima kasih!`;

    const link = generateWhatsAppLink(tenant.whatsapp, message);
    window.open(link, '_blank');
    setOpen(false);
  };

  if (isOutOfStock) {
    return (
      <Button disabled className={className}>
        <MessageCircle className="h-5 w-5 mr-2" />
        Stok Habis
      </Button>
    );
  }

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button variant="outline" className={className}>
          <MessageCircle className="h-5 w-5 mr-2" />
          Pesan via WhatsApp
        </Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Pesan via WhatsApp</DialogTitle>
          <DialogDescription>
            Isi detail pesanan Anda, lalu klik tombol pesan untuk langsung
            terhubung dengan penjual via WhatsApp.
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-4 py-4">
          {/* Product Summary */}
          <div className="rounded-lg bg-muted p-4">
            <h4 className="font-medium">{product.name}</h4>
            <p className="text-sm text-muted-foreground">
              {formatPrice(product.price)} per {product.unit || 'pcs'}
            </p>
          </div>

          {/* Quantity */}
          <div className="space-y-2">
            <Label htmlFor="qty">Jumlah</Label>
            <div className="flex items-center gap-2">
              <Input
                id="qty"
                type="number"
                min={1}
                max={maxQty}
                value={qty}
                onChange={(e) => setQty(Math.min(Number(e.target.value) || 1, maxQty))}
                className="w-24"
              />
              {product.unit && (
                <span className="text-sm text-muted-foreground">{product.unit}</span>
              )}
            </div>
          </div>

          {/* Name (Optional) */}
          <div className="space-y-2">
            <Label htmlFor="name">Nama (opsional)</Label>
            <Input
              id="name"
              placeholder="Nama Anda"
              value={name}
              onChange={(e) => setName(e.target.value)}
            />
          </div>

          {/* Notes (Optional) */}
          <div className="space-y-2">
            <Label htmlFor="notes">Catatan (opsional)</Label>
            <Textarea
              id="notes"
              placeholder="Catatan tambahan untuk penjual..."
              value={notes}
              onChange={(e) => setNotes(e.target.value)}
              rows={3}
            />
          </div>

          {/* Total */}
          <div className="flex items-center justify-between rounded-lg bg-primary/10 p-4">
            <span className="font-medium">Total</span>
            <span className="text-xl font-bold text-primary">
              {formatPrice(total)}
            </span>
          </div>
        </div>

        <DialogFooter>
          <Button variant="outline" onClick={() => setOpen(false)}>
            Batal
          </Button>
          <Button onClick={handleOrder}>
            <svg
              className="h-5 w-5 mr-2"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
            </svg>
            Pesan Sekarang
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}


################################################################
##
##  CATEGORY: Landing Components
##  Path: src/components/landing
##
################################################################

================================================
FILE: src/components/landing/index.ts
Lines: 6
================================================

export { TenantHero } from './tenant-hero';
export { TenantAbout } from './tenant-about';
export { TenantProducts } from './tenant-products';
export { TenantTestimonials } from './tenant-testimonials';
export { TenantContact } from './tenant-contact';
export { TenantCta } from './tenant-cta';
export { LandingBuilder } from './landing-builder';

================================================
FILE: src/components/landing/landing-builder.tsx
Lines: 499
================================================

'use client';

import { useState } from 'react';
import {
  Loader2,
  Eye,
  Save,
  RotateCcw,
  Target,
  BookOpen,
  ShoppingBag,
  Star,
  Phone,
  Rocket,
} from 'lucide-react';
import { toast } from 'sonner';

import { Button } from '@/components/ui/button';
import { Switch } from '@/components/ui/switch';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Card, CardContent } from '@/components/ui/card';
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from '@/components/ui/accordion';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Separator } from '@/components/ui/separator';

import { tenantsApi } from '@/lib/api';
import { DEFAULT_LANDING_CONFIG } from '@/types/landing';
import type { TenantLandingConfig } from '@/types';

// ==========================================
// TYPES
// ==========================================

interface LandingBuilderProps {
  config: TenantLandingConfig;
  onConfigChange: (config: TenantLandingConfig) => void;
  tenantSlug: string;
  onSave?: () => void;
  hasUnsavedChanges?: boolean;
}

// ==========================================
// SECTION DEFINITIONS (Lucide Icons)
// ==========================================

const SECTIONS = [
  {
    key: 'hero',
    title: 'Hero Section',
    description: 'Banner utama di bagian atas halaman',
    icon: Target,
  },
  {
    key: 'about',
    title: 'Tentang Kami',
    description: 'Informasi tentang toko Anda',
    icon: BookOpen,
  },
  {
    key: 'products',
    title: 'Produk',
    description: 'Tampilkan produk unggulan',
    icon: ShoppingBag,
  },
  {
    key: 'testimonials',
    title: 'Testimoni',
    description: 'Ulasan dari pelanggan',
    icon: Star,
  },
  {
    key: 'contact',
    title: 'Kontak',
    description: 'Informasi kontak toko',
    icon: Phone,
  },
  {
    key: 'cta',
    title: 'Call to Action',
    description: 'Ajakan untuk berbelanja',
    icon: Rocket,
  },
] as const;

type SectionKey = (typeof SECTIONS)[number]['key'];

// ==========================================
// MAIN COMPONENT
// ==========================================

export function LandingBuilder({
  config,
  onConfigChange,
  tenantSlug,
  onSave,
  hasUnsavedChanges,
}: LandingBuilderProps) {
  const [isSaving, setIsSaving] = useState(false);
  const [expandedSections, setExpandedSections] = useState<string[]>(['hero']);

  // ==========================================
  // HANDLERS - Now using parent state
  // ==========================================

  const handleToggleSection = (key: SectionKey, enabled: boolean) => {
    onConfigChange({
      ...config,
      [key]: {
        ...config[key],
        enabled,
      },
    });
  };

  const handleUpdateSection = (
    key: SectionKey,
    updates: Partial<TenantLandingConfig[SectionKey]>
  ) => {
    onConfigChange({
      ...config,
      [key]: {
        ...config[key],
        ...updates,
      },
    });
  };

  const handleUpdateSectionConfig = (
    key: SectionKey,
    configUpdates: Record<string, unknown>
  ) => {
    onConfigChange({
      ...config,
      [key]: {
        ...config[key],
        config: {
          ...config[key]?.config,
          ...configUpdates,
        },
      },
    });
  };

  const handleSave = async () => {
    setIsSaving(true);
    try {
      await tenantsApi.update({ landingConfig: config });
      toast.success('Landing page berhasil disimpan');
      onSave?.();
    } catch (error) {
      console.error('Failed to save:', error);
      toast.error('Gagal menyimpan landing page');
    } finally {
      setIsSaving(false);
    }
  };

  const handleReset = () => {
    onConfigChange(DEFAULT_LANDING_CONFIG);
    toast.info('Konfigurasi direset ke default');
  };

  const handlePreview = () => {
    window.open(`/store/${tenantSlug}`, '_blank');
  };

  return (
    <div className="space-y-6">
      {/* Actions */}
      <div className="flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between">
        <div>
          <h3 className="text-lg font-semibold">Landing Page Builder</h3>
          <p className="text-sm text-muted-foreground">
            Kustomisasi halaman landing toko Anda
          </p>
        </div>
        <div className="flex gap-2">
          <Button variant="outline" size="sm" onClick={handleReset}>
            <RotateCcw className="h-4 w-4 mr-2" />
            Reset
          </Button>
          <Button variant="outline" size="sm" onClick={handlePreview}>
            <Eye className="h-4 w-4 mr-2" />
            Preview
          </Button>
          <Button
            size="sm"
            onClick={handleSave}
            disabled={isSaving || !hasUnsavedChanges}
            className={hasUnsavedChanges ? 'animate-pulse' : ''}
          >
            {isSaving ? (
              <Loader2 className="h-4 w-4 mr-2 animate-spin" />
            ) : (
              <Save className="h-4 w-4 mr-2" />
            )}
            Simpan
          </Button>
        </div>
      </div>

      {/* Global Toggle */}
      <Card>
        <CardContent className="pt-6">
          <div className="flex items-center justify-between">
            <div>
              <Label className="text-base font-medium">
                Aktifkan Landing Page Custom
              </Label>
              <p className="text-sm text-muted-foreground">
                Jika dimatikan, akan menggunakan tampilan default
              </p>
            </div>
            <Switch
              checked={config.enabled}
              onCheckedChange={(enabled) =>
                onConfigChange({ ...config, enabled })
              }
            />
          </div>
        </CardContent>
      </Card>

      {/* Sections */}
      {config.enabled && (
        <Accordion
          type="multiple"
          value={expandedSections}
          onValueChange={setExpandedSections}
          className="space-y-4"
        >
          {SECTIONS.map((section) => {
            const IconComponent = section.icon;
            const isEnabled = config[section.key]?.enabled ?? false;

            return (
              <AccordionItem
                key={section.key}
                value={section.key}
                className="border rounded-lg"
              >
                {/* FIXED LAYOUT: Icon/Text (flex-1) | Toggle | Arrow */}
                <div className="flex items-center gap-4 px-4 py-2">
                  <div className="flex items-center gap-3 flex-1">
                    <IconComponent className="h-5 w-5 text-muted-foreground" />
                    <div className="text-left">
                      <p className="font-medium">{section.title}</p>
                      <p className="text-sm text-muted-foreground">
                        {section.description}
                      </p>
                    </div>
                  </div>
                  <Switch
                    checked={isEnabled}
                    onCheckedChange={(enabled) =>
                      handleToggleSection(section.key, enabled)
                    }
                    onClick={(e) => e.stopPropagation()}
                  />
                  <AccordionTrigger className="hover:no-underline py-2" />
                </div>
                <AccordionContent className="px-4 pb-4">
                  <Separator className="mb-4" />
                  <SectionEditor
                    sectionKey={section.key}
                    config={config[section.key]}
                    onUpdate={(updates) =>
                      handleUpdateSection(section.key, updates)
                    }
                    onUpdateConfig={(configUpdates) =>
                      handleUpdateSectionConfig(section.key, configUpdates)
                    }
                  />
                </AccordionContent>
              </AccordionItem>
            );
          })}
        </Accordion>
      )}
    </div>
  );
}

// ==========================================
// SECTION EDITOR
// ==========================================

interface SectionEditorProps {
  sectionKey: SectionKey;
  config: TenantLandingConfig[SectionKey];
  onUpdate: (updates: Partial<TenantLandingConfig[SectionKey]>) => void;
  onUpdateConfig: (configUpdates: Record<string, unknown>) => void;
}

function SectionEditor({
  sectionKey,
  config,
  onUpdate,
  onUpdateConfig,
}: SectionEditorProps) {
  return (
    <div className="space-y-4">
      {/* Common Fields: Title & Subtitle */}
      <div className="grid gap-4 sm:grid-cols-2">
        <div className="space-y-2">
          <Label htmlFor={`${sectionKey}-title`}>Judul</Label>
          <Input
            id={`${sectionKey}-title`}
            value={config?.title || ''}
            onChange={(e) => onUpdate({ title: e.target.value })}
            placeholder="Masukkan judul..."
          />
        </div>
        <div className="space-y-2">
          <Label htmlFor={`${sectionKey}-subtitle`}>Subtitle</Label>
          <Input
            id={`${sectionKey}-subtitle`}
            value={config?.subtitle || ''}
            onChange={(e) => onUpdate({ subtitle: e.target.value })}
            placeholder="Masukkan subtitle..."
          />
        </div>
      </div>

      {/* Section-Specific Fields */}
      {sectionKey === 'hero' && (
        <HeroFields config={config?.config} onUpdate={onUpdateConfig} />
      )}
      {sectionKey === 'about' && (
        <AboutFields config={config?.config} onUpdate={onUpdateConfig} />
      )}
      {sectionKey === 'products' && (
        <ProductsFields config={config?.config} onUpdate={onUpdateConfig} />
      )}
      {sectionKey === 'cta' && (
        <CtaFields config={config?.config} onUpdate={onUpdateConfig} />
      )}
    </div>
  );
}

// ==========================================
// FIELD COMPONENTS
// ==========================================

interface FieldProps {
  config: Record<string, unknown> | undefined;
  onUpdate: (updates: Record<string, unknown>) => void;
}

function HeroFields({ config, onUpdate }: FieldProps) {
  return (
    <div className="space-y-4">
      <div className="space-y-2">
        <Label>Layout</Label>
        <Select
          value={(config?.layout as string) || 'centered'}
          onValueChange={(value) => onUpdate({ layout: value })}
        >
          <SelectTrigger>
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="centered">Tengah</SelectItem>
            <SelectItem value="left">Kiri</SelectItem>
            <SelectItem value="right">Kanan</SelectItem>
          </SelectContent>
        </Select>
      </div>
      <div className="space-y-2">
        <Label>Teks Tombol CTA</Label>
        <Input
          value={(config?.ctaText as string) || ''}
          onChange={(e) => onUpdate({ ctaText: e.target.value })}
          placeholder="Lihat Produk"
        />
      </div>
      <div className="flex items-center justify-between">
        <Label>Tampilkan Tombol CTA</Label>
        <Switch
          checked={(config?.showCta as boolean) ?? true}
          onCheckedChange={(checked) => onUpdate({ showCta: checked })}
        />
      </div>
    </div>
  );
}

function AboutFields({ config, onUpdate }: FieldProps) {
  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <Label>Tampilkan Gambar</Label>
        <Switch
          checked={(config?.showImage as boolean) ?? true}
          onCheckedChange={(checked) => onUpdate({ showImage: checked })}
        />
      </div>
      <div className="space-y-2">
        <Label>URL Gambar</Label>
        <Input
          value={(config?.image as string) || ''}
          onChange={(e) => onUpdate({ image: e.target.value })}
          placeholder="https://..."
        />
      </div>
    </div>
  );
}

function ProductsFields({ config, onUpdate }: FieldProps) {
  return (
    <div className="space-y-4">
      <div className="space-y-2">
        <Label>Mode Tampilan</Label>
        <Select
          value={(config?.displayMode as string) || 'featured'}
          onValueChange={(value) => onUpdate({ displayMode: value })}
        >
          <SelectTrigger>
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="featured">Produk Unggulan</SelectItem>
            <SelectItem value="latest">Produk Terbaru</SelectItem>
            <SelectItem value="all">Semua Produk</SelectItem>
          </SelectContent>
        </Select>
      </div>
      <div className="space-y-2">
        <Label>Jumlah Produk</Label>
        <Input
          type="number"
          min={1}
          max={20}
          value={(config?.limit as number) || 8}
          onChange={(e) => onUpdate({ limit: parseInt(e.target.value) || 8 })}
        />
      </div>
      <div className="flex items-center justify-between">
        <Label>Tampilkan Tombol Lihat Semua</Label>
        <Switch
          checked={(config?.showViewAll as boolean) ?? true}
          onCheckedChange={(checked) => onUpdate({ showViewAll: checked })}
        />
      </div>
    </div>
  );
}

function CtaFields({ config, onUpdate }: FieldProps) {
  return (
    <div className="space-y-4">
      <div className="space-y-2">
        <Label>Teks Tombol</Label>
        <Input
          value={(config?.buttonText as string) || ''}
          onChange={(e) => onUpdate({ buttonText: e.target.value })}
          placeholder="Mulai Belanja"
        />
      </div>
      <div className="space-y-2">
        <Label>Link Tombol</Label>
        <Input
          value={(config?.buttonLink as string) || ''}
          onChange={(e) => onUpdate({ buttonLink: e.target.value })}
          placeholder="/products"
        />
      </div>
      <div className="space-y-2">
        <Label>Style Tombol</Label>
        <Select
          value={(config?.style as string) || 'primary'}
          onValueChange={(value) => onUpdate({ style: value })}
        >
          <SelectTrigger>
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="primary">Primary</SelectItem>
            <SelectItem value="secondary">Secondary</SelectItem>
            <SelectItem value="outline">Outline</SelectItem>
          </SelectContent>
        </Select>
      </div>
    </div>
  );
}

================================================
FILE: src/components/landing/tenant-about.tsx
Lines: 67
================================================

'use client';

import Image from 'next/image';
import { CheckCircle } from 'lucide-react';
import type { PublicTenant, TenantLandingConfig } from '@/types';

interface TenantAboutProps {
  tenant: PublicTenant;
  config?: TenantLandingConfig['about'];
}

export function TenantAbout({ tenant, config }: TenantAboutProps) {
  const title = config?.title || 'Tentang Kami';
  const subtitle = config?.subtitle || '';
  const content = config?.config?.content || tenant.description || '';
  const showImage = config?.config?.showImage ?? true;
  const image = config?.config?.image || tenant.banner;
  const features = config?.config?.features || [];

  return (
    <section id="about" className="py-12">
      {/* Section Header */}
      <div className="text-center mb-8">
        <h2 className="text-2xl md:text-3xl font-bold">{title}</h2>
        {subtitle && <p className="text-muted-foreground mt-2">{subtitle}</p>}
      </div>

      <div className="grid md:grid-cols-2 gap-8 items-center">
        {/* Image */}
        {showImage && image && (
          <div className="relative aspect-video rounded-xl overflow-hidden">
            <Image
              src={image}
              alt={title}
              fill
              className="object-cover"
              unoptimized={image.startsWith('http')}
            />
          </div>
        )}

        {/* Content */}
        <div className="space-y-6">
          {content && (
            <p className="text-muted-foreground leading-relaxed">{content}</p>
          )}

          {/* Features */}
          {features.length > 0 && (
            <div className="grid gap-4">
              {features.map((feature, index) => (
                <div key={index} className="flex items-start gap-3">
                  <CheckCircle className="h-5 w-5 text-primary mt-0.5 flex-shrink-0" />
                  <div>
                    <p className="font-medium">{feature.title}</p>
                    {feature.description && (
                      <p className="text-sm text-muted-foreground">{feature.description}</p>
                    )}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </section>
  );
}

================================================
FILE: src/components/landing/tenant-contact.tsx
Lines: 97
================================================

'use client';

import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Phone, MapPin, MessageCircle } from 'lucide-react';
import type { PublicTenant, TenantLandingConfig } from '@/types';

interface TenantContactProps {
  tenant: PublicTenant;
  config?: TenantLandingConfig['contact'];
}

export function TenantContact({ tenant, config }: TenantContactProps) {
  const title = config?.title || 'Hubungi Kami';
  const subtitle = config?.subtitle || '';

  const whatsappLink = tenant.whatsapp
    ? `https://wa.me/${tenant.whatsapp}?text=${encodeURIComponent(`Halo ${tenant.name}, saya tertarik dengan produk Anda.`)}`
    : null;

  return (
    <section id="contact" className="py-12">
      {/* Section Header */}
      <div className="text-center mb-8">
        <h2 className="text-2xl md:text-3xl font-bold">{title}</h2>
        {subtitle && <p className="text-muted-foreground mt-2">{subtitle}</p>}
      </div>

      {/* Contact Card */}
      <div className="max-w-2xl mx-auto">
        <Card>
          <CardContent className="pt-6">
            <div className="grid gap-4">
              {/* WhatsApp */}
              {tenant.whatsapp && (
                <a
                  href={whatsappLink!}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-4 p-4 rounded-lg bg-green-50 hover:bg-green-100 transition-colors dark:bg-green-950/30 dark:hover:bg-green-950/50"
                >
                  <div className="flex-shrink-0 p-3 bg-green-500 rounded-full">
                    <MessageCircle className="h-6 w-6 text-white" />
                  </div>
                  <div>
                    <p className="font-medium">WhatsApp</p>
                    <p className="text-sm text-muted-foreground">+{tenant.whatsapp}</p>
                  </div>
                </a>
              )}

              {/* Phone */}
              {tenant.phone && (
                <a
                  href={`tel:${tenant.phone}`}
                  className="flex items-center gap-4 p-4 rounded-lg bg-muted/50 hover:bg-muted transition-colors"
                >
                  <div className="flex-shrink-0 p-3 bg-primary/10 rounded-full">
                    <Phone className="h-6 w-6 text-primary" />
                  </div>
                  <div>
                    <p className="font-medium">Telepon</p>
                    <p className="text-sm text-muted-foreground">{tenant.phone}</p>
                  </div>
                </a>
              )}

              {/* Address */}
              {tenant.address && (
                <div className="flex items-start gap-4 p-4 rounded-lg bg-muted/50">
                  <div className="flex-shrink-0 p-3 bg-primary/10 rounded-full">
                    <MapPin className="h-6 w-6 text-primary" />
                  </div>
                  <div>
                    <p className="font-medium">Alamat</p>
                    <p className="text-sm text-muted-foreground">{tenant.address}</p>
                  </div>
                </div>
              )}
            </div>

            {/* WhatsApp CTA */}
            {whatsappLink && (
              <div className="mt-6 text-center">
                <Button asChild size="lg" className="gap-2">
                  <a href={whatsappLink} target="_blank" rel="noopener noreferrer">
                    <MessageCircle className="h-5 w-5" />
                    Chat via WhatsApp
                  </a>
                </Button>
              </div>
            )}
          </CardContent>
        </Card>
      </div>
    </section>
  );
}

================================================
FILE: src/components/landing/tenant-cta.tsx
Lines: 35
================================================

'use client';

import Link from 'next/link';
import { ArrowRight } from 'lucide-react';
import { Button } from '@/components/ui/button';
import type { TenantLandingConfig } from '@/types';

interface TenantCtaProps {
  storeSlug: string;
  config?: TenantLandingConfig['cta'];
}

export function TenantCta({ storeSlug, config }: TenantCtaProps) {
  const title = config?.title || 'Siap Berbelanja?';
  const subtitle = config?.subtitle || '';
  const buttonText = config?.config?.buttonText || 'Mulai Belanja';
  const buttonLink = config?.config?.buttonLink || `/store/${storeSlug}/products`;
  const style = config?.config?.style || 'primary';

  const buttonVariant = style === 'outline' ? 'outline' : style === 'secondary' ? 'secondary' : 'default';

  return (
    <section className="py-16 my-8 rounded-xl bg-gradient-to-r from-primary/10 via-primary/5 to-primary/10">
      <div className="text-center max-w-2xl mx-auto px-4">
        <h2 className="text-2xl md:text-3xl font-bold">{title}</h2>
        {subtitle && <p className="text-muted-foreground mt-2 mb-6">{subtitle}</p>}
        <Link href={buttonLink}>
          <Button size="lg" variant={buttonVariant} className="gap-2 mt-4">
            {buttonText}
            <ArrowRight className="h-4 w-4" />
          </Button>
        </Link>
      </div>
    </section>
  );
}

================================================
FILE: src/components/landing/tenant-hero.tsx
Lines: 94
================================================

'use client';

import Link from 'next/link';
import Image from 'next/image';
import { ArrowRight } from 'lucide-react';
import { Button } from '@/components/ui/button';
import type { PublicTenant, TenantLandingConfig } from '@/types';

interface TenantHeroProps {
  tenant: PublicTenant;
  config?: TenantLandingConfig['hero'];
}

export function TenantHero({ tenant, config }: TenantHeroProps) {
  const title = config?.title || tenant.name;
  const subtitle = config?.subtitle || tenant.description || '';
  const layout = config?.config?.layout || 'centered';
  const showCta = config?.config?.showCta ?? true;
  const ctaText = config?.config?.ctaText || 'Lihat Produk';
  const backgroundImage = config?.config?.backgroundImage || tenant.banner;
  const overlayOpacity = config?.config?.overlayOpacity ?? 0.5;

  const layoutClasses = {
    centered: 'text-center items-center',
    left: 'text-left items-start',
    right: 'text-right items-end',
  };

  return (
    <section className="relative min-h-[400px] flex items-center justify-center overflow-hidden rounded-xl">
      {/* Background Image */}
      {backgroundImage && (
        <>
          <div className="absolute inset-0">
            <Image
              src={backgroundImage}
              alt={tenant.name}
              fill
              className="object-cover"
              priority
              unoptimized={backgroundImage.startsWith('http')}
            />
          </div>
          <div
            className="absolute inset-0 bg-black"
            style={{ opacity: overlayOpacity }}
          />
        </>
      )}

      {/* Content */}
      <div className={`relative z-10 max-w-3xl px-6 py-12 flex flex-col gap-4 ${layoutClasses[layout]}`}>
        {/* Logo */}
        {tenant.logo && (
          <div className="relative h-20 w-20 rounded-full overflow-hidden border-4 border-white shadow-lg">
            <Image
              src={tenant.logo}
              alt={tenant.name}
              fill
              className="object-cover"
              unoptimized={tenant.logo.startsWith('http')}
            />
          </div>
        )}

        {/* Title */}
        <h1 className={`text-3xl md:text-5xl font-bold ${backgroundImage ? 'text-white' : 'text-foreground'}`}>
          {title}
        </h1>

        {/* Subtitle */}
        {subtitle && (
          <p className={`text-lg md:text-xl max-w-2xl ${backgroundImage ? 'text-white/90' : 'text-muted-foreground'}`}>
            {subtitle}
          </p>
        )}

        {/* CTA Button */}
        {showCta && (
          <Link href={config?.config?.ctaLink || '#products'}>
            <Button size="lg" className="mt-4 gap-2">
              {ctaText}
              <ArrowRight className="h-4 w-4" />
            </Button>
          </Link>
        )}
      </div>

      {/* Gradient Background (no image) */}
      {!backgroundImage && (
        <div className="absolute inset-0 bg-gradient-to-br from-primary/5 via-background to-primary/10 -z-10" />
      )}
    </section>
  );
}

================================================
FILE: src/components/landing/tenant-products.tsx
Lines: 49
================================================

'use client';

import Link from 'next/link';
import { ArrowRight } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { ProductCard } from '@/components/store/product-card';
import type { Product, TenantLandingConfig } from '@/types';

interface TenantProductsProps {
  products: Product[];
  storeSlug: string;
  config?: TenantLandingConfig['products'];
}

export function TenantProducts({ products, storeSlug, config }: TenantProductsProps) {
  const title = config?.title || 'Produk Kami';
  const subtitle = config?.subtitle || '';
  const showViewAll = config?.config?.showViewAll ?? true;
  const limit = config?.config?.limit || 8;

  const displayProducts = products.slice(0, limit);

  if (displayProducts.length === 0) return null;

  return (
    <section id="products" className="py-12">
      {/* Section Header */}
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
        <div>
          <h2 className="text-2xl md:text-3xl font-bold">{title}</h2>
          {subtitle && <p className="text-muted-foreground mt-1">{subtitle}</p>}
        </div>
        {showViewAll && (
          <Link href={`/store/${storeSlug}/products`}>
            <Button variant="outline" className="gap-2">
              Lihat Semua <ArrowRight className="h-4 w-4" />
            </Button>
          </Link>
        )}
      </div>

      {/* Products Grid */}
      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
        {displayProducts.map((product) => (
          <ProductCard key={product.id} product={product} storeSlug={storeSlug} />
        ))}
      </div>
    </section>
  );
}

================================================
FILE: src/components/landing/tenant-testimonials.tsx
Lines: 67
================================================

'use client';

import { Card, CardContent } from '@/components/ui/card';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Star, Quote } from 'lucide-react';
import type { TenantLandingConfig } from '@/types';

interface TenantTestimonialsProps {
  config?: TenantLandingConfig['testimonials'];
}

export function TenantTestimonials({ config }: TenantTestimonialsProps) {
  const title = config?.title || 'Testimoni';
  const subtitle = config?.subtitle || '';
  const items = config?.config?.items || [];

  if (items.length === 0) return null;

  return (
    <section id="testimonials" className="py-12">
      {/* Section Header */}
      <div className="text-center mb-8">
        <h2 className="text-2xl md:text-3xl font-bold">{title}</h2>
        {subtitle && <p className="text-muted-foreground mt-2">{subtitle}</p>}
      </div>

      {/* Testimonials Grid */}
      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {items.map((item) => (
          <Card key={item.id} className="relative">
            <CardContent className="pt-6">
              {/* Quote Icon */}
              <Quote className="h-8 w-8 text-primary/20 absolute top-4 right-4" />

              {/* Rating */}
              {item.rating && (
                <div className="flex gap-1 mb-4">
                  {Array.from({ length: 5 }).map((_, i) => (
                    <Star
                      key={`${item.id}-star-${i}`}
                      className={`h-4 w-4 ${i < item.rating! ? 'text-yellow-500 fill-yellow-500' : 'text-muted'
                        }`}
                    />
                  ))}
                </div>
              )}

              {/* Content */}
              <p className="text-muted-foreground mb-4 italic">&quot;{item.content}&quot;</p>

              {/* Author */}
              <div className="flex items-center gap-3">
                <Avatar className="h-10 w-10">
                  <AvatarImage src={item.avatar} alt={item.name} />
                  <AvatarFallback>{item.name.charAt(0).toUpperCase()}</AvatarFallback>
                </Avatar>
                <div>
                  <p className="font-medium">{item.name}</p>
                  {item.role && <p className="text-sm text-muted-foreground">{item.role}</p>}
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
    </section>
  );
}


################################################################
##
##  CATEGORY: Upload Components
##  Path: src/components/upload
##
################################################################

================================================
FILE: src/components/upload/index.ts
Lines: 1
================================================

export { ImageUpload } from './image-upload';
export { MultiImageUpload } from './multi-image-upload';

================================================
FILE: src/components/upload/image-upload.tsx
Lines: 283
================================================

"use client";

import { useCallback, useRef, useState } from "react";
import { ImagePlus, Trash2, Upload, Loader2 } from "lucide-react";
import Image from "next/image";
import Script from "next/script";

import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";

// Cloudinary types
declare global {
  interface Window {
    cloudinary?: {
      createUploadWidget: (
        options: CloudinaryWidgetOptions,
        callback: CloudinaryCallback
      ) => CloudinaryWidget;
    };
  }
}

interface CloudinaryWidgetOptions {
  cloudName: string;
  uploadPreset: string;
  sources?: string[];
  multiple?: boolean;
  maxFiles?: number;
  folder?: string;
  cropping?: boolean;
  croppingAspectRatio?: number;
  showSkipCropButton?: boolean;
  resourceType?: string;
  clientAllowedFormats?: string[];
  maxFileSize?: number;
  styles?: {
    palette?: Record<string, string>;
    fonts?: Record<string, unknown>;
  };
}

interface CloudinaryWidget {
  open: () => void;
  close: () => void;
  destroy: () => void;
}

interface CloudinaryResult {
  event: string;
  info?: {
    secure_url?: string;
    public_id?: string;
    original_filename?: string;
    format?: string;
    resource_type?: string;
    bytes?: number;
    width?: number;
    height?: number;
  };
}

type CloudinaryCallback = (error: Error | null, result: CloudinaryResult) => void;

interface ImageUploadProps {
  value?: string;
  onChange: (url: string) => void;
  onRemove?: () => void;
  disabled?: boolean;
  className?: string;
  aspectRatio?: number;
  folder?: string;
  placeholder?: string;
  showPreview?: boolean;
}

// Check if cloudinary is already loaded (runs only on client)
function getInitialScriptState(): boolean {
  if (typeof window === "undefined") return false;
  return !!window.cloudinary;
}

export function ImageUpload({
  value,
  onChange,
  onRemove,
  disabled = false,
  className,
  aspectRatio = 1,
  folder = "tenant-uploads",
  placeholder = "Upload gambar",
  showPreview = true,
}: ImageUploadProps) {
  const [isLoading, setIsLoading] = useState(false);
  // Use lazy initial state to check if script already loaded
  const [isScriptLoaded, setIsScriptLoaded] = useState(getInitialScriptState);
  const widgetRef = useRef<CloudinaryWidget | null>(null);

  // ==========================================
  // CLOUDINARY WIDGET SETUP
  // ==========================================
  const openWidget = useCallback(() => {
    if (disabled) return;

    if (!window.cloudinary) {
      console.error("Cloudinary not loaded yet. Please wait...");
      return;
    }

    // Destroy old widget if exists (to update config)
    if (widgetRef.current) {
      widgetRef.current.destroy();
      widgetRef.current = null;
    }

    // Create new widget
    widgetRef.current = window.cloudinary.createUploadWidget(
      {
        cloudName: process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME || "",
        uploadPreset: process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET || "",
        sources: ["local", "url", "camera"],
        multiple: false,
        maxFiles: 1,
        folder,
        cropping: true,
        croppingAspectRatio: aspectRatio,
        showSkipCropButton: false,
        resourceType: "image",
        clientAllowedFormats: ["png", "jpg", "jpeg", "webp", "gif"],
        maxFileSize: 5000000, // 5MB
        styles: {
          palette: {
            window: "#FFFFFF",
            windowBorder: "#90A0B3",
            tabIcon: "#0078FF",
            menuIcons: "#5A616A",
            textDark: "#000000",
            textLight: "#FFFFFF",
            link: "#0078FF",
            action: "#FF620C",
            inactiveTabIcon: "#0E2F5A",
            error: "#F44235",
            inProgress: "#0078FF",
            complete: "#20B832",
            sourceBg: "#E4EBF1",
          },
        },
      },
      (error, result) => {
        if (error) {
          console.error("Upload error:", error);
          setIsLoading(false);
          // FIX: Reset body overflow on error
          document.body.style.overflow = "";
          return;
        }

        if (result.event === "success" && result.info?.secure_url) {
          onChange(result.info.secure_url);
          setIsLoading(false);
          // FIX: Reset body overflow on success
          document.body.style.overflow = "";
        }

        // FIX: Reset body overflow on close
        if (result.event === "close") {
          setIsLoading(false);
          document.body.style.overflow = "";
        }

        if (result.event === "queues-start") {
          setIsLoading(true);
        }
      }
    );

    widgetRef.current.open();
  }, [disabled, folder, aspectRatio, onChange]);

  const handleRemove = () => {
    if (onRemove) {
      onRemove();
    } else {
      onChange("");
    }
  };

  // Handle script load
  const handleScriptLoad = () => {
    setIsScriptLoaded(true);
  };

  return (
    <>
      {/* Load Cloudinary Script - only if not already loaded */}
      {!isScriptLoaded && (
        <Script
          src="https://upload-widget.cloudinary.com/global/all.js"
          strategy="lazyOnload"
          onLoad={handleScriptLoad}
        />
      )}

      <div className={cn("relative group", className)}>
        {value && showPreview ? (
          // Preview Mode
          <div
            className="relative overflow-hidden rounded-lg border bg-muted"
            style={{ aspectRatio }}
          >
            <Image
              src={value}
              alt="Uploaded image"
              fill
              className="object-cover"
              sizes="(max-width: 768px) 100vw, 50vw"
            />
            {!disabled && (
              <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                <Button
                  type="button"
                  variant="secondary"
                  size="sm"
                  onClick={openWidget}
                  disabled={isLoading || !isScriptLoaded}
                >
                  <Upload className="h-4 w-4 mr-1" />
                  Ganti
                </Button>
                <Button
                  type="button"
                  variant="destructive"
                  size="sm"
                  onClick={handleRemove}
                  disabled={isLoading}
                >
                  <Trash2 className="h-4 w-4 mr-1" />
                  Hapus
                </Button>
              </div>
            )}
          </div>
        ) : (
          // Upload Mode
          <button
            type="button"
            onClick={openWidget}
            disabled={disabled || isLoading || !isScriptLoaded}
            className={cn(
              "w-full flex flex-col items-center justify-center border-2 border-dashed rounded-lg bg-muted/50 hover:bg-muted transition-colors cursor-pointer",
              disabled && "cursor-not-allowed opacity-50",
              isLoading && "cursor-wait",
              !isScriptLoaded && "cursor-wait opacity-70"
            )}
            style={{ aspectRatio }}
          >
            {isLoading ? (
              <>
                <Loader2 className="h-8 w-8 mb-2 text-muted-foreground animate-spin" />
                <span className="text-sm text-muted-foreground">
                  Mengupload...
                </span>
              </>
            ) : !isScriptLoaded ? (
              <>
                <Loader2 className="h-8 w-8 mb-2 text-muted-foreground animate-spin" />
                <span className="text-sm text-muted-foreground">
                  Memuat...
                </span>
              </>
            ) : (
              <>
                <ImagePlus className="h-8 w-8 mb-2 text-muted-foreground" />
                <span className="text-sm text-muted-foreground">{placeholder}</span>
                <span className="text-xs text-muted-foreground mt-1">
                  PNG, JPG, WebP (max 5MB)
                </span>
              </>
            )}
          </button>
        )}
      </div>
    </>
  );
}

================================================
FILE: src/components/upload/multi-image-upload.tsx
Lines: 191
================================================

'use client';

import { useState } from 'react';
import { CldUploadWidget } from 'next-cloudinary';
import Image from 'next/image';
import { X, ImagePlus, Loader2 } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';
import type { CloudinaryUploadWidgetResults } from 'next-cloudinary';
import type { MultiImageUploadProps } from '@/types/cloudinary';

// ==========================================
// MULTI IMAGE UPLOAD COMPONENT
// ==========================================

export function MultiImageUpload({
  value = [],
  onChange,
  folder = 'fibidy/products',
  maxImages = 5,
  disabled = false,
}: MultiImageUploadProps) {
  const [isUploading, setIsUploading] = useState(false);

  const handleUpload = (result: CloudinaryUploadWidgetResults) => {
    if (result.event === 'success' && result.info && typeof result.info !== 'string') {
      const newUrl = result.info.secure_url;
      if (!value.includes(newUrl)) {
        onChange([...value, newUrl]);
      }
    }
  };

  const handleRemove = (urlToRemove: string) => {
    onChange(value.filter((url) => url !== urlToRemove));
  };

  const handleReorder = (fromIndex: number, toIndex: number) => {
    const newValue = [...value];
    const [removed] = newValue.splice(fromIndex, 1);
    newValue.splice(toIndex, 0, removed);
    onChange(newValue);
  };

  const canUploadMore = value.length < maxImages;

  return (
    <div className="space-y-4">
      {/* Image Grid */}
      <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
        {/* Uploaded Images */}
        {value.map((url, index) => (
          <div
            key={url}
            className="relative aspect-square rounded-lg overflow-hidden border bg-muted group"
          >
            <Image
              src={url}
              alt={`Image ${index + 1}`}
              fill
              className="object-cover"
              sizes="(max-width: 640px) 50vw, (max-width: 768px) 33vw, 20vw"
            />

            {/* Overlay */}
            <div className="absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors" />

            {/* Badge - Image Number */}
            <div className="absolute top-2 left-2 px-2 py-0.5 bg-black/60 text-white text-xs rounded">
              {index + 1}
            </div>

            {/* Actions */}
            {!disabled && (
              <div className="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                <Button
                  type="button"
                  variant="destructive"
                  size="icon"
                  className="h-7 w-7"
                  onClick={() => handleRemove(url)}
                >
                  <X className="h-4 w-4" />
                </Button>
              </div>
            )}

            {/* Reorder Buttons */}
            {!disabled && value.length > 1 && (
              <div className="absolute bottom-2 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1">
                {index > 0 && (
                  <Button
                    type="button"
                    variant="secondary"
                    size="sm"
                    className="h-6 px-2 text-xs"
                    onClick={() => handleReorder(index, index - 1)}
                  >
                    ‚Üê
                  </Button>
                )}
                {index < value.length - 1 && (
                  <Button
                    type="button"
                    variant="secondary"
                    size="sm"
                    className="h-6 px-2 text-xs"
                    onClick={() => handleReorder(index, index + 1)}
                  >
                    ‚Üí
                  </Button>
                )}
              </div>
            )}
          </div>
        ))}

        {/* Upload Button */}
        {canUploadMore && (
          <CldUploadWidget
            uploadPreset={process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET}
            options={{
              folder,
              maxFiles: maxImages - value.length,
              resourceType: 'image',
              clientAllowedFormats: ['jpg', 'jpeg', 'png', 'webp', 'gif'],
              maxFileSize: 10000000, // 10MB
              sources: ['local', 'url', 'camera'],
              multiple: true,
              styles: {
                palette: {
                  window: '#FFFFFF',
                  windowBorder: '#E5E7EB',
                  tabIcon: '#10B981',
                  menuIcons: '#6B7280',
                  textDark: '#111827',
                  textLight: '#FFFFFF',
                  link: '#10B981',
                  action: '#10B981',
                  inactiveTabIcon: '#9CA3AF',
                  error: '#EF4444',
                  inProgress: '#10B981',
                  complete: '#10B981',
                  sourceBg: '#F9FAFB',
                },
              },
            }}
            onOpen={() => setIsUploading(true)}
            onClose={() => setIsUploading(false)}
            onSuccess={handleUpload}
          >
            {({ open }) => (
              <button
                type="button"
                onClick={() => open()}
                disabled={disabled || isUploading}
                className={cn(
                  'aspect-square rounded-lg border-2 border-dashed flex flex-col items-center justify-center gap-2 transition-colors',
                  'hover:border-primary/50 hover:bg-muted/50',
                  'disabled:opacity-50 disabled:cursor-not-allowed'
                )}
              >
                {isUploading ? (
                  <Loader2 className="h-8 w-8 animate-spin text-muted-foreground" />
                ) : (
                  <>
                    <ImagePlus className="h-8 w-8 text-muted-foreground" />
                    <span className="text-xs text-muted-foreground">
                      Tambah Foto
                    </span>
                  </>
                )}
              </button>
            )}
          </CldUploadWidget>
        )}
      </div>

      {/* Info */}
      <div className="flex items-center justify-between text-sm text-muted-foreground">
        <span>
          {value.length} / {maxImages} gambar
        </span>
        {value.length > 0 && (
          <span className="text-xs">
            Gambar pertama akan jadi thumbnail utama
          </span>
        )}
      </div>
    </div>
  );
}


################################################################
##
##  COLLECTION SUMMARY
##
################################################################

Total Categories: 9
Total Files Collected: 86
Skipped Files: 0
Total Lines: 12303
Failed Files: 0
Duration: 24s
Completed: 2026-01-05 18:34:11

################################################################
##  END OF COLLECTION
################################################################
